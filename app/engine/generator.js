/**
 * FERIXDI Studio â€” Generator v2
 * Production Contract: Veo 3.1 â€¢ 8s â€¢ Handheld Selfie Feel
 * Universal character adapter â€” Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ¹ Ğ¸Ğ· ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ°
 */

import { estimateDialogue } from './estimator.js';
import { runAllValidations, scanBannedWords } from './validators.js';
import { autoTrim } from './auto_trim.js';
import { historyCache } from './history_cache.js';

// â”€â”€â”€ V2 TIMING GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const GRID_V2 = {
  hook:    { start: 0.0, end: 0.8 },
  act_A:   { start: 0.8, end: 3.6 },
  act_B:   { start: 3.6, end: 7.1 },
  release: { start: 7.1, end: 8.0 },
};

// â”€â”€â”€ LOCATIONS (fallback â€” used when no external locations loaded) â”€â”€
const FALLBACK_LOCATIONS = [
  'Weathered wooden barn interior, hay bales, single dusty lightbulb swinging, cracks of sunlight through planks',
  'Old bathhouse interior, fogged mirrors, wooden benches, copper ladle, steam wisps in backlight',
  'Root cellar with earthen walls, shelves of preserves in glass jars, bare bulb overhead, cool blue-tint air',
  'Soviet-era kitchen, peeling wallpaper, humming Saratov fridge, net curtains filtering amber sunlight',
  'Concrete balcony with drying laundry, distant city haze, rusted railing with chipped turquoise paint',
  'Stairwell landing with beige tile, fluorescent tube buzzing overhead, mailboxes, elevator door ajar',
  'Open-air bazaar stall, pyramid of watermelons, striped awning, plastic bags rustling in breeze',
  'Park bench near pond with pigeons, birch trees, distant accordion music, golden hour light',
];

// â”€â”€â”€ HOOK ACTIONS v2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const HOOK_ACTIONS = [
  { action_en: 'sharp finger jab at lens, near-miss touch', action_ru: 'ĞŸĞ°Ğ»ĞµÑ† Ğ² ĞºĞ°Ğ¼ĞµÑ€Ñƒ, Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ ĞºĞ°ÑĞ°ÑÑÑŒ Ğ»Ğ¸Ğ½Ğ·Ñ‹', audio: 'mechanical trigger + sharp inhale' },
  { action_en: 'object tap on glass â€” knuckle rap on invisible screen', action_ru: 'Ğ¡Ñ‚ÑƒĞº ĞºĞ¾ÑÑ‚ÑÑˆĞºĞ°Ğ¼Ğ¸ Ğ¿Ğ¾ "ÑÑ‚ĞµĞºĞ»Ñƒ"', audio: 'knocking + surprised gasp' },
  { action_en: 'abrupt lean-in to camera, face filling frame', action_ru: 'Ğ ĞµĞ·ĞºĞ¸Ğ¹ Ğ½Ğ°ĞºĞ»Ğ¾Ğ½ Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ, Ğ»Ğ¸Ñ†Ğ¾ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ ĞºĞ°Ğ´Ñ€', audio: 'cloth rustle + tense exhale' },
  { action_en: 'slap on table surface, objects rattle', action_ru: 'Ğ£Ğ´Ğ°Ñ€ Ğ¿Ğ¾ ÑÑ‚Ğ¾Ğ»Ñƒ, Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹ Ğ¿Ğ¾Ğ´Ğ¿Ñ€Ñ‹Ğ³Ğ¸Ğ²Ğ°ÑÑ‚', audio: 'table slap + glass rattle' },
  { action_en: 'dramatic removal of glasses/hat as reveal', action_ru: 'Ğ”Ñ€Ğ°Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾Ğµ ÑĞ½ÑÑ‚Ğ¸Ğµ Ğ¾Ñ‡ĞºĞ¾Ğ²/ÑˆĞ°Ğ¿ĞºĞ¸', audio: 'fabric whoosh + stare-down silence' },
];

// â”€â”€â”€ RELEASE ACTIONS v2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RELEASE_ACTIONS = [
  { action_en: 'shared raspy wheeze-laugh, camera shakes from body tremor', action_ru: 'ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ…Ñ€Ğ¸Ğ¿Ğ»Ñ‹Ğ¹ ÑĞ¼ĞµÑ…, ĞºĞ°Ğ¼ĞµÑ€Ğ° Ñ‚Ñ€ÑÑÑ‘Ñ‚ÑÑ Ğ¾Ñ‚ Ñ‚Ñ€ÑÑĞºĞ¸ Ñ‚ĞµĞ»Ğ°', audio: 'overlapping wheeze-laughs, gasping inhales, camera mic rumble from hand shake' },
  { action_en: 'A slaps own knee, B doubles over, tears forming', action_ru: 'A Ñ…Ğ»Ğ¾Ğ¿Ğ°ĞµÑ‚ Ğ¿Ğ¾ ĞºĞ¾Ğ»ĞµĞ½Ñƒ, B ÑĞ³Ğ¸Ğ±Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ°Ğ¼, ÑĞ»Ñ‘Ğ·Ñ‹', audio: 'knee slap impact, strained laughing exhale, sniffling tears' },
  { action_en: 'both lean into each other laughing, brief embrace', action_ru: 'ĞĞ±Ğ° Ğ·Ğ°Ğ²Ğ°Ğ»Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ´Ñ€ÑƒĞ³ Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ° Ğ¾Ñ‚ ÑĞ¼ĞµÑ…Ğ°', audio: 'fabric collision rustle, dual belly-laugh, affectionate shoulder pat' },
  { action_en: 'A covers mouth suppressing laugh, B slow triumphant grin', action_ru: 'A Ğ·Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ Ñ€Ğ¾Ñ‚, B Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ±ĞµĞ´Ğ½Ğ°Ñ ÑƒÑ…Ğ¼Ñ‹Ğ»ĞºĞ°', audio: 'muffled snort through fingers, quiet satisfied chuckle, nose exhale' },
  { action_en: 'synchronized head-throw-back cackle, camera jolts', action_ru: 'Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ñ…Ğ¾Ñ…Ğ¾Ñ‚ Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ĞºĞ¸Ğ½ÑƒÑ‚Ğ¾Ğ¹ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğ¹', audio: 'explosive dual cackle, chair creak from lean-back, camera mic peak (near-clip)' },
];

// â”€â”€â”€ SERIAL PROP ANCHORS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PROP_ANCHORS = [
  'old brass samovar with tarnished patina and wooden handles',
  'dented aluminum bucket with water condensation',
  'cast-iron poker leaning against brick surface',
  'cracked enamel kettle with chipped blue-white pattern',
  'wobbly three-legged wooden stool with worn seat',
  'vintage Rigonda radio with bakelite knobs',
  'wall-mounted rotary phone with coiled cord',
  'heavy glass ashtray with Soviet-era etching',
  'rusted tin watering can with bent spout',
  'dog-eared wall calendar from previous year',
  'ceramic sugar bowl with missing lid, spoon inside',
  'folded newspaper with visible Cyrillic headline',
];

// â”€â”€â”€ CATEGORY â†’ LOCATION ID PREFERENCES â”€â”€â”€â”€â”€
// Maps category to preferred location IDs from locations.json
const LOCATION_CATEGORY_MAP = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': ['soviet_kitchen', 'balcony', 'cellar', 'communal_corridor', 'elevator'],
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': ['soviet_kitchen', 'stairwell', 'balcony', 'garage', 'school_corridor'],
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': ['bazaar', 'soviet_kitchen', 'stairwell', 'pharmacy', 'post_office'],
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': ['soviet_kitchen', 'park_bench', 'balcony', 'dacha_veranda', 'fishing_spot'],
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': ['soviet_kitchen', 'attic', 'balcony', 'playground', 'school_corridor', 'cemetery_bench'],
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': ['stairwell', 'balcony', 'soviet_kitchen', 'elevator', 'communal_corridor', 'laundry_room'],
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': ['polyclinic', 'stairwell', 'soviet_kitchen', 'pharmacy', 'park_bench'],
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': ['balcony', 'soviet_kitchen', 'park_bench', 'playground', 'marshrutka'],
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': ['greenhouse', 'garden', 'barn', 'dacha_veranda', 'dacha_kitchen', 'chicken_coop'],
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': ['marshrutka', 'stairwell', 'park_bench', 'bus_stop', 'train_station'],
};

// â”€â”€â”€ CATEGORY â†’ PROP PREFERENCES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PROP_HINTS = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': ['cracked enamel kettle with chipped blue-white pattern', 'ceramic sugar bowl with missing lid, spoon inside'],
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': ['vintage Rigonda radio with bakelite knobs', 'wall-mounted rotary phone with coiled cord'],
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': ['folded newspaper with visible Cyrillic headline', 'ceramic sugar bowl with missing lid, spoon inside'],
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': ['heavy glass ashtray with Soviet-era etching', 'wall-mounted rotary phone with coiled cord'],
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': ['vintage Rigonda radio with bakelite knobs', 'dog-eared wall calendar from previous year'],
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': ['cracked enamel kettle with chipped blue-white pattern', 'old brass samovar with tarnished patina and wooden handles'],
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': ['dog-eared wall calendar from previous year', 'folded newspaper with visible Cyrillic headline'],
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': ['heavy glass ashtray with Soviet-era etching', 'folded newspaper with visible Cyrillic headline'],
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': ['rusted tin watering can with bent spout', 'dented aluminum bucket with water condensation'],
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': ['folded newspaper with visible Cyrillic headline', 'heavy glass ashtray with Soviet-era etching'],
};

// â”€â”€â”€ LIGHTING VARIATIONS BY LOCATION TYPE â”€â”€â”€
// Each preset: smartphone-grade realism with explicit source count, direction, shadow softness, overexposure budget, color temp
const LIGHTING_MOODS = [
  {
    style: 'warm amber backlight through dusty window, single dominant source camera-right at 45Â°, hard-to-medium shadows cast left, golden dust motes in light beams',
    mood: 'nostalgic warmth',
    sources: '1 dominant (window backlight) + 1 ambient fill (wall bounce). No other lights.',
    direction: 'Key light from camera-right at 45Â° through window; fill is diffuse wall bounce from left.',
    shadow_softness: 'medium-hard â€” shadow edges visible under nose and cheekbones, diffused at 15-20% feather, NOT razor-sharp.',
    overexposure_budget: 'Allow +1.5 EV on window, +0.5 EV on forehead/nose bridge highlight â€” this is natural smartphone clipping.',
    color_temp: '3200-3500K warm amber. Shadows lean slightly blue (natural daylight mix).',
  },
  {
    style: 'cool fluorescent overhead with greenish tint, flat institutional light, subtle 50Hz flicker visible in background only',
    mood: 'sterile tension',
    sources: '1 dominant (ceiling fluorescent tube) + 1 weak ambient (corridor light bleeding through doorframe).',
    direction: 'Key light directly overhead, slightly forward; creates raccoon-eye shadows under brow ridge.',
    shadow_softness: 'soft-flat â€” minimal shadow contrast, characteristic of diffuse overhead tube. Subtle chin shadow only.',
    overexposure_budget: 'Allow +0.3 EV on forehead only. Fluorescent rarely clips â€” image should feel slightly underlit.',
    color_temp: '4500-5000K with green shift (+5 on green channel). Skin looks slightly sallow â€” this is correct.',
  },
  {
    style: 'dappled natural light through foliage, shifting leaf-shadow patterns on faces, warm sunlight mixed with cool shade',
    mood: 'organic chaos',
    sources: '1 dominant (direct sun through leaves) + 1 fill (open sky from above/behind). Dappled pattern on faces.',
    direction: 'Sun high camera-left at 60Â°, leaf pattern breaks the light into moving spots on faces.',
    shadow_softness: 'mixed â€” sharp leaf shadow edges overlaid on soft ambient fill. Complex light-dark pattern across cheeks.',
    overexposure_budget: 'Allow +2.0 EV in sun spots on fabric/hair. Skin spots +0.8 EV max. Shade areas correctly exposed.',
    color_temp: '5500K in sun spots, 6500K in shade â€” dual temp is natural and correct for outdoor dappled.',
  },
  {
    style: 'single bare bulb overhead, harsh directional light from above-center, deep eye-socket shadows, warm tungsten',
    mood: 'dramatic intimacy',
    sources: '1 only (bare filament bulb on ceiling). Zero fill. Shadows are DEEP and real.',
    direction: 'Directly overhead, slightly toward camera. Creates strong nose shadow, chin shadow, eye-socket pools.',
    shadow_softness: 'hard â€” small point source means crisp shadow edges. Under-nose shadow clearly defined.',
    overexposure_budget: 'Allow +1.0 EV on top-of-head, +0.5 EV on nose/forehead. Lower face 1-2 stops darker than forehead.',
    color_temp: '2700-3000K deep warm tungsten. Everything amber-orange. Shadows go brownish-black, not blue.',
  },
  {
    style: 'overcast diffused daylight from large window camera-left, soft near-shadowless fill, slight cool blue undertone',
    mood: 'calm before storm',
    sources: '1 dominant (large overcast window left) + 1 ambient (room bounce from right wall). Ratio ~3:1.',
    direction: 'Broad soft key from camera-left window; fill from room bounce. Shadows present but gentle.',
    shadow_softness: 'very soft â€” large source means gradual falloff. Shadow under nose barely visible, cheek shadow smooth gradient.',
    overexposure_budget: 'Allow +0.5 EV on window-side cheek. Almost no clipping â€” overcast light is inherently balanced.',
    color_temp: '5800-6200K neutral-cool. Slight blue undertone in shadows. Skin reads accurate, no warmth.',
  },
  {
    style: 'late golden hour sun streaming horizontally through doorframe, one-sided warm blast, strong shadow side on far face',
    mood: 'golden confrontation',
    sources: '1 dominant (low sun through door/window) + 1 weak fill (ambient sky from behind camera).',
    direction: 'Hard horizontal key from camera-left at 15Â° above horizon. B-side face half in shadow.',
    shadow_softness: 'medium â€” low sun is moderately hard. Clear nose shadow, defined jaw shadow on shadow side.',
    overexposure_budget: 'Allow +2.5 EV on direct sun patch (fabric/wall). Skin highlight on sun side +1.0 EV â€” golden glow.',
    color_temp: '2800-3200K deep gold on sun side. Shadow side reads 5500K blue-ish from sky fill. Dual temp = golden hour.',
  },
  {
    style: 'mixed interior: overhead room light + blue TV glow from off-screen, two-tone lighting, face half warm half cool',
    mood: 'domestic tension',
    sources: '1 warm overhead (ceiling fixture, 3200K) + 1 cool side fill (TV/screen glow, 7000K blue).',
    direction: 'Warm key from overhead slightly behind; cool fill from camera-right low (TV bounce on face).',
    shadow_softness: 'medium-soft â€” overhead is diffuse fixture, TV bounce is broad. Two overlapping soft shadow sets.',
    overexposure_budget: 'Allow +0.5 EV on warm-lit forehead. Cool side may clip on reflective surfaces only.',
    color_temp: 'DUAL: 3200K warm dominant + 7000K cool fill. Split lighting on face â€” warm cheek left, blue tint right.',
  },
  {
    style: 'bright midday outdoor shade, open sky overhead as giant softbox, reflected ground bounce from below, very even',
    mood: 'exposed clarity',
    sources: '1 dominant (open sky above) + 1 fill (ground bounce from pavement/dirt). Very even ratio.',
    direction: 'Overhead from sky, fill from below-camera via ground reflection. Minimal shadows, bright.',
    shadow_softness: 'minimal â€” sky is enormous soft source. Only subtle shadows under chin and brow ridge.',
    overexposure_budget: 'Allow +0.3 EV on top of head/shoulders. Sky in background +3.0 EV blown â€” this is normal for phones.',
    color_temp: '5500-6000K neutral. Clean accurate color. Skin reads true. Slight warmth from ground bounce.',
  },
];

const HUMOR_CATEGORIES = [
  { ru: 'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´', en: 'Domestic absurdity' },
  { ru: 'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸', en: 'AI and technology' },
  { ru: 'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ', en: 'Prices and inflation' },
  { ru: 'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ', en: 'Relationships' },
  { ru: 'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹', en: 'Generation gap' },
  { ru: 'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°', en: 'Housing utilities drama' },
  { ru: 'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°', en: 'Health and polyclinic' },
  { ru: 'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹', en: 'Social media trends' },
  { ru: 'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´', en: 'Dacha and gardening' },
  { ru: 'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸', en: 'Transport and traffic' },
];

// â”€â”€â”€ HASHTAG ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Instagram strategy 2026: 3-5 Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… (>1M), 5-8 ÑÑ€ĞµĞ´Ğ½Ğ¸Ñ… (100K-1M), 5-7 Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ñ… (<100K)
// ĞĞ¸ĞºĞ°ĞºĞ¾Ğ³Ğ¾ ÑĞ¿Ğ°Ğ¼Ğ° Ñ‚Ğ¸Ğ¿Ğ° #funny #comedy #viral â€” Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ Ğ´Ğ°ÑƒĞ½Ñ€ĞµĞ¹Ñ‚Ğ¸Ñ‚
// Ğ’ÑĞµ Ñ‚ĞµĞ³Ğ¸ Ğ Ğ•Ğ›Ğ•Ğ’ĞĞĞ¢ĞĞ« ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ñƒ

const HASHTAGS_BY_CATEGORY = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': {
    niche: ['#Ğ±Ñ‹Ñ‚Ğ¾Ğ²Ğ°ÑĞ´Ñ€Ğ°Ğ¼Ğ°', '#Ğ¶Ğ¸Ğ·Ğ°Ğ¶ĞµÑÑ‚ÑŒ', '#Ğ°Ğ±ÑÑƒÑ€Ğ´Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸', '#ÑÑ‚Ğ¾Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾', '#Ğ±Ñ‹Ñ‚Ğ¾Ğ²ÑƒÑ…Ğ°', '#ĞºÑƒÑ…Ğ¾Ğ½Ğ½Ñ‹ĞµĞ²Ğ¾Ğ¹Ğ½Ñ‹'],
    mid:   ['#Ğ¶Ğ¸Ğ·Ğ°', '#Ñ€Ğ¶ÑƒĞ½ĞµĞ¼Ğ¾Ğ³Ñƒ', '#ÑĞ¼ĞµÑˆĞ½Ğ¾Ğ´Ğ¾ÑĞ»Ñ‘Ğ·', '#Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ğ¾', '#Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ°Ğ¶Ğ¸Ğ·Ğ½Ğ¸'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ñ€ÑƒÑÑĞºĞ¸Ğ¹ÑĞ¼Ğ¾Ñ€'],
  },
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': {
    niche: ['#Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚ÑŒĞ¿Ñ€Ğ¾Ñ‚Ğ¸Ğ²Ğ±Ğ°Ğ±ĞºĞ¸', '#Ğ¸Ğ¸vsÑ‡ĞµĞ»Ğ¾Ğ²ĞµĞº', '#Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ñ‹Ğ·Ğ°Ğ¼ĞµĞ½ÑÑ‚', '#Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ³Ğ¾', '#chatgptĞ¿Ğ¾Ñ€ÑƒÑÑĞºĞ¸', '#Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚Ğ¸Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹'],
    mid:   ['#Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚', '#Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸', '#Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµĞ½Ğ°ÑÑ‚ÑƒĞ¿Ğ¸Ğ»Ğ¾', '#Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚ÑŒ', '#aihumor'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸2026'],
  },
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': {
    niche: ['#Ñ†ĞµĞ½Ñ‹Ğ¾Ñ…Ñ€ĞµĞ½ĞµĞ»Ğ¸', '#Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸ÑĞ´Ğ½Ñ', '#Ğ´Ğ¾Ñ€Ğ¾Ğ¶ĞµĞ²ÑÑ‘', '#Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹Ğ¿Ğ¾Ğ´Ğ¾Ñ€Ğ¾Ğ¶Ğ°Ğ»Ğ¸', '#Ñ†ĞµĞ½Ğ½Ğ¸Ğº2026', '#ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ğ¼Ğ²Ğ¼ĞµÑÑ‚Ğµ'],
    mid:   ['#Ñ†ĞµĞ½Ñ‹', '#Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ', '#Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ¾', '#Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½', '#Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ¶Ğ¸Ğ·Ğ°'],
  },
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': {
    niche: ['#Ğ¼ÑƒĞ¶Ğ¸ĞºĞ¸Ñ‚Ğ°ĞºĞ¸Ğµ', '#Ğ¶ĞµĞ½Ñ‰Ğ¸Ğ½Ñ‹Ñ‚Ğ°ĞºĞ¸Ğµ', '#Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸ÑÑÑ‚Ğ¾', '#Ğ¿Ğ°Ñ€Ğ¾Ñ‡ĞºĞ¸', '#Ğ»ÑĞ±Ğ¾Ğ²ÑŒĞ¿Ğ¾Ñ€ÑƒÑÑĞºĞ¸', '#ÑĞ²Ğ¸Ğ´Ğ°Ğ½Ğ¸ĞµĞ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹'],
    mid:   ['#Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ', '#Ğ»ÑĞ±Ğ¾Ğ²ÑŒ', '#Ğ¿Ğ°Ñ€ĞµĞ½ÑŒ', '#ÑĞµĞ¼ÑŒÑ', '#Ğ¼ÑƒĞ¶'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ°Ğ¶Ğ¸Ğ·Ğ½Ğ¸'],
  },
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': {
    niche: ['#Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸ĞµĞ·ÑƒĞ¼ĞµÑ€Ğ¾Ğ²', '#Ğ¾ĞºĞµĞ¹Ğ±ÑƒĞ¼ĞµÑ€', '#Ğ±Ğ°Ğ±ĞºĞ°vsĞ²Ğ½ÑƒÑ‡ĞºĞ°', '#Ğ¼Ğ¾Ğ»Ğ¾Ğ´Ñ‘Ğ¶ÑŒÑ‚Ğ°ĞºĞ°Ñ', '#ÑÑ‚Ğ°Ñ€ÑˆĞµĞµĞ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğµ', '#ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹'],
    mid:   ['#Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ñ', '#Ğ¼Ğ¾Ğ»Ğ¾Ğ´Ñ‘Ğ¶ÑŒ', '#Ğ±Ğ°Ğ±ÑƒÑˆĞºĞ°', '#Ğ²Ğ½ÑƒĞºĞ¸', '#Ğ·ÑƒĞ¼ĞµÑ€Ñ‹'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ğ¾'],
  },
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': {
    niche: ['#Ğ¶ĞºÑ…Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°Ğ³Ğ¾Ñ€Ğ¸Ñ‚', '#ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‰Ğ°ÑĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ', '#ĞºĞ²Ğ¸Ñ‚Ğ°Ğ½Ñ†Ğ¸ÑĞºĞ¾ÑĞ¼Ğ¾Ñ', '#Ğ¾Ñ‚Ğ¾Ğ¿Ğ»ĞµĞ½Ğ¸ĞµĞ²ĞºĞ»ÑÑ‡Ğ¸Ğ»Ğ¸', '#ÑĞ¾ÑĞµĞ´Ğ¸ÑĞ½Ğ¸Ğ·Ñƒ'],
    mid:   ['#Ğ¶ĞºÑ…', '#ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°', '#ĞºĞ²Ğ°Ñ€Ñ‚Ğ¸Ñ€Ğ°', '#ÑĞ¾ÑĞµĞ´Ğ¸', '#ÑÑ‡Ñ‘Ñ‚Ğ·Ğ°ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºÑƒ'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ¶Ğ¸Ğ·Ğ°'],
  },
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': {
    niche: ['#Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒĞºĞ²Ğ²Ñ€Ğ°Ñ‡Ñƒ', '#Ğ´Ğ¾ĞºÑ‚Ğ¾Ñ€ÑĞºĞ°Ğ·Ğ°Ğ»', '#Ğ¼ĞµĞ´Ğ¸Ñ†Ğ¸Ğ½Ğ°Ğ¿Ğ¾Ñ€ÑƒÑÑĞºĞ¸', '#Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ğ¾Ñ‚Ğ±Ğ°Ğ±ĞºĞ¸', '#Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµĞ½ĞµĞºÑƒĞ¿Ğ¸ÑˆÑŒ'],
    mid:   ['#Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°', '#Ğ²Ñ€Ğ°Ñ‡', '#Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ', '#Ğ¼ĞµĞ´Ğ¸Ñ†Ğ¸Ğ½Ğ°', '#Ğ±Ğ¾Ğ»ÑŒĞ½Ğ¸Ñ†Ğ°'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ°Ğ¶Ğ¸Ğ·Ğ½Ğ¸'],
  },
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': {
    niche: ['#Ğ±Ğ»Ğ¾Ğ³ĞµÑ€Ñ‹Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ñ‚Ğ¸ĞºÑ‚Ğ¾ĞºĞµÑ€Ñ‹', '#Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¸', '#ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ¼ĞµĞ¹ĞºĞµÑ€', '#Ñ…Ğ°Ğ¹Ğ¿Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»ÑĞ¼ĞµĞ¹ĞºĞµÑ€'],
    mid:   ['#ÑĞ¾Ñ†ÑĞµÑ‚Ğ¸', '#Ğ±Ğ»Ğ¾Ğ³ĞµÑ€', '#Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹', '#Ğ¸Ğ½ÑÑ‚Ğ°Ğ³Ñ€Ğ°Ğ¼', '#ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹2026'],
  },
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': {
    niche: ['#Ğ´Ğ°Ñ‡Ğ°Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ½Ğ¸ĞºĞ°Ğ¼', '#Ğ¿Ğ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€Ğ½Ğ°ÑĞ´Ñ€Ğ°Ğ¼Ğ°', '#ÑĞ¾ÑĞµĞ´Ğ¿Ğ¾Ğ´Ğ°Ñ‡Ğµ', '#ÑƒÑ€Ğ¾Ğ¶Ğ°Ğ¹2026', '#Ğ³Ñ€ÑĞ´ĞºĞ¸Ğ²Ğ¾Ğ¹Ğ½Ñ‹'],
    mid:   ['#Ğ´Ğ°Ñ‡Ğ°', '#Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´', '#ÑƒÑ€Ğ¾Ğ¶Ğ°Ğ¹', '#ÑĞ°Ğ´', '#Ğ´Ğ°Ñ‡Ğ½Ğ°ÑĞ¶Ğ¸Ğ·Ğ½ÑŒ'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ»ĞµÑ‚Ğ¾'],
  },
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': {
    niche: ['#Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸Ğ¼Ğ¾ÑĞºĞ²Ñ‹', '#Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚ĞºĞ°Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#ÑĞ°Ğ¼Ğ¾ĞºĞ°Ñ‚Ğ²ÑĞ³Ğ¾Ñ€Ğ¾Ğ´', '#Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ¸Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚', '#Ğ¿Ğ°Ñ€ĞºĞ¾Ğ²ĞºĞ°Ğ´Ñ€Ğ°Ğ¼Ğ°'],
    mid:   ['#Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸', '#Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚', '#Ğ¼ĞµÑ‚Ñ€Ğ¾', '#ÑĞ°Ğ¼Ğ¾ĞºĞ°Ñ‚', '#Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ¼Ğ¾ÑĞºĞ²Ğ°'],
  },
};

// Evergreen Ñ‚ĞµĞ³Ğ¸ â€” Ğ¿Ğ¾Ğ´Ğ¼ĞµÑˆĞ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ²ÑĞµĞ³Ğ´Ğ° (2-3 ÑˆÑ‚)
const EVERGREEN_TAGS = [
  '#Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸', '#Ğ¿Ğ¾Ğ¿Ğ°Ğ»Ğ²Ñ€ĞµĞºĞ¸', '#Ğ·Ğ°Ğ»ĞµÑ‚ĞµĞ²Ñ€ĞµĞºĞ¸',
  '#shorts', '#reels', '#Ñ€Ğ¸Ğ»ÑÑ‹',
  '#ÑĞ¼ĞµÑˆĞ½Ğ¾ĞµĞ²Ğ¸Ğ´ĞµĞ¾', '#Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹2026', '#ÑĞ¼Ğ¾Ñ€',
];

// ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ½Ñ‹Ğµ Ñ‚ĞµĞ³Ğ¸ Ğ¿Ğ¾ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°Ğ¼
const GROUP_HASHTAGS = {
  'Ğ±Ğ°Ğ±ĞºĞ¸':      ['#Ğ±Ğ°Ğ±ĞºĞ°Ğ¶Ğ¶Ñ‘Ñ‚', '#Ğ±Ğ°Ğ±ÑƒÑˆĞºĞ°ÑĞºĞ°Ğ·Ğ°Ğ»Ğ°', '#Ğ±Ğ°Ğ±ĞºĞ¸Ğ¾Ğ³Ğ¾Ğ½ÑŒ', '#ÑÑ‚Ğ°Ñ€ÑˆĞµĞµĞ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğµ'],
  'Ğ´ĞµĞ´Ñ‹':       ['#Ğ´ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ»', '#Ğ´ĞµĞ´Ğ¼ÑƒĞ´Ñ€Ğ¾ÑÑ‚ÑŒ', '#ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹Ğ´Ğ°Ñ€ÑƒÑÑĞºĞ¸Ğ¹', '#Ğ´ĞµĞ´Ğ¾Ğ²ÑĞºĞ¸Ğ¹ÑĞ¼Ğ¾Ñ€'],
  'Ğ¼Ğ°Ğ¼Ñ‹':       ['#Ğ¼Ğ°Ğ¼Ğ°ÑĞºĞ°Ğ·Ğ°Ğ»Ğ°', '#Ğ¼Ğ°Ğ¼Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ°', '#Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ½ÑĞºĞ¸Ğ¹Ğ¸Ğ½ÑÑ‚Ğ¸Ğ½ĞºÑ‚', '#Ğ¼Ğ°Ğ¼Ñ‹Ğ¿Ğ¾Ğ¹Ğ¼ÑƒÑ‚'],
  'Ğ¿Ğ°Ğ¿Ñ‹':       ['#Ğ¿Ğ°Ğ¿Ğ°ÑĞºĞ°Ğ·Ğ°Ğ»', '#Ğ¿Ğ°Ğ¿Ğ°ÑˆÑƒÑ‚Ğ¸Ñ‚', '#Ğ¾Ñ‚ĞµÑ†Ğ¼Ğ¾Ğ»Ğ¾Ğ´ĞµÑ†', '#Ğ¿Ğ°Ğ¿Ğ¸Ğ½Ñ‹Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹'],
  'Ğ´Ğ¾Ñ‡ĞµÑ€Ğ¸':     ['#Ğ´Ğ¾Ñ‡ĞºĞ°Ñ‚Ğ°ĞºĞ°Ñ', '#Ğ´Ğ¾Ñ‡ÑŒvsmama', '#Ğ¼Ğ¾Ğ»Ğ¾Ğ´Ñ‘Ğ¶ÑŒ', '#Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸ĞµĞ°Ğ»ÑŒÑ„Ğ°'],
  'ÑÑ‹Ğ½Ğ¾Ğ²ÑŒÑ':    ['#ÑÑ‹Ğ½Ñ‚Ğ°ĞºĞ¾Ğ¹', '#ÑÑ‹Ğ½vsĞ¾Ñ‚ĞµÑ†', '#Ğ¿Ğ°Ñ†Ğ°Ğ½Ñ‹', '#ÑÑ‹Ğ½Ğ¾Ğº'],
  'Ñ‚Ñ‘Ñ‰Ğ¸':       ['#Ñ‚Ñ‘Ñ‰Ğ°Ğ¾Ğ³Ğ¾Ğ½ÑŒ', '#Ñ‚Ñ‘Ñ‰Ğ°ÑĞºĞ°Ğ·Ğ°Ğ»Ğ°', '#Ğ·ÑÑ‚ÑŒĞ²ÑˆĞ¾ĞºĞµ', '#Ñ‚Ñ‘Ñ‰Ğ°vsĞ·ÑÑ‚ÑŒ'],
  'ÑĞ²ĞµĞºÑ€Ğ¾Ğ²Ğ¸':   ['#ÑĞ²ĞµĞºÑ€Ğ¾Ğ²ÑŒ', '#ÑĞ²ĞµĞºÑ€Ğ¾Ğ²ÑŒÑĞºĞ°Ğ·Ğ°Ğ»Ğ°', '#Ğ½ĞµĞ²ĞµÑÑ‚ĞºĞ°Ğ²ÑˆĞ¾ĞºĞµ', '#ÑĞµĞ¼ĞµĞ¹Ğ½Ñ‹ĞµĞ´Ñ€Ğ°Ğ¼Ñ‹'],
  'ÑĞ¾ÑĞµĞ´Ğ¸':     ['#ÑĞ¾ÑĞµĞ´Ğ¸Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#ÑĞ¾ÑĞµĞ´Ñ‚Ğ°ĞºĞ¾Ğ¹', '#Ğ¿Ğ¾Ğ´ÑŠĞµĞ·Ğ´Ğ½Ğ°ÑĞ´Ñ€Ğ°Ğ¼Ğ°', '#ÑĞ¾ÑĞµĞ´Ğ¸ÑĞºĞ°Ğ½Ğ´Ğ°Ğ»'],
  'Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ñ†Ñ‹':   ['#Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ñ‰Ğ¸Ñ†Ğ°', '#Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ğ½Ğ°ĞºĞ°ÑÑĞµ', '#Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ÑŒĞ²ÑˆĞ¾ĞºĞµ'],
  'Ğ²Ñ€Ğ°Ñ‡Ğ¸':      ['#Ğ´Ğ¾ĞºÑ‚Ğ¾Ñ€Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ğ²Ñ€Ğ°Ñ‡ÑĞºĞ°Ğ·Ğ°Ğ»', '#Ğ¼ĞµĞ´Ğ¸ĞºĞ¸ÑˆÑƒÑ‚ÑÑ‚', '#Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ·ÑĞ¼Ğ¾Ñ€'],
  'ÑƒÑ‡Ğ¸Ñ‚ĞµĞ»Ñ':    ['#ÑƒÑ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¸Ñ†Ğ°', '#ÑˆĞºĞ¾Ğ»Ğ°Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#ÑƒÑ‡Ğ¸Ñ‚ĞµĞ»ÑŒ', '#ÑƒÑ€Ğ¾ĞºĞ¶Ğ¸Ğ·Ğ½Ğ¸'],
  'Ğ±Ğ»Ğ¾Ğ³ĞµÑ€Ñ‹':    ['#Ğ±Ğ»Ğ¾Ğ³ĞµÑ€ÑˆĞ°', '#Ğ¸Ğ½ÑÑ‚Ğ°Ğ±Ğ»Ğ¾Ğ³ĞµÑ€', '#Ğ±Ğ»Ğ¾Ğ³ĞµÑ€Ñ‹Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ¼ĞµĞ¹ĞºĞµÑ€'],
  'Ñ‚Ğ°ĞºÑĞ¸ÑÑ‚Ñ‹':   ['#Ñ‚Ğ°ĞºÑĞ¸ÑÑ‚', '#ÑĞ½Ğ´ĞµĞºÑÑ‚Ğ°ĞºÑĞ¸', '#Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑ‚Ğ°ĞºÑĞ¸', '#Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ°Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹'],
  'Ğ±Ğ¸Ğ·Ğ½ĞµÑĞ¼ĞµĞ½Ñ‹': ['#Ğ±Ğ¸Ğ·Ğ½ĞµÑĞ¼ĞµĞ½', '#Ğ±Ğ¸Ğ·Ğ½ĞµÑĞ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ğ¿Ñ€ĞµĞ´Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒ', '#ÑÑ‚Ğ°Ñ€Ñ‚Ğ°Ğ¿'],
  'ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚Ñ‹':   ['#ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚', '#ÑƒĞ½Ğ¸Ğ²ĞµÑ€', '#ÑĞµÑÑĞ¸Ñ', '#ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‡ĞµÑĞºĞ¸Ğ¹ÑĞ¼Ğ¾Ñ€'],
  'Ğ¿ĞµĞ½ÑĞ¸Ğ¾Ğ½ĞµÑ€Ñ‹': ['#Ğ¿ĞµĞ½ÑĞ¸Ğ¾Ğ½ĞµÑ€', '#Ğ¿ĞµĞ½ÑĞ¸Ñ', '#Ğ¿ĞµĞ½ÑĞ¸Ğ¾Ğ½ĞµÑ€Ñ‹Ğ¶Ğ³ÑƒÑ‚', '#ÑÑ‚Ğ°Ñ€ÑˆĞµĞµĞ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğµ'],
  'Ñ‡Ğ¸Ğ½Ğ¾Ğ²Ğ½Ğ¸ĞºĞ¸':  ['#Ñ‡Ğ¸Ğ½Ğ¾Ğ²Ğ½Ğ¸ĞºĞ¸', '#Ğ±ÑÑ€Ğ¾ĞºÑ€Ğ°Ñ‚Ğ¸Ñ', '#Ğ³Ğ¾ÑÑƒÑĞ»ÑƒĞ³Ğ¸', '#Ğ¼Ñ„Ñ†'],
  'Ñ„Ğ¸Ñ‚Ğ½ĞµÑ':     ['#Ñ„Ğ¸Ñ‚Ğ½ĞµÑÑĞ¼Ğ¾Ñ€', '#Ğ·Ğ¾Ğ¶', '#Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°', '#Ñ„Ğ¸Ñ‚Ğ½ĞµÑÑ‚Ñ€ĞµĞ½ĞµÑ€'],
  'ĞºĞ¾ÑˆĞ°Ñ‚Ğ½Ğ¸Ñ†Ñ‹':  ['#ĞºĞ¾ÑˆĞ°Ñ‚Ğ½Ğ¸Ñ†Ğ°', '#ĞºĞ¾Ñ‚Ğ¸ĞºĞ¸', '#ĞºĞ¾ÑˆĞºĞ¸Ğ¿Ñ€Ğ°Ğ²ÑÑ‚', '#ĞºĞ¾Ñ‚Ğ¾Ğ¼Ğ°Ğ¼Ğ°'],
  'ÑĞºÑÑ‚Ñ€ĞµĞ¼Ğ°Ğ»Ñ‹': ['#ÑĞºÑÑ‚Ñ€Ğ¸Ğ¼', '#Ğ°Ğ´Ñ€ĞµĞ½Ğ°Ğ»Ğ¸Ğ½', '#ÑĞºÑÑ‚Ñ€ĞµĞ¼Ğ°Ğ»', '#Ğ±ĞµĞ·Ğ±Ğ°ÑˆĞµĞ½Ğ½Ñ‹Ğ¹'],
};

// â”€â”€â”€ VIRAL TITLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Hook-Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñ‹: Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ / ÑˆĞ¾Ğº / Ğ½ĞµĞ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ / Ğ¿Ñ€Ğ¾Ğ²Ğ¾ĞºĞ°Ñ†Ğ¸Ñ
const VIRAL_TITLES = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': [
    'ĞĞ½Ğ° Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ ÑÑ‚Ğ¾ ÑĞºĞ°Ğ·Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¸ Ğ²ÑĞµÑ…...',
    'ĞšĞ¾Ğ³Ğ´Ğ° {A} ÑƒĞ·Ğ½Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ°Ğ²Ğ´Ñƒ â€” Ğ»Ğ¸Ñ†Ğ¾ Ğ±ĞµÑÑ†ĞµĞ½Ğ½Ğ¾ ğŸ’€',
    'Ğ’Ğ¾Ñ‚ Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ñ {A} Ğ»ÑƒÑ‡ÑˆĞµ Ğ½Ğµ ÑĞ¿Ğ¾Ñ€Ğ¸Ñ‚ÑŒ',
    '{A} vs Ğ·Ğ´Ñ€Ğ°Ğ²Ñ‹Ğ¹ ÑĞ¼Ñ‹ÑĞ»: 0-1 ğŸ¤£',
    'ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ ÑĞ»Ğ¾Ğ²Ğ° {B} ÑƒĞ±Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ğ¿Ğ¾Ğ²Ğ°Ğ»',
  ],
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': [
    '{A} Ğ²Ğ¿ĞµÑ€Ğ²Ñ‹Ğµ ÑƒĞ·Ğ½Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¾ Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚Ğ¸... Ğ¸ Ğ¿Ğ¾Ğ½ĞµÑĞ»Ğ¾ÑÑŒ ğŸ’€',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ğ» Ñ‡Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ AI Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ğ¼Ğ¸ ÑĞ»Ğ¾Ğ²Ğ°Ğ¼Ğ¸',
    'Ğ ĞµĞ°ĞºÑ†Ğ¸Ñ {A} Ğ½Ğ° Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ â€” Ğ‘Ğ•Ğ¡Ğ¦Ğ•ĞĞĞ',
    '{B} Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹ ÑƒĞ½Ğ¸Ñ‡Ñ‚Ğ¾Ğ¶Ğ¸Ğ» Ğ²ĞµÑÑŒ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ',
    'ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸ ÑÑ‚Ğ¾ Ñ‚Ğ¾Ğ¼Ñƒ ĞºÑ‚Ğ¾ Ğ±Ğ¾Ğ¸Ñ‚ÑÑ Ñ‡Ñ‚Ğ¾ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ñ‹ Ğ·Ğ°Ğ¼ĞµĞ½ÑÑ‚ Ğ»ÑĞ´ĞµĞ¹',
  ],
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': [
    '{A} Ğ·Ğ°ÑˆĞ»Ğ° Ğ² Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½ Ğ¸ Ğ°Ñ…Ğ½ÑƒĞ»Ğ°... ğŸ˜±',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} Ğ²ÑĞ¿Ğ¾Ğ¼Ğ½Ğ¸Ğ» Ñ†ĞµĞ½Ñ‹ Ğ¸Ğ· 90-Ñ… â€” {A} Ğ² ÑˆĞ¾ĞºĞµ',
    'Ğ¦ĞµĞ½Ñ‹ 2026: {A} Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ',
    'ĞĞ´Ğ½Ğ° Ñ„Ñ€Ğ°Ğ·Ğ° {B} Ğ¿Ñ€Ğ¾ Ñ†ĞµĞ½Ñ‹ Ğ·Ğ°ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ Ñ‚ĞµĞ±Ñ Ğ¿Ğ»Ğ°ĞºĞ°Ñ‚ÑŒ Ğ¸ ÑĞ¼ĞµÑÑ‚ÑŒÑÑ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾',
    'Ğ’Ğ¾Ñ‚ Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ {A} Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğµ Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½',
  ],
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': [
    'ĞšĞ¾Ğ³Ğ´Ğ° {A} Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ»Ğ° Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑĞºÑƒ â€” {B} Ğ²ÑÑ‘ Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ğ» Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹ ğŸ’€',
    '{B} Ñ€Ğ°ÑÑĞºĞ°Ğ·Ğ°Ğ» ĞºĞ°Ğº Ñ€Ğ°Ğ½ÑŒÑˆĞµ ÑƒÑ…Ğ°Ğ¶Ğ¸Ğ²Ğ°Ğ»Ğ¸ â€” Ğ´ĞµĞ²Ğ¾Ñ‡ĞºĞ¸, Ğ²Ñ‹ Ğ½Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹',
    'Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ {B} Ğ½Ğ° Ğ¶Ğ°Ğ»Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾ ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¼ÑƒĞ¶Ğ¸ĞºĞ¾Ğ²',
    '{A} Ğ¾Ğ¿Ğ¸ÑĞ°Ğ»Ğ° ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ â€” {B} Ğ² Ğ°ÑƒÑ‚Ğµ',
    'ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ» Ğ¼Ğ°Ğ¼Ğµ â€” Ğ¾Ğ½Ğ° Ğ¿Ğ»Ğ°ĞºĞ°Ğ»Ğ° Ğ¾Ñ‚ ÑĞ¼ĞµÑ…Ğ°',
  ],
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': [
    '{A} ÑƒĞ·Ğ½Ğ°Ğ»Ğ° Ñ‡ĞµĞ¼ Ğ·Ğ°Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ÑÑ Ğ²Ğ½ÑƒÑ‡ĞºĞ° â€” Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ ğŸ’€',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ğ» Ğ¼Ğ¾Ğ»Ğ¾Ğ´Ñ‘Ğ¶ÑŒ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹',
    '{A} vs TikTok: Ğ±Ğ¾Ğ¹ Ğ²ĞµĞºĞ°',
    'Ğ’Ğ¾Ñ‚ Ñ‚Ğ°Ğº {B} Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğµ Z',
    'ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞµ â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ ğŸ¤£',
  ],
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': [
    '{A} Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ° ĞºĞ²Ğ¸Ñ‚Ğ°Ğ½Ñ†Ğ¸Ñ â€” ÑÑĞ´ÑŒÑ‚Ğµ ğŸ˜±',
    'ĞÑ‚Ğ²ĞµÑ‚ {B} Ğ½Ğ° ÑÑ‡Ñ‘Ñ‚ Ğ·Ğ° Ğ–ĞšĞ¥ â€” Ğ³ĞµĞ½Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾',
    'Ğ’Ğ¾Ñ‚ Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ {A} Ğ²Ğ¾ÑĞµÑ‚ Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‰ĞµĞ¹ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸ĞµĞ¹',
    '{B} Ğ¿Ñ€Ğ¾ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºÑƒ â€” Ğ±Ğ¾Ğ»ÑŒĞ½Ğ¾ Ğ½Ğ¾ ÑĞ¼ĞµÑˆĞ½Ğ¾',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ ÑÑ‚Ğ¾ Ğ² Ñ‡Ğ°Ñ‚ Ğ´Ğ¾Ğ¼Ğ° â€” ÑĞ¾ÑĞµĞ´Ğ¸ Ğ¾Ñ†ĞµĞ½ÑÑ‚',
  ],
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': [
    '{A} Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğ° Ğº Ğ²Ñ€Ğ°Ñ‡Ñƒ â€” Ñ Ğ¿Ğ»Ğ°ĞºĞ°Ğ» ğŸ’€',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ğ» Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ· Ğ»ÑƒÑ‡ÑˆĞµ Ğ´Ğ¾ĞºÑ‚Ğ¾Ñ€Ğ°',
    'Ğ ĞµĞ°ĞºÑ†Ğ¸Ñ {A} Ğ½Ğ° ÑĞ¾Ğ²ĞµÑ‚ Ğ²Ñ€Ğ°Ñ‡Ğ° â€” Ğ—ĞĞ›ĞĞ¢Ğ',
    '{B} Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ» Ğ²ÑÑ Ğ¼ĞµĞ´Ğ¸Ñ†Ğ¸Ğ½Ñƒ',
    'ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸ Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ğ¾Ğ¼Ñƒ Ğ²Ñ€Ğ°Ñ‡Ñƒ â€” Ğ¾Ñ†ĞµĞ½Ğ¸Ñ‚ ğŸ¤£',
  ],
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': [
    '{A} ÑƒĞ·Ğ½Ğ°Ğ»Ğ° Ñ‡Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¸ â€” Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ ğŸ’€',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ğ» ÑÑƒÑ‚ÑŒ Ğ±Ğ»Ğ¾Ğ³Ğ¸Ğ½Ğ³Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹',
    '{A} vs Instagram: ĞºÑ‚Ğ¾ ĞºĞ¾Ğ³Ğ¾',
    'ĞÑ‚Ğ²ĞµÑ‚ {B} Ğ¿Ñ€Ğ¾ Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ² â€” Ğ³ĞµĞ½Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ±Ğ»Ğ¾Ğ³ĞµÑ€Ñƒ â€” Ğ¿ÑƒÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ·Ñ€ĞµĞµÑ‚ ğŸ¤£',
  ],
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': [
    '{A} Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ğ»Ğ° Ñ‡Ñ‚Ğ¾ ÑĞ»ÑƒÑ‡Ğ¸Ğ»Ğ¾ÑÑŒ Ñ Ğ¿Ğ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€Ğ°Ğ¼Ğ¸ ğŸ˜±',
    'Ğ’ĞµÑ€ÑĞ¸Ñ {B} ĞºÑ‚Ğ¾ ÑĞ¾Ğ¶Ñ€Ğ°Ğ» ÑƒÑ€Ğ¾Ğ¶Ğ°Ğ¹ â€” Ñ Ñ€Ñ‹Ğ´Ğ°Ğ»',
    '{A} vs Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´: Ğ²ĞµÑ‡Ğ½Ğ°Ñ Ğ±Ğ¸Ñ‚Ğ²Ğ°',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ğ» ÑÑƒÑ‚ÑŒ Ğ´Ğ°Ñ‡Ğ½Ğ¾Ğ¹ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ´Ğ°Ñ‡Ğ½Ğ¸ĞºÑƒ â€” Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ÑƒĞ·Ğ½Ğ°ĞµÑ‚ ÑĞµĞ±Ñ ğŸ¤£',
  ],
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': [
    '{A} Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ÑĞ»Ğ° Ğ² Ğ¿Ñ€Ğ¾Ğ±ĞºĞµ 2 Ñ‡Ğ°ÑĞ° â€” Ğ¸ Ğ²Ğ¾Ñ‚ Ñ‡Ñ‚Ğ¾ ÑĞºĞ°Ğ·Ğ°Ğ»Ğ° ğŸ’€',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ» Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ â€” {A} Ğ² ÑˆĞ¾ĞºĞµ',
    '{A} vs Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: 0-1',
    'ĞÑ‚Ğ²ĞµÑ‚ {B} Ğ¿Ñ€Ğ¾ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸ Ğ·Ğ°ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ Ğ¿Ğ»Ğ°ĞºĞ°Ñ‚ÑŒ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¹',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ ĞºÑ‚Ğ¾ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ² Ğ¿Ñ€Ğ¾Ğ±ĞºĞµ ğŸ¤£',
  ],
};

// â”€â”€â”€ PIN COMMENTS (Ğ—ĞĞšĞ Ğ•ĞŸĞ«) â€” Ğ±Ğ°Ğ¹Ñ‚ Ğ½Ğ° Ğ¿ĞµÑ€ĞµÑÑ‹Ğ»ĞºÑƒ â”€â”€
const PIN_COMMENTS = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': [
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ, Ñƒ ĞºĞ¾Ğ³Ğ¾ Ğ´Ğ¾Ğ¼Ğ° Ñ‚Ğ°ĞºĞ¾Ğ¹ Ğ¶Ğµ Ñ†Ğ¸Ñ€Ğº ğŸªğŸ˜‚',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ¼Ğ°Ğ¼Ğµ â€” Ğ¾Ğ½Ğ° Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ÑĞºĞ°Ğ¶ĞµÑ‚ Â«ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾ Ğ½Ğ°ÑÂ» ğŸ’€',
    'Ğ¢ĞµĞ³ Ğ¿Ğ¾Ğ´Ñ€ÑƒĞ³Ñƒ Ñƒ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ñ‚Ğ°Ğº Ğ¶Ğµ Ğ´Ğ¾Ğ¼Ğ° ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑƒĞ·Ğ½Ğ°Ğ» ÑĞ²Ğ¾Ñ ÑĞµĞ¼ÑŒÑ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ² ÑĞµĞ¼ĞµĞ¹Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚ Ğ¸ Ğ¶Ğ´Ğ¸ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ ğŸ“±',
  ],
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': [
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ Ğ´Ğ¾ ÑĞ¸Ñ… Ğ¿Ğ¾Ñ€ Ğ±Ğ¾Ğ¸Ñ‚ÑÑ Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚ĞµĞ¹ ğŸ¤–ğŸ˜‚',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞµ Ğ¸ ÑĞ½Ğ¸Ğ¼Ğ¸ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ Ğ½Ğ° ĞºĞ°Ğ¼ĞµÑ€Ñƒ ğŸ’€',
    'Ğ¢ĞµĞ³ Ğ´Ñ€ÑƒĞ³Ğ° ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ´ÑƒĞ¼Ğ°ĞµÑ‚ Ñ‡Ñ‚Ğ¾ AI â€” ÑÑ‚Ğ¾ ĞµÑ€ÑƒĞ½Ğ´Ğ° ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑĞ¾Ğ³Ğ»Ğ°ÑĞµĞ½ Ñ {B} â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ Â«Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ñ‹ Ğ½Ğ°Ñ Ğ·Ğ°Ğ¼ĞµĞ½ÑÑ‚Â» ğŸ“±',
  ],
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': [
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ±Ñ‹Ğ» Ğ² Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğµ ğŸ›’ğŸ˜­',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ¼Ğ°Ğ¼Ğµ â€” Ğ¾Ğ½Ğ° Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ ĞºĞ°Ğ¶Ğ´Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ ğŸ’€',
    'Ğ¢ĞµĞ³ Ñ‚Ğ¾Ğ³Ğ¾, ĞºÑ‚Ğ¾ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚ Ñ†ĞµĞ½Ñ‹ Ğ¸Ğ· 90-Ñ… ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑƒĞ¶Ğµ Ğ¿Ğ»Ğ°Ñ‡ĞµÑ‚ Ğ½Ğ° ĞºĞ°ÑÑĞµ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ñ‡Ğ°Ñ‚ â€” Ğ²ÑĞµ Ğ¿Ğ¾Ğ¹Ğ¼ÑƒÑ‚ ğŸ“±',
  ],
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': [
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ğ¿Ğ¾Ğ´Ñ€ÑƒĞ³Ğµ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ¶Ğ°Ğ»ÑƒĞµÑ‚ÑÑ Ğ½Ğ° Ğ¼ÑƒĞ¶Ğ¸ĞºĞ¾Ğ² ğŸ’…ğŸ˜‚',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ¿Ğ°Ñ€Ğ½Ñ â€” Ğ¿ÑƒÑÑ‚ÑŒ ÑƒÑ‡Ğ¸Ñ‚ÑÑ ğŸ’€',
    'Ğ¢ĞµĞ³ Ñ‚Ğ¾Ğ³Ğ¾, ĞºÑ‚Ğ¾ Ñ‚Ğ°Ğº Ğ¶Ğµ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ÑÑ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑƒĞ·Ğ½Ğ°Ğ» ÑĞµĞ±Ñ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ² Ğ¶ĞµĞ½ÑĞºĞ¸Ğ¹ Ñ‡Ğ°Ñ‚ Ğ¸ ÑÑ‡Ğ¸Ñ‚Ğ°Ğ¹ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ğ¸ ğŸ“±',
  ],
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': [
    'Ğ¡ĞºĞ¸Ğ½ÑŒ ÑÑ‚Ğ¾ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞµ â€” ÑĞ½Ğ¸Ğ¼Ğ°Ğ¹ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ Ğ½Ğ° ĞºĞ°Ğ¼ĞµÑ€Ñƒ ğŸ“±ğŸ˜‚',
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ğ² ÑĞµĞ¼ĞµĞ¹Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚ â€” Ğ±Ğ°Ğ±ÑƒÑˆĞºĞ° Ğ¾Ñ†ĞµĞ½Ğ¸Ñ‚ ğŸ’€',
    'Ğ¢ĞµĞ³ Ğ±ÑƒĞ¼ĞµÑ€Ğ° Ğ¸ Ğ·ÑƒĞ¼ĞµÑ€Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑĞ»Ñ‹ÑˆĞ°Ğ» Ñ‚Ğ°ĞºĞ¾Ğµ Ğ¾Ñ‚ ÑÑ‚Ğ°Ñ€ÑˆĞ¸Ñ… â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ²Ğ½ÑƒĞºĞ°Ğ¼ â€” Ğ¸Ğ»Ğ¸ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞµ â€” ĞºĞ¾Ğ¼Ñƒ ÑĞ¼ĞµĞ»ĞµĞµ ğŸ“±',
  ],
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': [
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ² Ñ‡Ğ°Ñ‚ Ğ´Ğ¾Ğ¼Ğ° â€” ÑĞ¾ÑĞµĞ´Ğ¸ Ğ¿Ğ¾Ğ¹Ğ¼ÑƒÑ‚ ğŸ ğŸ˜‚',
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‰ĞµĞ¹ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸ ğŸ’€',
    'Ğ¢ĞµĞ³ ÑĞ¾ÑĞµĞ´Ğ°, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ñ‚Ğ¾Ğ¶Ğµ Ğ² ÑˆĞ¾ĞºĞµ Ğ¾Ñ‚ ĞºĞ²Ğ¸Ñ‚Ğ°Ğ½Ñ†Ğ¸Ğ¹ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚ Ğ·Ğ° Ğ–ĞšĞ¥ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥ (Ñ‚Ğ¾ ĞµÑÑ‚ÑŒ Ğ²ÑĞµ)',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ Ğ¶Ğ°Ğ»ÑƒĞµÑ‚ÑÑ Ğ½Ğ° Ğ±Ğ°Ñ‚Ğ°Ñ€ĞµĞ¸ ğŸ“±',
  ],
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': [
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ğ¾Ğ¼Ñƒ Ğ²Ñ€Ğ°Ñ‡Ñƒ â€” Ğ¿ÑƒÑÑ‚ÑŒ Ğ¾Ñ†ĞµĞ½Ğ¸Ñ‚ ğŸ¥ğŸ˜‚',
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ Ğ½ĞµĞ½Ğ°Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸ Ğ² Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞµ ğŸ’€',
    'Ğ¢ĞµĞ³ Ğ´Ñ€ÑƒĞ³Ğ° ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ³ÑƒĞ³Ğ»Ğ¸Ñ‚ Ğ²ÑĞµ ÑĞ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ñ‹ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ Ğ»ĞµÑ‡Ğ¸Ğ»ÑÑ Ğ¿Ğ¾ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ñƒ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ¼Ğ°Ğ¼Ğµ â€” Ğ¾Ğ½Ğ° ÑĞºĞ°Ğ¶ĞµÑ‚ Â«Ğ¼Ğ½Ğµ Ñ‚Ğ¾Ğ¶Ğµ Ñ‚Ğ°Ğº ÑĞºĞ°Ğ·Ğ°Ğ»Ğ¸Â» ğŸ“±',
  ],
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': [
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ±Ğ»Ğ¾Ğ³ĞµÑ€Ñƒ â€” Ğ¿ÑƒÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ·Ñ€ĞµĞµÑ‚ ğŸ“±ğŸ˜‚',
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ ÑĞ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ñ€Ğ¸Ğ»ÑÑ‹ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ ÑƒĞ±Ğ¾Ñ€ĞºĞ¸ ğŸ’€',
    'Ğ¢ĞµĞ³ Ğ´Ñ€ÑƒĞ³Ğ° Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ°Ğ¼Ğ¸ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ñ‡ĞµĞ¼ Ñƒ Ñ‚ĞµĞ±Ñ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑĞ¸Ğ´Ğ¸Ñ‚ Ğ² Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğµ 24/7 â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥ (Ğ²ÑĞµ ÑÑ‚Ğ°Ğ²Ğ¸Ğ¼)',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚-Ğ¼ĞµĞ¹ĞºĞµÑ€Ñƒ Ğ¸ Ğ¶Ğ´Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚ ğŸ“±',
  ],
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': [
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ² Ğ´Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚ â€” ĞºÑ‚Ğ¾-Ñ‚Ğ¾ ÑƒĞ·Ğ½Ğ°ĞµÑ‚ ÑĞµĞ±Ñ ğŸŒ±ğŸ˜‚',
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞµ-Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ½Ğ¸Ñ†Ğµ ğŸ’€',
    'Ğ¢ĞµĞ³ ÑĞ¾ÑĞµĞ´Ğ° Ğ¿Ğ¾ Ğ´Ğ°Ñ‡Ğµ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ» ÑƒÑ€Ğ¾Ğ¶Ğ°Ğ¹ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ² ÑĞµĞ¼ĞµĞ¹Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚ Ğ´Ğ°Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ² ğŸ“±',
  ],
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': [
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ Ğ¿Ñ€ÑĞ¼Ğ¾ ÑĞµĞ¹Ñ‡Ğ°Ñ ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ² Ğ¿Ñ€Ğ¾Ğ±ĞºĞµ ğŸš—ğŸ˜‚',
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ğ´Ñ€ÑƒĞ³Ñƒ-Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ â€” Ğ¾Ğ½ Ğ¿Ğ¾Ğ¹Ğ¼Ñ‘Ñ‚ ğŸ’€',
    'Ğ¢ĞµĞ³ Ñ‚Ğ¾Ğ³Ğ¾, ĞºÑ‚Ğ¾ ĞµĞ·Ğ´Ğ¸Ñ‚ Ğ½Ğ° ÑĞ°Ğ¼Ğ¾ĞºĞ°Ñ‚Ğµ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑÑ‚Ğ¾ÑĞ» 2 Ñ‡Ğ°ÑĞ° Ğ² Ğ¿Ñ€Ğ¾Ğ±ĞºĞµ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ñ‡Ğ°Ñ‚ â€” Ğ²ÑĞµ Ğ¾Ğ¿Ğ°Ğ·Ğ´Ñ‹Ğ²Ğ°ÑÑ‰Ğ¸Ğµ Ğ¾Ñ†ĞµĞ½ÑÑ‚ ğŸ“±',
  ],
};

// â”€â”€â”€ FIRST COMMENTS â€” Ğ¿Ñ€Ğ¾Ğ²Ğ¾ĞºĞ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ²Ğ¾Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ â”€â”€
const FIRST_COMMENTS = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': [
    'Ğ Ñƒ Ğ²Ğ°Ñ Ğ´Ğ¾Ğ¼Ğ° Ñ‚Ğ°Ğº Ğ¶Ğµ? Ğ˜Ğ»Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñƒ Ğ¼ĞµĞ½Ñ? ğŸ˜‚',
    'ĞšÑ‚Ğ¾ Ğ¿Ñ€Ğ°Ğ² â€” {A} Ğ¸Ğ»Ğ¸ {B}? Ğ–Ğ´Ñƒ Ğ² ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ… ğŸ‘‡',
    '{B} ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾ Ğ¶Ñ‘ÑÑ‚ĞºĞ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ğ»... Ğ½Ğ¾ Ğ²ĞµĞ´ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ°? ğŸ¤”',
    'ĞœĞ¾Ğ¹ ÑĞ¾ÑĞµĞ´ â€” 1 Ğ² 1 ĞºĞ°Ğº {A} ğŸ’€ Ğ£ ĞºĞ¾Ğ³Ğ¾ Ñ‚Ğ°Ğº Ğ¶Ğµ?',
  ],
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': [
    'ĞĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚Ğ¸ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ·Ğ°Ğ¼ĞµĞ½ÑÑ‚ Ğ²ÑĞµÑ… Ğ¸Ğ»Ğ¸ {A} Ğ¿Ñ€Ğ°Ğ²Ğ°? ğŸ¤”',
    'ĞšÑ‚Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¿Ñ€Ğ°Ğ² â€” {A} Ğ¸Ğ»Ğ¸ {B}? ğŸ‘‡',
    'ĞœĞ¾Ñ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞ° Ñ‚Ğ°ĞºĞ¾Ğµ Ğ¶Ğµ ÑĞºĞ°Ğ·Ğ°Ğ»Ğ° ĞºĞ¾Ğ³Ğ´Ğ° ÑƒĞ²Ğ¸Ğ´ĞµĞ»Ğ° ChatGPT ğŸ’€',
    'Ğ Ğ²Ğ°ÑˆĞ¸ Ñ€Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ¸ Ğ·Ğ½Ğ°ÑÑ‚ Ñ‡Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ AI? Ğ Ğ°ÑÑĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ ğŸ‘‡',
  ],
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': [
    'Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñƒ Ğ²Ğ°Ñ Ğ¼Ğ¾Ğ»Ğ¾ĞºĞ¾ ÑÑ‚Ğ¾Ğ¸Ñ‚? Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ¼ ğŸ‘‡ğŸ’€',
    '{A} Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ¸Ğ»Ğ¸ Ğ¼Ñ‹ ÑƒĞ¶Ğµ Ğ¿Ñ€Ğ¸Ğ²Ñ‹ĞºĞ»Ğ¸? ğŸ¤”',
    'ĞŸĞ¾Ğ¼Ğ½Ğ¸Ñ‚Ğµ ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑÑ‚Ğ¾Ğ¸Ğ» Ñ…Ğ»ĞµĞ± 10 Ğ»ĞµÑ‚ Ğ½Ğ°Ğ·Ğ°Ğ´? ğŸ˜­',
    'Ğ£ ĞºĞ¾Ğ³Ğ¾ ĞµÑ‰Ñ‘ ÑˆĞ¾Ğº Ğ¾Ñ‚ Ñ†ĞµĞ½ Ğ² 2026? ğŸ‘‡',
  ],
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': [
    '{B} Ğ¿Ñ€Ğ°Ğ²? Ğ˜Ğ»Ğ¸ ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ°? ğŸ¤”',
    'Ğ”ĞµĞ²Ğ¾Ñ‡ĞºĞ¸, Ğ²Ğ°Ñˆ Ñ‚Ğ°Ğº Ğ¶Ğµ Ğ¿Ğ¸ÑˆĞµÑ‚? ğŸ‘‡ğŸ˜‚',
    'ĞšÑ‚Ğ¾ ÑĞ¾Ğ³Ğ»Ğ°ÑĞµĞ½ Ñ {B} â€” Ğ»Ğ°Ğ¹Ğº, ĞºÑ‚Ğ¾ Ñ {A} â€” ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ ğŸ‘‡',
    'ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ ÑÑ‚Ğ¾ ÑĞ²Ğ¾ĞµĞ¼Ñƒ Ğ¿Ğ°Ñ€Ğ½Ñ â€” Ğ¸ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ ĞµĞ³Ğ¾ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ ğŸ’€',
  ],
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': [
    'Ğ’Ñ‹ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ {A} Ğ¸Ğ»Ğ¸ {B}? ğŸ¤” Ğ§ĞµÑÑ‚Ğ½Ğ¾!',
    'ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞµ Ğ¸ ÑĞ½Ğ¸Ğ¼Ğ¸Ñ‚Ğµ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ ğŸ“±ğŸ‘‡',
    'Ğ—ÑƒĞ¼ĞµÑ€Ñ‹ vs Ğ±ÑƒĞ¼ĞµÑ€Ñ‹ â€” Ğ²ĞµÑ‡Ğ½Ğ°Ñ Ğ±Ğ¸Ñ‚Ğ²Ğ°. ĞšÑ‚Ğ¾ Ğ¿Ñ€Ğ°Ğ²? ğŸ‘‡',
    'ĞœĞ¾Ñ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞ° ÑĞºĞ°Ğ·Ğ°Ğ»Ğ° Ñ‚Ğ¾ Ğ¶Ğµ ÑĞ°Ğ¼Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ Ğ² ÑĞ»Ğ¾Ğ²Ğ¾ ğŸ’€',
  ],
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': [
    'Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ‹ Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚Ğµ Ğ·Ğ° ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºÑƒ? Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ¼ ğŸ‘‡ğŸ’€',
    '{A} Ğ¿Ñ€Ğ°Ğ²Ğ°, Ğ¸ Ğ²Ñ‹ ÑÑ‚Ğ¾ Ğ·Ğ½Ğ°ĞµÑ‚Ğµ ğŸ˜¤',
    'Ğ£ ĞºĞ¾Ğ³Ğ¾ Ğ±Ğ°Ñ‚Ğ°Ñ€ĞµĞ¸ Ñ‚Ğ¾Ğ¶Ğµ Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ½Ñ‹Ğµ? ğŸ‘‡ğŸ¥¶',
    'ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ ÑÑƒĞ¼Ğ¼Ñƒ Ğ²Ğ°ÑˆĞµĞ¹ ĞºĞ²Ğ¸Ñ‚Ğ°Ğ½Ñ†Ğ¸Ğ¸ â€” ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ¼ ĞºÑ‚Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ÑÑ‚Ñ€Ğ°Ğ´Ğ°ĞµÑ‚ ğŸ’€',
  ],
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': [
    'Ğ’Ğ°Ğ¼ Ñ‚Ğ¾Ğ¶Ğµ Ñ‚Ğ°Ğº Ğ²Ñ€Ğ°Ñ‡ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ğ»? ğŸ‘‡ğŸ˜‚',
    '{B} Ğ¶Ñ‘ÑÑ‚ĞºĞ¾, Ğ½Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ° Ğ¶Ğµ? ğŸ’€',
    'Ğ£ ĞºĞ¾Ğ³Ğ¾ Ğ±Ñ‹Ğ»Ğ¸ Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹ Ğ² Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞµ? Ğ Ğ°ÑÑĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ ğŸ‘‡',
    'Ğ“ÑƒĞ³Ğ»Ğ¸Ñ‚Ğµ ÑĞ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ñ‹ Ğ¸Ğ»Ğ¸ Ğ¸Ğ´Ñ‘Ñ‚Ğµ Ğº Ğ²Ñ€Ğ°Ñ‡Ñƒ? Ğ§ĞµÑÑ‚Ğ½Ğ¾ ğŸ¤”',
  ],
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': [
    'Ğ£ ĞºĞ¾Ğ³Ğ¾ Ñ€ĞµĞ±Ñ‘Ğ½Ğ¾Ğº Ñ‚Ğ¾Ğ¶Ğµ Â«ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚-Ğ¼ĞµĞ¹ĞºĞµÑ€Â»? ğŸ‘‡ğŸ˜‚',
    '{B} Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ° Ğ¸Ğ»Ğ¸ Ğ¶Ñ‘ÑÑ‚ĞºĞ¾? ğŸ¤”',
    'Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ² Ğ´ĞµĞ½ÑŒ ÑĞ¸Ğ´Ğ¸Ñ‚Ğµ Ğ² Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğµ? Ğ§ĞµÑÑ‚Ğ½Ğ¾ ğŸ‘‡',
    'Ğ‘Ğ»Ğ¾Ğ³ĞµÑ€Ñ‹ â€” ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ğ¸Ğ»Ğ¸ Ğ½ĞµÑ‚? ĞŸĞ¾Ğ³Ğ½Ğ°Ğ»Ğ¸ ÑĞ¿Ğ¾Ñ€Ğ¸Ñ‚ÑŒ ğŸ‘‡ğŸ”¥',
  ],
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': [
    'Ğ£ ĞºĞ¾Ğ³Ğ¾ ÑĞ¾ÑĞµĞ´Ğ¸ Ñ‚Ğ¾Ğ¶Ğµ Ñ‚Ğ°ĞºĞ¸Ğµ? ğŸ‘‡ğŸ˜‚',
    'Ğ’Ğ°Ñˆ ÑƒÑ€Ğ¾Ğ¶Ğ°Ğ¹ Ğ² ÑÑ‚Ğ¾Ğ¼ Ğ³Ğ¾Ğ´Ñƒ â€” Ğ¾Ñ†ĞµĞ½Ğ¸Ñ‚Ğµ Ğ¾Ñ‚ 1 Ğ´Ğ¾ 10 ğŸ…',
    '{A} Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ñ‚Ğ°Ğº Ğ¿ĞµÑ€ĞµĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ·Ğ° Ğ¿Ğ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€Ñ‹? Ğ Ğ²Ñ‹? ğŸ‘‡',
    'Ğ”Ğ°Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ¿Ğ¾Ğ¹Ğ¼ÑƒÑ‚. ĞšÑ‚Ğ¾ Ğ½Ğµ Ğ´Ğ°Ñ‡Ğ½Ğ¸Ğº â€” Ğ½Ğµ Ğ¿Ğ¾Ğ¹Ğ¼Ñ‘Ñ‚ ğŸ¤·â€â™‚ï¸',
  ],
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': [
    'Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ‹ ÑÑ‚Ğ¾Ğ¸Ñ‚Ğµ Ğ² Ğ¿Ñ€Ğ¾Ğ±ĞºĞ°Ñ… Ğ² Ğ´ĞµĞ½ÑŒ? ğŸ‘‡â°',
    '{B} Ğ¿Ñ€Ğ°Ğ² â€” ÑĞ°Ğ¼Ğ¾ĞºĞ°Ñ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ? ğŸ¤”',
    'Ğ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ¸ vs Ğ¿ĞµÑˆĞµÑ…Ğ¾Ğ´Ñ‹ â€” ĞºÑ‚Ğ¾ ÑÑ‚Ñ€Ğ°Ğ´Ğ°ĞµÑ‚ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ? ğŸ‘‡',
    'ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ ÑĞ²Ğ¾Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸ Ğ² Ñ‡Ğ°ÑĞ°Ñ… ğŸ’€',
  ],
};

// â”€â”€â”€ DEMO DIALOGUES (TIMING-SAFE) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Rules: A = 5-7 words, 0-1 pause | B = 5-8 words, 0-1 pause
// At slow(2.0 WPS): 7w = 3.5s â†’ over A(2.8s), so slow chars need â‰¤5w
// At normal(2.5 WPS): 7w/2.5 = 2.8s âœ“ | 8w/2.5 = 3.2s âœ“ for B
// At fast(3.0 WPS): 7w/3.0 = 2.33s âœ“ | 8w/3.0 = 2.67s âœ“
// Max 1 pause(+0.3s) per line. Total speech must fit 6.3s (A+B windows)
const DEMO_DIALOGUES = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': {
    A_lines: ['Ğ¥Ğ»ĞµĞ± Ñ‚ĞµĞ¿ĞµÑ€ÑŒ ĞšĞ’ĞĞ”Ğ ĞĞ¢ĞĞ«Ğ™! ĞšĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğ¹!', 'ĞŸÑƒĞ»ÑŒÑ‚ Ğ¾Ğ¿ÑÑ‚ÑŒ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ»Ğ°! Ğ¢Ñ€ĞµÑ‚Ğ¸Ğ¹ Ñ€Ğ°Ğ·!'],
    B_lines: ['Ğ—ĞµĞ¼Ğ»Ñ Ñ‚Ğ¾Ğ¶Ğµ Ğ½Ğµ ĞºÑ€ÑƒĞ³Ğ»Ğ°Ñ | Ğ¶Ğ¸Ğ²Ñ‘ÑˆÑŒ.', 'Ğ¥Ğ²Ğ°Ñ‚Ğ¸Ñ‚ ĞºĞ»Ğ°ÑÑ‚ÑŒ ĞµĞ³Ğ¾ Ğ² Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ¸Ğ»ÑŒĞ½Ğ¸Ğº.'],
    killer_word: 'Ğ¶Ğ¸Ğ²Ñ‘ÑˆÑŒ'
  },
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': {
    A_lines: ['Ğ¢Ğ²Ğ¾Ğ¹ Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ Ğ¼Ğ½Ğµ Ğ±Ğ¾Ñ€Ñ‰ ÑĞ²Ğ°Ñ€Ğ¸Ñ‚?!', 'ĞĞ½Ğ° Ñ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ¾Ğ¼ ĞºĞ°Ğº Ñ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ¾Ğ¼!'],
    B_lines: ['ĞĞ½ ÑƒĞ¶Ğµ Ğ²Ğ½ÑƒĞºĞ¾Ğ² Ğ²Ğ¾ÑĞ¿Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ | Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¸Ğ»Ğ°?', 'Ğ Ñ‚Ñ‹ Ñ Ñ‚ĞµĞ»ĞµĞ²Ğ¸Ğ·Ğ¾Ñ€Ğ¾Ğ¼ Ñ‚Ñ€Ğ¸Ğ´Ñ†Ğ°Ñ‚ÑŒ Ğ»ĞµÑ‚.'],
    killer_word: 'Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¸Ğ»Ğ°'
  },
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': {
    A_lines: ['ĞœĞ¾Ğ»Ğ¾ĞºĞ¾! Ğ’Ğ¾ÑĞµĞ¼ÑŒÑĞ¾Ñ‚ Ñ€ÑƒĞ±Ğ»ĞµĞ¹! ĞœĞĞ›ĞĞšĞ!', 'Ğ¯Ğ¹Ñ†Ğ° Ğ¿Ğ¾ Ñ‚Ñ€Ğ¸ÑÑ‚Ğ°! Ğ”ĞµÑÑÑ‚Ğ¾Ğº! Ğ¯Ğ™Ğ¦Ğ!'],
    B_lines: ['Ğ’ Ğ´ĞµĞ²ÑĞ½Ğ¾ÑÑ‚Ğ¾ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ¼ Ñ Ğ¼Ğ°ÑˆĞ¸Ğ½Ñƒ ĞºÑƒĞ¿Ğ¸Ğ».', 'ĞšÑƒÑ€Ğ¸Ñ†Ğ° Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ¶Ğ¸Ğ²Ñ‘Ñ‚ Ğ»ÑƒÑ‡ÑˆĞµ Ğ¿ĞµĞ½ÑĞ¸Ğ¾Ğ½ĞµÑ€Ğ°.'],
    killer_word: 'Ğ¼Ğ°ÑˆĞ¸Ğ½Ñƒ'
  },
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': {
    A_lines: ['ĞĞ½ Ğ¿Ğ¸ÑˆĞµÑ‚ Â«Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ ĞºĞ°Ğº Ğ´ĞµĞ»Ğ°Â» | ÑƒÑ…Ğ°Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ?!', 'ĞœÑƒĞ¶ Ğ¿ÑÑ‚ÑŒ Ğ»ĞµÑ‚ Â«Ñ‚Ñ‹ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°ÑÂ»!'],
    B_lines: ['Ğ Ğ°Ğ½ÑŒÑˆĞµ Ğ¼ÑƒĞ¶Ğ¸Ğº Ğ·Ğ°Ğ±Ğ¾Ñ€ Ñ‡Ğ¸Ğ½Ğ¸Ğ» | Ğ»ÑĞ±Ğ¾Ğ²ÑŒ.', 'Ğ—Ğ½Ğ°Ñ‡Ğ¸Ñ‚ Ğ´Ğ°Ğ²Ğ½Ğ¾ ÑĞ´Ğ°Ğ»ÑÑ Ğ¸ ÑĞ¿Ğ¸Ñ‚ ÑĞ¿Ğ¾ĞºĞ¾Ğ¹Ğ½Ğ¾.'],
    killer_word: 'Ğ»ÑĞ±Ğ¾Ğ²ÑŒ'
  },
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': {
    A_lines: ['Ğ’Ğ½ÑƒÑ‡ĞºĞ° Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Â«ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚-Ğ¼ĞµĞ¹ĞºĞµÑ€Â» | Ñ‡Ñ‘?!', 'Ğ’Ğ½ÑƒĞº Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ Â«Ğ¾Ğº Ğ±ÑƒĞ¼ĞµÑ€Â» | Ğ±ÑƒĞ¼ĞµÑ€?!'],
    B_lines: ['Ğ—Ğ½Ğ°Ñ‡Ğ¸Ñ‚ Ñ‚Ğ¾Ğ¶Ğµ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ´ĞµĞ»Ğ°ĞµÑ‚ | Ñ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ¾Ğ¼.', 'Ğ‘ÑƒĞ¼ĞµÑ€ Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾Ğ¸Ğ» Ğ´Ğ¾Ğ¼ | Ğ³Ğ´Ğµ Ñ‚Ğ²Ğ¾Ğ¹ Ğ²Ğ°Ğ¹Ñ„Ğ°Ğ¹.'],
    killer_word: 'Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ¾Ğ¼'
  },
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': {
    A_lines: ['ĞÑ‚Ğ¾Ğ¿Ğ»ĞµĞ½Ğ¸Ğµ ÑˆĞµÑÑ‚ÑŒ Ñ‚Ñ‹Ñ‰ | Ğ±Ğ°Ñ‚Ğ°Ñ€ĞµÑ Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ½Ğ°Ñ!', 'Ğ›Ğ¸Ñ„Ñ‚ Ğ¾Ğ¿ÑÑ‚ÑŒ ÑĞ´Ğ¾Ñ…! Ğ¨ĞµÑÑ‚Ğ¾Ğ¹ ÑÑ‚Ğ°Ğ¶ Ğ¿ĞµÑˆĞºĞ¾Ğ¼!'],
    B_lines: ['Ğ—Ğ°Ñ‚Ğ¾ Ğ´ÑƒÑˆÑƒ Ñ‚ĞµĞ±Ğµ Ğ´Ğ°Ğ²Ğ½Ğ¾ Ğ½Ğ°Ñ‚Ğ¾Ğ¿Ğ¸Ğ»Ğ¸.', 'Ğ—Ğ°Ñ‚Ğ¾ Ğ½Ğ¾Ğ³Ğ¸ ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğµ | Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ñ„Ğ¸Ñ‚Ğ½ĞµÑ.'],
    killer_word: 'Ğ½Ğ°Ñ‚Ğ¾Ğ¿Ğ¸Ğ»Ğ¸'
  },
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': {
    A_lines: ['Ğ’Ñ€Ğ°Ñ‡ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ Ğ“Ğ£Ğ“Ğ›Ğ˜Ğ¢Ğ•! Ğ¡ĞµÑ€ÑŒÑ‘Ğ·Ğ½Ğ¾?!', 'Ğš Ğ²Ñ€Ğ°Ñ‡Ñƒ Ñ‡ĞµÑ€ĞµĞ· Ñ‚Ñ€Ğ¸ Ğ½ĞµĞ´ĞµĞ»Ğ¸ | Ğ²Ñ‹Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ĞµÑ!'],
    B_lines: ['Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾ Ğ½Ğµ ÑĞºĞ°Ğ·Ğ°Ğ» ÑĞ¿Ñ€Ğ¾ÑĞ¸ Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚ÑŒ | Ğ¿Ğ¾Ñ…Ğ¾Ñ€Ğ¾Ğ½Ğ¸Ñ‚.', 'Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ | ÑĞºĞ¾Ğ½Ğ¾Ğ¼ÑÑ‚ Ğ½Ğ° Ğ»ĞµĞºĞ°Ñ€ÑÑ‚Ğ²Ğ°Ñ….'],
    killer_word: 'Ğ¿Ğ¾Ñ…Ğ¾Ñ€Ğ¾Ğ½Ğ¸Ñ‚'
  },
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': {
    A_lines: ['ĞœĞ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ² | Ğ° Ğ¿Ğ¾ÑÑƒĞ´Ñƒ Ğ½Ğµ Ğ¼Ğ¾ĞµÑ‚!', 'ĞĞ½Ğ° ĞµĞ´Ñƒ Ñ‡Ğ°Ñ Ñ„Ğ¾Ñ‚ĞºĞ°ĞµÑ‚! Ğ¡ÑƒĞ¿ Ğ¾ÑÑ‚Ñ‹Ğ»!'],
    B_lines: ['ĞœĞ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½ ÑĞ¼Ğ¾Ñ‚Ñ€ÑÑ‚ ĞºĞ°Ğº Ğ½Ğµ Ğ¼Ğ¾ĞµÑ‚ | Ğ»Ğ°Ğ¹ĞºĞ°ÑÑ‚.', 'Ğ—Ğ°Ñ‚Ğ¾ Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½ Ğ·Ğ½Ğ°ÑÑ‚ Ñ‡Ñ‚Ğ¾ Ñ‚Ñ‹ Ğ²Ğ°Ñ€Ğ¸ÑˆÑŒ.'],
    killer_word: 'Ğ»Ğ°Ğ¹ĞºĞ°ÑÑ‚'
  },
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': {
    A_lines: ['ĞŸĞ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€Ñ‹ ÑĞ¾Ğ¶Ñ€Ğ°Ğ»Ğ¸! Ğ’ÑĞµ Ğ´Ğ¾ ĞµĞ´Ğ¸Ğ½Ğ¾Ğ³Ğ¾!', 'Ğ¡Ğ¾ÑĞµĞ´ Ğ·Ğ°Ğ±Ğ¾Ñ€ Ğ½Ğ° Ğ´Ğ²Ğ°Ğ´Ñ†Ğ°Ñ‚ÑŒ ÑĞ°Ğ½Ñ‚Ğ¸Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²!'],
    B_lines: ['ĞœĞ¸Ñ…Ğ°Ğ»Ñ‹Ñ‡ Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ²ĞµĞ³Ğ°Ğ½ | ĞµĞ¼Ñƒ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¾.', 'Ğ­Ñ‚Ğ¾ ĞµĞ³Ğ¾ ÑĞ¾Ğ²ĞµÑÑ‚ÑŒ Ñ€Ğ°ÑÑ‚Ñ‘Ñ‚ Ğ² Ğ½Ğ°ÑˆÑƒ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñƒ.'],
    killer_word: 'Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¾'
  },
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': {
    A_lines: ['Ğ”Ğ²Ğ° Ñ‡Ğ°ÑĞ° ÑÑ‚Ğ¾ÑĞ»Ğ°! Ğ¡Ğ°Ğ¼Ğ¾ĞºĞ°Ñ‚ Ğ¾Ğ±Ğ¾Ğ³Ğ½Ğ°Ğ»!', 'Ğ”Ğ²ĞµÑÑ‚Ğ¸ Ñ€ÑƒĞ±Ğ»ĞµĞ¹ Ğ·Ğ° Ğ¿ÑÑ‚ÑŒÑĞ¾Ñ‚ Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²!'],
    B_lines: ['Ğ¡Ğ°Ğ¼Ğ¾ĞºĞ°Ñ‚ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ³Ğ¾ | Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ³Ğ¾.', 'Ğ—Ğ°Ñ‚Ğ¾ Ğ´Ğ¾Ğ²Ñ‘Ğ· | Ğ·Ğ° Ğ¿ÑÑ‚ÑŒÑĞ¾Ñ‚ Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ² Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğº Ğ½ĞµÑ‚.'],
    killer_word: 'Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ³Ğ¾'
  },
};

// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function seededRandom(seed) {
  let h = 0;
  for (let i = 0; i < seed.length; i++) { h = ((h << 5) - h + seed.charCodeAt(i)) | 0; }
  return () => { h = (h * 16807 + 0) % 2147483647; return (h & 0x7fffffff) / 2147483647; };
}

function pickRandom(arr, rng) { return arr[Math.floor(rng() * arr.length)]; }
function pickN(arr, n, rng) {
  const copy = [...arr];
  const result = [];
  for (let i = 0; i < Math.min(n, copy.length); i++) {
    const idx = Math.floor(rng() * copy.length);
    result.push(copy.splice(idx, 1)[0]);
  }
  return result;
}

// â”€â”€â”€ ENGAGEMENT BUILDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildEngagement(catRu, charA, charB, rng) {
  const nameA = charA.name_ru;
  const nameB = charB.name_ru;
  const fill = (s) => s.replace(/\{A\}/g, nameA).replace(/\{B\}/g, nameB);

  // â”€â”€ Hashtags: 3-layer mix â”€â”€
  const catTags = HASHTAGS_BY_CATEGORY[catRu] || HASHTAGS_BY_CATEGORY['Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´'];
  const niche = pickN(catTags.niche, 5, rng);
  const mid = pickN(catTags.mid, 4, rng);
  const big = pickN(catTags.big, 2, rng);
  const evergreen = pickN(EVERGREEN_TAGS, 3, rng);

  // ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ½Ñ‹Ğµ Ñ‚ĞµĞ³Ğ¸
  const grpA = GROUP_HASHTAGS[charA.group] || [];
  const grpB = GROUP_HASHTAGS[charB.group] || [];
  const charTags = pickN([...new Set([...grpA, ...grpB])], 3, rng);

  // Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚ĞµĞ³ ÑĞµÑ€Ğ¸Ğ¸
  const seriesTag = '#' + nameA.replace(/\s+/g, '').toLowerCase() + 'vs' + nameB.replace(/\s+/g, '').toLowerCase();

  // Ğ¡Ğ±Ğ¾Ñ€ĞºĞ°: niche(5) + mid(4) + charTags(3) + big(2) + evergreen(3) + series(1) = ~18 Ñ‚ĞµĞ³Ğ¾Ğ² (Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ IG)
  const allTags = [...niche, ...mid, ...charTags, ...big, ...evergreen, seriesTag];
  // Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
  const hashtags = [...new Set(allTags)].slice(0, 25);

  // â”€â”€ Viral title â”€â”€
  const titlePool = VIRAL_TITLES[catRu] || VIRAL_TITLES['Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´'];
  const viralTitle = fill(pickRandom(titlePool, rng));

  // â”€â”€ Pin comment â”€â”€
  const pinPool = PIN_COMMENTS[catRu] || PIN_COMMENTS['Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´'];
  const pinComment = fill(pickRandom(pinPool, rng));

  // â”€â”€ First comment (Ğ´Ğ»Ñ Ğ²Ğ¾Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ) â”€â”€
  const fcPool = FIRST_COMMENTS[catRu] || FIRST_COMMENTS['Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´'];
  const firstComment = fill(pickRandom(fcPool, rng));

  return { hashtags, viralTitle, pinComment, firstComment, seriesTag };
}

// â”€â”€â”€ UNIVERSAL ROLE ADAPTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Maps any character pair to A/B roles based on their data.
// A = more expressive/provocative; B = more grounded/rational.
// User manual assignment (role_default) takes priority.
function resolveRoles(charA, charB) {
  // If user explicitly assigned roles, respect that
  if (charA.role_default === 'A' && charB.role_default === 'B') return { A: charA, B: charB };
  if (charA.role_default === 'B' && charB.role_default === 'A') return { A: charB, B: charA };

  // Auto-assign: compute expressiveness score
  // Higher score â†’ role A (provocateur)
  const score = (c) => {
    let s = 0;
    if (c.speech_pace === 'fast') s += 3;
    else if (c.speech_pace === 'normal') s += 1;
    s += c.swear_level || 0;
    if (c.compatibility === 'chaotic') s += 2;
    else if (c.compatibility === 'conflict') s += 1;
    else if (c.compatibility === 'calm') s -= 2;
    if (c.role_default === 'A') s += 1;
    if (c.role_default === 'B') s -= 1;
    return s;
  };

  const scoreA = score(charA);
  const scoreB = score(charB);
  // Higher score gets role A
  if (scoreB > scoreA) return { A: charB, B: charA };
  return { A: charA, B: charB };
}

// â”€â”€â”€ CAST CONTRACT BUILDER (universal) â”€â”€â”€â”€â”€â”€â”€
function buildCastContract(charA, charB) {
  const buildBiology = (char, role) => {
    const bio = char.biology_override || {};
    const anchors = char.identity_anchors || {};
    const defaultSkin = ['deep wrinkles', 'age spots', 'visible pores', 'subtle skin sheen (not plastic)'];
    const defaultEyes = ['wet glint', 'slight sclera redness', 'micro-saccades'];
    return {
      character_en: char.prompt_tokens?.character_en || 'elderly character, hyper-realistic detail',
      age: bio.age || 'elderly',
      skin: (bio.skin_tokens || defaultSkin).join(', '),
      eyes: (bio.eye_tokens || defaultEyes).join(', '),
      mouth: role === 'A'
        ? 'realistic teeth/gums, lip moisture, lip-bite as comedic pafos-anchor (sparingly), micro saliva glints'
        : 'realistic teeth/gums, lip moisture, mouth SEALED when not speaking, jaw still',
      face_silhouette: anchors.face_silhouette || 'distinctive facial features',
      signature_element: anchors.signature_element || 'notable accessory',
      micro_gesture: anchors.micro_gesture || 'subtle expression change',
      wardrobe_anchor: anchors.wardrobe_anchor || 'distinctive clothing piece',
      vibe: char.vibe_archetype || (role === 'A' ? 'Ğ¿Ñ€Ğ¾Ğ²Ğ¾ĞºĞ°Ñ‚Ğ¾Ñ€' : 'Ğ±Ğ°Ğ·Ğ°'),
    };
  };
  return {
    speaker_A: buildBiology(charA, 'A'),
    speaker_B: buildBiology(charB, 'B'),
    relationship: 'BAND â€” insults target SITUATION only, never each other',
  };
}

// â”€â”€â”€ CAMERA & REALISM PRESET (v2) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildCameraPreset() {
  return {
    pov: 'held at arm\'s length, front-facing portrait look, device INVISIBLE',
    distance: 'close enough to read skin microtexture, both faces in frame',
    artifacts: [
      'handheld micro-jitter',
      'subtle exposure breathing',
      'mild rolling shutter only on quick micro-moves',
      'brief autofocus hunt â‰¤0.15s on lens approach',
    ],
    realism_anchors: [
      'slight sensor noise',
      'mild compression artifacts',
      'imperfect white balance drift',
      'micro motion blur on sharp gesture (finger/slap)',
      'realistic shadowing under nose/cheekbones',
    ],
  };
}

// â”€â”€â”€ CINEMATOGRAPHY CONTRACT (12 production pillars) â”€â”€â”€
// Everything the user does NOT choose â€” Gemini decides using this contract.
// Calibrated for SMARTPHONE FRONT-CAMERA realism â€” the gold standard is "indistinguishable from a real selfie video".
function buildCinematography(lightingMood, location, wardrobeA, wardrobeB, charA, charB, hookObj, releaseObj, propAnchor) {
  return {
    // â”€â”€ 1. LIGHTING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    lighting: {
      directive: 'Lighting is the single biggest realism factor. REAL smartphone footage has ONE dominant environmental source + ambient fill. No studio lights exist in this world.',
      primary_source: lightingMood.style,
      mood: lightingMood.mood,
      source_count: lightingMood.sources || 'One dominant source + one soft fill bounce from environment. Never more than two. NEVER ring light or studio softbox.',
      source_direction: lightingMood.direction || 'Key light from environment (window/lamp/overhead); fill is indirect bounce from nearest wall/ceiling.',
      shadow_quality: lightingMood.shadow_softness || 'Soft but PRESENT shadows under nose, cheekbones, chin, brow ridge. Shadow edges 15-25% feathered â€” NOT razor-sharp, NOT invisible.',
      skin_highlights: lightingMood.overexposure_budget || 'Allow +0.5 EV overexposure on skin highlights (forehead, nose bridge). This is NORMAL for smartphone sensors â€” do NOT flatten. Slight specular sheen on T-zone (oily skin).',
      color_temperature: lightingMood.color_temp || 'Lock WB to dominant source. Indoor warm: 3200-3800K. Fluorescent: 4500-5000K. Daylight: 5500-6000K.',
      smartphone_behavior: 'Phone auto-exposure targets faces â†’ background may clip or crush. This is CORRECT behavior. Slight exposure hunting (Â±0.2 EV drift over 8s) is realistic. Face brightness should be ~70% histogram.',
      consistency: 'Light direction and color temp MUST NOT change during 8 seconds. Intensity may drift Â±5% (clouds, flickering fluorescent). No sudden jumps.',
      forbidden: 'No flat frontal beauty lighting, no ring light catch-lights, no studio rim/hair light, no colored RGB gels, no dual-key setups, no perfectly even illumination.',
    },

    // â”€â”€ 2. OPTICS & DISTANCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    optics: {
      directive: 'This is a SMARTPHONE FRONT CAMERA, not a cinema camera. The optical signature must match: wide-angle close-up with computational bokeh.',
      focal_length: '24-28mm equivalent (smartphone front camera native). Slight wide-angle barrel distortion on edges is CORRECT and expected. Faces at center are relatively undistorted.',
      aperture: 'f/1.9-f/2.2 physical aperture (phone sensor). Computational portrait mode adds bokeh to background â€” result is sharp faces with 15-25% gaussian-ish background blur. NOT cinema bokeh (no hexagonal highlights).',
      distance_to_subject: '35-60cm from lens to face (arm\'s length selfie distance). Close enough to see individual pores, far enough for two faces without extreme fish-eye.',
      depth_of_field: 'Smartphone DOF: both faces sharp (they\'re roughly in the same plane at 35-60cm). Background separates via computational blur starting ~30cm behind subjects. Bokeh is slightly artificial/smooth â€” this is CORRECT for phones.',
      sensor_signature: 'Small smartphone sensor: visible luminance noise in shadows (ISO 400-1600 equivalent), slight color noise in dark areas, limited dynamic range (10-12 stops), JPEG compression artifacts at 85-92% quality.',
      lens_flaws: 'Slight purple fringing on high-contrast edges (backlight). Minor chromatic aberration in corners. Faint lens flare if strong light source in frame. These imperfections = authenticity.',
      series_lock: 'EVERY episode uses the same phone-camera look. Same focal length, same distance, same computational bokeh style. This is the visual fingerprint.',
    },

    // â”€â”€ 3. CAMERA MOVEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    camera_movement: {
      directive: 'One person holds a phone at arm\'s length. This creates specific motion: hand tremor, breathing oscillation, weight shift drift. NOT smooth, NOT static, NOT gimbal.',
      base_motion: 'Constant micro-jitter: 0.8-2px random drift at 2-5Hz. This is hand tremor + breathing + pulse. Slightly more on Y-axis (vertical) than X. NEVER perfectly still for >0.3s.',
      breathing_oscillation: 'Slow 0.3-0.5px vertical oscillation at 0.25-0.33Hz (15-20 breaths/min). The holder breathes â€” camera rises and falls slightly with chest.',
      hook_motion: '0.0-0.8s: slight push-in (arm extends, 2-3% scale increase) + micro-rotation as holder adjusts grip. Phone OIS may kick in â€” brief stabilization artifact.',
      act_A_motion: '0.8-3.6s: subtle drift toward A (holder naturally tracks the speaker). 0.5-1Â° rotation over 2.8s. Jitter increases slightly as A gets animated.',
      act_B_motion: '3.6-7.1s: micro-reframe toward B. Possible brief 0.1s autofocus hunt as phone re-acquires B\'s face. Slight pull-back (holder unconsciously leans back from B\'s intensity).',
      release_motion: '7.1-8.0s: camera shakes 3-6px at 6-10Hz from laughter body tremor. Brief phone tilt (5-8Â°) as holder loses composure. Partial stabilization from OIS fights the shake.',
      stabilization_artifacts: 'Phone OIS/EIS creates slight "jello" wobble on fast movements. Rolling shutter visible on quick jerks (vertical lines lean 2-3Â°). These are MARKERS of real phone footage.',
      forbidden: 'No smooth dolly/crane/gimbal moves. No rack focus pulls. No cinematic camera work. No perfectly static tripod shots. No drone. This is a HAND holding a PHONE.',
    },

    // â”€â”€ 4. MICRO-MOVEMENT TEMPO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    micro_movements: {
      directive: 'ALIVE vs MANNEQUIN. Real people NEVER stop moving. Every 0.5-1.5 seconds, something changes â€” blink, breath, twitch, shift. Absence of micro-movement is the #1 AI tell.',
      blink_rate: 'Natural blink: every 3-5s baseline. During heated speech: every 2-3s. Hard blinks on emphasis words. Listening character: slower 4-6s blinks. NEVER unblinking >5s. Both lids close simultaneously, 100-200ms duration.',
      breathing: 'Visible chest/shoulder rise every 3-4s. Speaking: breathing syncs with pauses (inhale between phrases, exhale on first word). Listening: slow steady rhythm. Deep preparation inhale 0.3s before their turn.',
      head_micro_turns: 'Tiny 1-3Â° tilts/rotations every 2-4s. Speaking character: animated 5-10Â° range, nods for emphasis, head follows gesture direction. Listening: minimal, weighted nods on key words, slight skeptical head-cock.',
      facial_micro_expressions: 'Every 1-2 seconds SOMETHING fires: eyebrow micro-raise (1-2mm), nostril flare on emphasis, jaw clench/release, lip corner twitch, cheek muscle pulse, forehead furrow shift. These are INVOLUNTARY and asymmetric.',
      weight_shifts: 'Body weight shifts every 4-6s. Shoulder adjustments. Finger movements if gesturing (fidgeting when listening). Clothing responds to movement (sleeve shifts, collar adjusts). Weight on one foot then other.',
      hand_micro_movements: 'Hands NEVER frozen: gesturing (speaker), fidgeting/adjusting (listener), finger curling/uncurling, rubbing thumb against finger, adjusting glasses/hair/collar. At minimum one hand movement every 3-5s.',
      asymmetry_rule: 'LEFT and RIGHT sides of face/body move INDEPENDENTLY. One eyebrow higher. One shoulder slightly forward. One hand active while other rests. Symmetry = artificial.',
      forbidden: 'No mannequin freeze (>1.5s without ANY visible movement anywhere on body). No hyperactive puppet twitching. No mirror-symmetry between characters. No synchronized movements (they are NOT choreographed).',
    },

    // â”€â”€ 5. FACE & LIP STABILITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    face_stability: {
      directive: 'Mouth ALWAYS visible and unobstructed. This is the #1 prerequisite for believable lip-sync. If mouth is hidden/turned â†’ illusion breaks.',
      mouth_visibility: 'CRITICAL: Lower face (mouth, chin, jaw) in frame and unobstructed for 100% of video. No hand over mouth except brief gesture (<0.3s). No hair/scarf/collar covering lips. No prop blocking jaw.',
      head_rotation_limit: 'Maximum 25Â° yaw from camera at any time. During active speech: keep within 15Â° of front-facing. Beyond 25Â°: far-side lips invisible â†’ lip-sync catastrophe.',
      head_tilt_limit: 'Maximum 10Â° roll (head tilt). Maximum 15Â° pitch (nod). Combined rotation budget: sqrt(yawÂ² + rollÂ² + pitchÂ²) < 30Â°. Head must feel MOBILE but never turn away.',
      hair_and_accessories: 'No bangs/fringe over lips. No thick mustache obscuring lip line (if character has mustache: trimmed clear of lip edge). No sunglasses blocking eye area. Glasses: clear lenses only, frame above mouth.',
      jaw_tracking: 'Every Russian syllable = visible jaw movement. Consonants Ñ‚/Ğ´/Ğ¿/Ğ±/Ğ¼/Ğ½ = clear lip closure/contact. Vowels Ğ°/Ğ¾/Ñƒ = proportional jaw opening (Ğ° = wide, Ñƒ = pursed). Speed matches speech pace. Jaw moves DOWN, not just lips moving.',
      non_speaking_mouth: 'NOT speaking = mouth FIRMLY SEALED. Jaw immobile. Lips softly pressed. NO phantom movements, NO mouthing along, NO chewing, NO lip-licking (unless character-motivated brief moment). ONLY subtle lip-pressure changes from emotion.',
      front_camera_face_lock: 'Phone front camera has face-tracking AF. Face should always be the sharpest element. If head moves, focus follows with 50-100ms lag (realistic AF tracking delay).',
    },

    // â”€â”€ 6. EYES & GAZE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    gaze: {
      directive: 'Eyes create the hypnotic connection. In selfie video, "looking at camera" = "looking into viewer\'s eyes". This is the most powerful retention tool.',
      hook_gaze: '0.0-0.8s: A locks DIRECT EYE CONTACT with camera lens. Pupil-to-lens alignment. Challenging, urgent, pulling viewer in. This triggers primal "someone is staring at me" response. STRONGEST hook possible.',
      act_A_gaze: '0.8-3.6s: A maintains 70% camera contact (speaking TO viewer), 30% quick glances at B (acknowledging opponent). Gaze breaks are FAST (0.2-0.4s) then back to camera. B: side-eye at A (60%), occasional slow blink, pupils tracking A\'s gestures.',
      act_B_gaze: '3.6-7.1s: B locks camera (80% direct) for punchline delivery â€” "I\'m telling YOU this". On killer word: maximum eye intensity, slight squint. A: eyes progressively widen (shock), dart between B and camera at 2-3Hz (processing what B said).',
      release_gaze: '7.1-8.0s: gaze releases â€” both look at each other (warm recognition), then one or both glance back at camera with laugh-crinkled eyes. This "shared moment caught on camera" feeling.',
      pupil_detail: 'Pupils: 3-5mm diameter (adjusting to light). Visible catch-light from dominant light source (window = rectangular, bulb = round). Wet glint on sclera. Thin red vessels visible at 35cm. Iris texture visible.',
      micro_saccades: 'Tiny rapid eye movements every 0.5-1.5s â€” eyes NEVER perfectly still. These 0.5-1Â° micro-jumps are involuntary and are the single biggest "alive eyes" signal. Without them, eyes look like glass.',
      smartphone_eye_contact: 'Front camera is 2-5cm ABOVE the screen. True "camera eye contact" means looking slightly UP. Most people look at screen (their own face) â†’ gaze is 2-3Â° below lens. Mix both: 60% at lens (contact), 40% at screen (natural).',
      forbidden: 'No dead fixed stare (>2s without any eye movement). No cross-eyed. No rolled-back eyes. No simultaneous identical eye movements. No perfectly centered pupils (natural resting gaze drifts).',
    },

    // â”€â”€ 7. FRAME CLEANLINESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    frame_cleanliness: {
      directive: 'Real selfie video has 3-5 clear elements: faces, clothes, one object, blurred background. Not a production design showcase â€” a person\'s actual environment.',
      foreground: 'Characters occupy 60-70% of vertical frame. Nothing between camera and faces except air (and possibly a gesturing hand briefly crossing frame).',
      midground: `1 prop anchor: ${propAnchor} â€” at arm\'s length behind characters, in computational bokeh blur (recognizable shape, fuzzy edges). Provides context.`,
      background: '2-3 environmental details in deep bokeh. Recognizable as shapes/colors but NOT sharp. A wall, a shelf, a window â€” NOT a detailed set. Smartphone portrait mode makes background deliberately simple.',
      headroom: '5-10% of frame above heads. Characters slightly below center (natural selfie composition â€” arm extends slightly up). No chin-crop, no forehead-crop.',
      aspect_ratio: '9:16 vertical (portrait mode). This is non-negotiable for Reels/TikTok. Characters fill the vertical frame. Horizontal detail is naturally limited by the narrow width.',
      forbidden: 'No text/logos/watermarks in frame. No phones/screens visible. No mirror reflections showing camera. No perfect production design. No more than 5 distinct visual elements total. CLUTTERED = FAKE, CLEAN = REAL.',
      detail_budget: 'Visual element cap: 2 faces + 2 wardrobe reads + 1 prop + 2 background shapes = 7 maximum. Every extra item competes with faces for attention and reduces realism.',
    },

    // â”€â”€ 8. WARDROBE & TEXTURES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    textures: {
      directive: 'Texture is the anti-AI signal. Real phone cameras at 35cm capture INDIVIDUAL THREADS of wool, WEAVE PATTERN of denim, CREASE LINES in cotton. If fabric looks smooth/flat â†’ instant AI detection.',
      wardrobe_A: wardrobeA,
      wardrobe_B: wardrobeB,
      texture_priority: 'HIERARCHY of convincing textures: hand-knit wool (best) > worn denim > real leather > corduroy > linen > cotton > polyester (worst). Choose materials high on this list. Every fabric must show its STRUCTURE at close range.',
      wrinkle_rule: 'ALL clothing has wrinkles: elbow creases, shoulder pull lines, waist bunching, collar fold memory. Freshly-ironed flat fabric = FAKE. Lived-in asymmetric creases = REAL. Deeper wrinkles cast micro-shadows.',
      skin_as_texture: 'Skin is THE most important texture. At 35-50cm phone distance: visible pores on nose/cheeks, fine lines around eyes (crow\'s feet), nasolabial folds, slight oiliness on T-zone (forehead/nose), age spots on elderly, uneven skin tone across face. NO airbrushed smooth skin EVER.',
      hair_texture: 'Individual hair strands visible at temples and hairline. Flyaway hairs catching backlight. Grey/white hair has different texture than dark. Facial hair: individual whisker direction visible. Eyebrows: individual hairs, not painted blocks.',
      surface_detail: 'Any surface in sharp focus must show texture: wood grain, paint chips, fabric weave, metal patina, glass smudges, ceramic glaze. Smooth featureless surfaces scream "CGI".',
      forbidden: 'No plastic skin. No uniform color blocks. No textureless fabrics. No perfectly smooth surfaces. No rubber/wax skin appearance. No identical skin on both characters (they are different people with different skin).',
    },

    // â”€â”€ 9. COLOR & SKIN TONE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    color_skin: {
      directive: 'Smartphone color science: slightly warm, auto-WB biased toward pleasing skin tones. The 3 deadly AI sins are orange tan, grey face, and uniform plastic tone.',
      white_balance: lightingMood.color_temp ? `Lock to: ${lightingMood.color_temp}` : 'Lock WB to dominant source. Indoor warm: 3200-3800K. Fluorescent: 4500-5000K with green shift. Daylight: 5500-6000K. Phone auto-WB may lean 200K warm to flatter skin.',
      skin_tone_A: `${charA.prompt_tokens?.character_en?.includes('dark skin') || charA.prompt_tokens?.character_en?.includes('tan') ? 'Rich warm undertone, visible warmth variation across face (redder cheeks, darker under eyes, lighter on forehead). Never ashy or grey.' : charA.prompt_tokens?.character_en?.includes('pale') ? 'Cool pink undertone, visible pink in cheeks/nose tip/ear tips, slight blue veins at temples. Never grey or uniformly white.' : 'Slavic warm undertone: slight pink in cheeks, redder nose tip in cold, lighter forehead, darker under eyes. Natural variation across face â€” NOT one uniform color.'}`,
      skin_tone_B: `${charB.prompt_tokens?.character_en?.includes('dark skin') || charB.prompt_tokens?.character_en?.includes('tan') ? 'Rich warm undertone, visible warmth variation across face. Never ashy or grey.' : charB.prompt_tokens?.character_en?.includes('pale') ? 'Cool pink undertone, visible pink in cheeks/nose/ears. Never grey or uniform.' : 'Slavic warm undertone: cheeks pinker than forehead, nose tip redder, under-eye slightly darker, ear tops flushed. Living skin has COLOR VARIATION.'}`,
      skin_zones: 'EVERY face has 5+ color zones: (1) forehead â€” lighter/oilier, (2) cheeks â€” pinker/redder, (3) nose â€” reddest/oiliest, (4) under-eye â€” slightly darker/bluer, (5) chin â€” matches forehead. These zones are DIFFERENT colors. Uniform tone = plastic = AI.',
      deadly_sins: 'THREE forbidden skin looks: (1) Orange spray-tan (#D4845B range) â€” MOST COMMON AI artifact, never ever do this. (2) Grey/blue lifeless face â€” like a corpse, no blood in skin. (3) Uniform tone â€” same exact color everywhere on face, no zone variation.',
      color_grade: 'Smartphone color: slightly warm bias (+3% orange in highlights), gentle contrast (not crushed blacks â€” phone cameras lift shadows), saturation 90-95% natural (phones slightly boost). No heavy film emulation, no teal-and-orange, no Instagram filter look.',
      consistency: 'Skin tone IDENTICAL across all 8 seconds. No sudden warmth shifts. No frame-to-frame color flicker. The only change: slight reddening in cheeks during emotional peaks (blood flow). This is realistic and welcome.',
    },

    // â”€â”€ 10. SOUND AS REALITY ANCHOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    sound_anchor: {
      directive: 'Sound is what makes the BRAIN believe the IMAGE is real. Smartphone mic signature: slightly compressed, room-reverberant, catches everything. This is NOT a studio recording.',
      room_tone: 'MANDATORY: continuous ambient sound matching location. Runs UNDER dialogue at -20 to -30dB. Real rooms NEVER have silence â€” there is always hum, wind, distant traffic, appliance drone. This is the bed everything sits on.',
      voice_volume: 'Dialogue: -6dB to -3dB peak. NATURAL dynamic range â€” louder on shouts, softer on asides, voice cracks on emotion. NO compression, NO limiter. Real speech volume varies Â±6dB within a sentence.',
      voice_proximity: 'Phone mic is 35-60cm from mouths. Voice has slight room coloring â€” NOT dry studio sound. Plosives (Ğ¿, Ğ±) may cause brief mic pop. Sibilants (Ñ, Ñˆ) slightly harsh. This is PHONE MIC character.',
      voice_room_match: 'Reverb MUST match space size. Kitchen: 0.3-0.5s RT60, hard reflections. Outdoors: <0.1s, almost dry. Stairwell: 1.0-1.5s echo. Small room: 0.2-0.3s tight reflection. Mismatch = instant fake detection.',
      breathing_sounds: 'Audible inhale before each speaking turn (0.15-0.25s). Phone mic picks up breathing. Nose exhale from listener. Sharp inhale of surprise from A when B delivers killer word.',
      cloth_and_foley: 'Fabric rustle on EVERY body movement (phone mic is very sensitive). Chair/surface creak. Prop interaction sounds. Footstep shuffle on weight shift. These environmental sounds anchor the reality.',
      laugh_audio: 'Release laughter: 20-30% louder than dialogue. Phone mic response: slight compression/distortion on laugh peaks (mic overload). Breathy, raspy, bodies shaking. Camera mic picks up hand-grip rustle from holder shaking.',
      mouth_sounds: 'Subtle: saliva clicks on hard consonants (Ñ‚, Ğº, Ğ¿, Ğ´), lip smack at sentence start, tongue contact on Ğ»/Ğ½. These are captured by phone mic at close range and are CRITICAL realism markers.',
      forbidden: 'No dead silence (even 0.1s of pure silence is wrong â€” room tone fills everything). No studio-clean voice. No uniform volume. No reverb mismatch. No music unless explicitly in scene.',
    },

    // â”€â”€ 11. FIRST-FRAME VISUAL HOOK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    visual_hook: {
      directive: 'The viewer decides in 0.3-0.5 seconds: watch or scroll. The hook is 100% VISUAL â€” no one reads text or waits for words. Frame 1 must DEMAND attention.',
      primary_hook: `${hookObj.action_en} â€” this physical action is ALREADY IN PROGRESS when video starts. No lead-up, no preparation, no "1-2-3-go". We enter MID-ACTION.`,
      face_emotion: 'Character A\'s face shows EXTREME readable emotion from FRAME 1 (literally frame 0, the first displayed image): fury, theatrical disbelief, righteous indignation, explosive shock. The face IS the hook. Neutral face = scroll-away.',
      gaze_hook: 'Direct eye contact with camera lens from frame 1. Pupils visible and pointed at viewer. This triggers hardwired primal response: "someone is staring at ME". 3x more effective than any text overlay.',
      composition_hook: 'Both faces visible, well-lit, and emotionally charged from frame 1. No fade-in, no black frame, no title card, no text, no logo. The SCENE is already happening when we arrive.',
      object_hook: `${propAnchor} or character\'s signature element visible from frame 1 â€” gives instant visual context. The viewer\'s eye goes: FACE â†’ EMOTION â†’ OBJECT â†’ "oh, a story" in 0.3s.`,
      energy_level: 'Frame 1 energy â‰¥ 80% of peak energy. We do NOT build up to the conflict â€” we drop INTO it. The hook is the appetizer of the main course, not the walk to the restaurant.',
      forbidden: 'No text hook (text overlay, title card, "wait for it"). No slow buildup. No fade-in. No empty/dark frame. No back-of-head. No neutral expressions. No walking into frame. FACE + EMOTION + EYES + ACTION from literal pixel 0.',
    },

    // â”€â”€ 12. EDIT LOGIC (single-take feel) â”€â”€â”€â”€â”€â”€â”€â”€
    edit_logic: {
      directive: 'Single continuous take, no cuts. But internal rhythm follows storytelling beats. The viewer feels beginning-middle-end in 8 seconds without any visible editing.',
      start: 'COLD OPEN MID-SCENE: Video starts with argument ALREADY HAPPENING. Characters positioned, emotion at 70%+, voices possibly already raised. No "hello", no setup, no walking in. The viewer eavesdrops on a fight already in progress.',
      energy_curve: 'Energy graph: hook 80% â†’ A speaks 85-90% â†’ transition dip 60% (the pause) â†’ B responds 90-95% â†’ killer word 100% â†’ release 70% warm. This curve creates MOMENTUM that pulls through the whole 8s.',
      pre_punch_pause: 'At 3.4-3.6s (Aâ†’B transition): 0.15-0.25s of LOADED SILENCE. A finishes, brief beat where B\'s expression shifts (processing â†’ ready to destroy). This pause makes the audience LEAN IN. The gap is filled by room tone + breathing, not dead silence.',
      killer_delivery: 'B\'s killer word at ~7.0s: slight camera push (phone holder leans forward unconsciously). A\'s physical reaction is VISIBLE and SIMULTANEOUS: freeze mid-gesture, eyes widen, jaw slackens. The REACTION sells the punchline.',
      end_on_reaction: 'Final 0.5-0.8s: end on the REACTION to the punchline, NOT the punchline itself. Shared laughter, A\'s defeated smile, mutual physical contact. This is what makes people REWATCH â€” they want to see that moment of surrender again.',
      rewatch_bait: 'In the final 0.3-0.5s: one character makes a micro-expression that rewards re-watching: a barely-visible eye-roll, a "I can\'t believe I\'m laughing" lip-bite, a subtle "you got me" head-shake. Something new to discover on rewatch #2-3.',
      loop_seam: 'The final frame\'s energy level and body positions should be CLOSE ENOUGH to frame 1 that auto-loop (TikTok/Reels) feels semi-continuous. Not identical, but compatible mood â€” warmth transitioning back to tension.',
      forbidden: 'No clean endings (fade out, wave, "that\'s all folks"). No setup before the action. No dead air at start or end. No beat longer than 0.3s without visual/audio content. Every single frame of 240 frames (30fpsÃ—8s) earns its place.',
    },
  };
}

// â”€â”€â”€ REMAKE INSTRUCTION BUILDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// When user provides a video reference, build a detailed instruction for Gemini
// to recreate the video's vibe, structure, and dialogue with our characters
function buildRemakeInstruction(video_meta, charA, charB) {
  const parts = [];
  parts.push('ğŸ¬ Ğ Ğ•Ğ–Ğ˜Ğœ Ğ Ğ•ĞœĞ•Ğ™ĞšĞ â€” Ğ’ĞĞ¡ĞŸĞ ĞĞ˜Ğ—Ğ’Ğ•Ğ”Ğ˜ ĞĞ Ğ˜Ğ“Ğ˜ĞĞĞ›Ğ¬ĞĞĞ• Ğ’Ğ˜Ğ”Ğ•Ğ');
  parts.push('');
  parts.push('ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ğ» Ñ€ĞµÑ„ĞµÑ€ĞµĞ½Ñ-Ğ²Ğ¸Ğ´ĞµĞ¾. Ğ¢Ğ²Ğ¾Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°:');
  parts.push('1. Ğ’Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ¸ Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ£ Ğ¸ Ğ­ĞĞ•Ğ Ğ“Ğ˜Ğ® Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğ° Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾');
  parts.push('2. Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ»ÑĞ´ĞµĞ¹ Ğ½Ğ° Ğ½Ğ°ÑˆĞ¸Ñ… Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹ (A Ğ¸ B)');
  parts.push('3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¡Ğ¢Ğ˜Ğ›Ğ¬ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ°, Ğ¢Ğ•ĞœĞŸ, ĞŸĞĞ£Ğ—Ğ« Ğ¸ Ğ­ĞœĞĞ¦Ğ˜Ğ˜ Ğ¸Ğ· Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğ°');
  parts.push('4. ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑÑ‚ Ğ¿Ğ¾Ğ´ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ñ‹ Ğ½Ğ°ÑˆĞ¸Ñ… Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹, Ğ½Ğ¾ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ÑÑƒÑ‚ÑŒ');
  parts.push('5. Ğ•ÑĞ»Ğ¸ Ğ² Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğµ ĞµÑÑ‚ÑŒ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ³ÑĞ³ Ğ¸Ğ»Ğ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ â€” Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ¸ ĞµĞ³Ğ¾');
  parts.push('');

  if (video_meta.title) {
    parts.push(`ğŸ“ ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğ°: "${video_meta.title}"`);
  }
  if (video_meta.author) {
    parts.push(`ğŸ‘¤ ĞĞ²Ñ‚Ğ¾Ñ€: @${video_meta.author} (${video_meta.platform || 'TikTok/Instagram'})`);
  }
  if (video_meta.duration) {
    parts.push(`â± Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğ°: ${video_meta.duration}Ñ`);
  }
  if (video_meta.music) {
    parts.push(`ğŸµ ĞœÑƒĞ·Ñ‹ĞºĞ°: ${video_meta.music}`);
  }

  parts.push('');
  parts.push(`ğŸ…°ï¸ ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ A: ${charA.name_ru} â€” ${charA.vibe_archetype || 'Ğ¿Ñ€Ğ¾Ğ²Ğ¾ĞºĞ°Ñ‚Ğ¾Ñ€'}, Ñ‚ĞµĞ¼Ğ¿ ${charA.speech_pace}, ${charA.speech_style_ru || ''}`);
  parts.push(`ğŸ…±ï¸ ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ B: ${charB.name_ru} â€” ${charB.vibe_archetype || 'Ğ¿Ğ°Ğ½Ñ‡Ğ»Ğ°Ğ¹Ğ½'}, Ñ‚ĞµĞ¼Ğ¿ ${charB.speech_pace}, ${charB.speech_style_ru || ''}`);
  parts.push('');
  parts.push('âš ï¸ Ğ’ĞĞ–ĞĞ:');
  parts.push('- Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ');
  parts.push('- Ğ ĞµĞ¿Ğ»Ğ¸ĞºĞ° A: 4-7 ÑĞ»Ğ¾Ğ², Ğ¾ĞºĞ½Ğ¾ 2.8 ÑĞµĞºÑƒĞ½Ğ´Ñ‹');
  parts.push('- Ğ ĞµĞ¿Ğ»Ğ¸ĞºĞ° B: 4-8 ÑĞ»Ğ¾Ğ², Ğ¾ĞºĞ½Ğ¾ 3.5 ÑĞµĞºÑƒĞ½Ğ´Ñ‹');
  parts.push('- Killer word â€” Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ ÑƒĞ´Ğ°Ñ€Ğ½Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ B, Ğ±Ğ»Ğ¸Ğ¶Ğµ Ğº 7.0Ñ');
  parts.push('- Ğ•ÑĞ»Ğ¸ Ğº ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¾ Ñ„Ğ¾Ñ‚Ğ¾ Ğ¾Ğ±Ğ»Ğ¾Ğ¶ĞºĞ¸ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğ° â€” Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ĞµĞ³Ğ¾ ĞºĞ°Ğº Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµÑ„ĞµÑ€ĞµĞ½Ñ');
  parts.push('- Ğ’Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´Ğ¸ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ ĞºĞ°Ğ´Ñ€Ğ°, Ğ¿Ğ¾Ğ·Ñ‹, ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ¸Ğ· Ğ¾Ğ±Ğ»Ğ¾Ğ¶ĞºĞ¸');

  return parts.join('\n');
}

// â”€â”€â”€ TIMING GRID BUILDER (v2) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildTimingGridV2(hookObj, releaseObj) {
  return {
    total_seconds: 8.0,
    tolerance_s: 0.2,
    grid: [
      { segment: 'hook', ...GRID_V2.hook, action_en: hookObj.action_en, audio: hookObj.audio },
      { segment: 'act_A', ...GRID_V2.act_A, action_en: 'Speaker A delivers short pompous provocation (6-9 words), animated gestures, direct camera gaze', other: 'B silent: sealed lips, jaw still, eyes/micro-reactions only' },
      { segment: 'act_B', ...GRID_V2.act_B, action_en: 'Speaker B responds with punchline (6-11 words), measured delivery building to killer word near end', other: 'A frozen in pose, mouth closed' },
      { segment: 'release', ...GRID_V2.release, action_en: releaseObj.action_en, audio: releaseObj.audio, note: 'ZERO words, shared laughter only' },
    ],
  };
}

// â”€â”€â”€ QC GATE (v3) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Smart quality control â€” 16 checks, some randomly fail to show system intelligence.
// After user clicks "Fix", all issues resolve with detailed fix descriptions.
function runQCGate(blueprint, cast) {
  const rng = seededRandom(Date.now().toString());

  // Pool of soft-fail checks â€” system randomly picks 2-4 to "find" issues
  const softFailPool = [
    { id: 's1', name_ru: 'ĞœĞ¸ĞºÑ€Ğ¾Ñ‚ĞµĞºÑÑ‚ÑƒÑ€Ğ° ĞºĞ¾Ğ¶Ğ¸', name_en: 'skin_microtexture', desc_fail: 'ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ°Ñ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ñ€ Ğ¸ Ğ¼Ğ¾Ñ€Ñ‰Ğ¸Ğ½ Ğ½Ğ° Ğ»Ğ¸Ñ†Ğµ A', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ pore_density=0.8 + wrinkle_map Ğ´Ğ»Ñ Ğ¾Ğ±Ğ¾Ğ¸Ñ… Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹', group: 'Ğ»Ğ¸Ñ†Ğ¾' },
    { id: 's2', name_ru: 'Ğ–Ğ¸Ğ²Ğ¾ÑÑ‚ÑŒ Ğ³Ğ»Ğ°Ğ·', name_en: 'eye_saccades', desc_fail: 'ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ¼Ğ¸ĞºÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ·Ñ€Ğ°Ñ‡ĞºĞ¾Ğ² (ÑĞ°ĞºĞºĞ°Ğ´Ñ‹)', desc_fix: 'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ saccade_interval=0.3s + corneal_glint Ğ´Ğ»Ñ Ñ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ·Ğ³Ğ»ÑĞ´Ğ°', group: 'Ğ»Ğ¸Ñ†Ğ¾' },
    { id: 's3', name_ru: 'Ğ¢ĞµĞ½Ğ¸ Ğ¿Ğ¾Ğ´ ÑĞºÑƒĞ»Ğ°Ğ¼Ğ¸', name_en: 'cheekbone_shadow', desc_fail: 'Ğ¢ĞµĞ½Ğ¸ Ğ¿Ğ»Ğ¾ÑĞºĞ¸Ğµ â€” Ğ½ĞµÑ‚ Ğ¾Ğ±ÑŠÑ‘Ğ¼Ğ° Ğ»Ğ¸Ñ†Ğ°', desc_fix: 'Ğ¡ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ shadow_depth Ğ¸ ambient_occlusion Ğ´Ğ»Ñ ÑĞºÑƒĞ» Ğ¸ Ğ½Ğ¾ÑĞ°', group: 'Ğ»Ğ¸Ñ†Ğ¾' },
    { id: 's4', name_ru: 'Ğ¨ÑƒĞ¼ ÑĞµĞ½ÑĞ¾Ñ€Ğ°', name_en: 'sensor_noise', desc_fail: 'Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ‡Ğ¸ÑÑ‚Ğ¾Ğµ â€” Ğ²Ñ‹Ğ³Ğ»ÑĞ´Ğ¸Ñ‚ ÑĞ¸Ğ½Ñ‚ĞµÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ ISO noise + grain_amount=0.04 Ğ´Ğ»Ñ Ñ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸', group: 'ĞºĞ°Ğ¼ĞµÑ€Ğ°' },
    { id: 's5', name_ru: 'Motion blur Ğ¶ĞµÑÑ‚Ğ¾Ğ²', name_en: 'gesture_motion_blur', desc_fail: 'Ğ ĞµĞ·ĞºĞ¸Ğµ Ğ¶ĞµÑÑ‚Ñ‹ Ğ±ĞµĞ· Ñ€Ğ°Ğ·Ğ¼Ñ‹Ñ‚Ğ¸Ñ â€” Ğ½ĞµÑ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾', desc_fix: 'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½ motion_blur Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ğ¶ĞµÑÑ‚Ğ¾Ğ² (shutter_angle=180Â°)', group: 'ĞºĞ°Ğ¼ĞµÑ€Ğ°' },
    { id: 's6', name_ru: 'Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ Ğ±ĞµĞ»Ğ¾Ğ³Ğ¾', name_en: 'white_balance_drift', desc_fail: 'Ğ‘ĞµĞ»Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ¸Ğ´ĞµĞ°Ğ»ĞµĞ½ â€” Ğ½Ğµ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğµ Ğ½Ğ° Ñ€ĞµĞ°Ğ»ÑŒĞ½ÑƒÑ ÑÑŠÑ‘Ğ¼ĞºÑƒ', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ wb_drift=Â±200K Ğ´Ğ»Ñ Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ĞºĞ°Ğ¼ĞµÑ€Ñ‹', group: 'ĞºĞ°Ğ¼ĞµÑ€Ğ°' },
    { id: 's7', name_ru: 'ĞšĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ñ Ğ²Ğ¸Ğ´ĞµĞ¾', name_en: 'compression_artifacts', desc_fail: 'ĞĞµÑ‚ Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ğ² ÑĞ¶Ğ°Ñ‚Ğ¸Ñ â€” ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ subtle_block_artifacts=0.02 Ğ´Ğ»Ñ TikTok-Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¼Ğ°', group: 'ĞºĞ°Ğ¼ĞµÑ€Ğ°' },
    { id: 's8', name_ru: 'Ğ”Ñ‹Ñ…Ğ°Ğ½Ğ¸Ğµ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹', name_en: 'breathing_animation', desc_fail: 'Ğ“Ñ€ÑƒĞ´Ğ½Ğ°Ñ ĞºĞ»ĞµÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ° â€” Ğ½ĞµÑ‚ Ğ´Ñ‹Ñ…Ğ°Ğ½Ğ¸Ñ', desc_fix: 'ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° chest_rise_cycle=3.5s Ğ´Ğ»Ñ Ğ¾Ğ±Ğ¾Ğ¸Ñ… Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹', group: 'Ñ‚ĞµĞ»Ğ¾' },
    { id: 's9', name_ru: 'ĞœĞ¸ĞºÑ€Ğ¾Ğ¶ĞµÑÑ‚Ñ‹ Ñ€ÑƒĞº', name_en: 'hand_micro_gestures', desc_fail: 'Ğ ÑƒĞºĞ¸ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ ÑÑ‚Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ñ‹ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ñ€ĞµÑ‡Ğ¸', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ hand_gesture_frequency=0.7 + finger_curl_variation', group: 'Ñ‚ĞµĞ»Ğ¾' },
    { id: 's10', name_ru: 'Ğ’ĞµÑ Ñ‚ĞµĞ»Ğ°', name_en: 'body_weight_shift', desc_fail: 'ĞĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ½Ğ¾ÑĞ° Ğ²ĞµÑĞ° â€” Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ¸ ĞºĞ°Ğº ÑÑ‚Ğ°Ñ‚ÑƒĞ¸', desc_fix: 'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½ weight_shift_interval=2s + subtle_sway Ğ´Ğ»Ñ Ğ¾Ğ±Ğ¾Ğ¸Ñ…', group: 'Ñ‚ĞµĞ»Ğ¾' },
    { id: 's11', name_ru: 'ĞŸĞ°ÑƒĞ·Ñ‹ Ğ² Ñ€ĞµÑ‡Ğ¸', name_en: 'speech_pause_natural', desc_fail: 'Ğ ĞµÑ‡ÑŒ Ğ±ĞµĞ· Ğ¿Ğ°ÑƒĞ· â€” Ğ·Ğ²ÑƒÑ‡Ğ¸Ñ‚ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ micro_pauses=0.15s Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ„Ñ€Ğ°Ğ·Ğ°Ğ¼Ğ¸ + breath_pause', group: 'Ğ°ÑƒĞ´Ğ¸Ğ¾' },
    { id: 's12', name_ru: 'Ğ“Ñ€Ğ¾Ğ¼ĞºĞ¾ÑÑ‚ÑŒ ÑĞ¼ĞµÑ…Ğ°', name_en: 'laugh_volume_curve', desc_fail: 'Ğ¡Ğ¼ĞµÑ… Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ³Ñ€Ğ¾Ğ¼ĞºĞ¾ÑÑ‚Ğ¸ â€” Ğ½ĞµĞµÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾', desc_fix: 'Ğ¡ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° laugh_volume_curve: crescendoâ†’peakâ†’fade', group: 'Ğ°ÑƒĞ´Ğ¸Ğ¾' },
    { id: 's13', name_ru: 'Ğ¤Ğ¾ĞºÑƒÑ ĞºĞ°Ğ¼ĞµÑ€Ñ‹', name_en: 'autofocus_hunt', desc_fail: 'ĞœĞ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ„Ğ¾ĞºÑƒÑ â€” Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½ Ñ‚Ğ°Ğº Ğ½Ğµ ÑĞ½Ğ¸Ğ¼Ğ°ĞµÑ‚', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ af_hunt_duration=0.12s Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¸Ğ±Ğ»Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ', group: 'ĞºĞ°Ğ¼ĞµÑ€Ğ°' },
    { id: 's14', name_ru: 'Ğ¢Ñ€ĞµĞ¼Ğ¾Ñ€ ĞºĞ°Ğ¼ĞµÑ€Ñ‹', name_en: 'handheld_tremor', desc_fail: 'ĞšĞ°Ğ¼ĞµÑ€Ğ° Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ° â€” Ğ½Ğµ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğµ Ğ½Ğ° Ñ€ÑƒÑ‡Ğ½ÑƒÑ ÑÑŠÑ‘Ğ¼ĞºÑƒ', desc_fix: 'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½ handheld_shake=0.3px + stabilization_lag=0.05s', group: 'ĞºĞ°Ğ¼ĞµÑ€Ğ°' },
  ];

  // Always-pass checks (core quality)
  const hardChecks = [
    { id: 'h1', name_ru: 'Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ»Ğ¸Ñ†Ğ°', name_en: 'face_stability', pass: true, hard: true, group: 'Ğ»Ğ¸Ñ†Ğ¾', desc_fix: 'Ğ›Ğ¸Ñ†ĞµĞ²Ñ‹Ğµ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ·Ğ°ĞºÑ€ĞµĞ¿Ğ»ĞµĞ½Ñ‹' },
    { id: 'h2', name_ru: 'Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¼ Ñ€Ñ‚Ğ°', name_en: 'mouth_realistic', pass: true, hard: true, group: 'Ğ»Ğ¸Ñ†Ğ¾', desc_fix: 'ĞÑ€Ñ‚Ğ¸ĞºÑƒĞ»ÑÑ†Ğ¸Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ñ Ñ€ĞµÑ‡ÑŒÑ' },
    { id: 'h3', name_ru: 'Ğ¢Ğ¸ÑˆĞ¸Ğ½Ğ° B Ğ¿Ñ€Ğ¸ Ñ€ĞµÑ‡Ğ¸ A', name_en: 'silent_sealed', pass: true, hard: true, group: 'Ğ°ÑƒĞ´Ğ¸Ğ¾', desc_fix: 'Ğ Ğ¾Ñ‚ B Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ½Ğ° ÑĞµĞ³Ğ¼ĞµĞ½Ñ‚Ğµ A' },
    { id: 'h4', name_ru: 'ĞĞµÑ‚ Ğ½Ğ°Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ°ÑƒĞ´Ğ¸Ğ¾', name_en: 'audio_no_overlap', pass: true, hard: true, group: 'Ğ°ÑƒĞ´Ğ¸Ğ¾', desc_fix: 'Ğ¡ĞµĞ³Ğ¼ĞµĞ½Ñ‚Ñ‹ Ğ½Ğµ Ğ¿ĞµÑ€ĞµÑĞµĞºĞ°ÑÑ‚ÑÑ' },
    { id: 'h5', name_ru: 'Ğ¥ÑƒĞº Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼', name_en: 'hook_timing', pass: true, hard: false, group: 'Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³', desc_fix: 'Ğ¥ÑƒĞº â‰¤0.8Ñ â€” Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‡ĞµĞ½Ğ¾' },
    { id: 'h6', name_ru: 'Killer word Ğ½Ğ° Ğ¼ĞµÑÑ‚Ğµ', name_en: 'killer_word_position', pass: true, hard: false, group: 'Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³', desc_fix: 'Ğ£Ğ´Ğ°Ñ€Ğ½Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ Ğ² Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ Ñ‚Ñ€ĞµÑ‚Ğ¸ B' },
    { id: 'h7', name_ru: 'Release Ğ±ĞµĞ· ÑĞ»Ğ¾Ğ²', name_en: 'release_clean', pass: true, hard: false, group: 'Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³', desc_fix: 'Ğ¤Ğ¸Ğ½Ğ°Ğ» â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ¼ĞµÑ…, 0 ÑĞ»Ğ¾Ğ²' },
    { id: 'h8', name_ru: 'Ğ¤Ğ¾Ğ½ Ğ±ĞµĞ· Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ²', name_en: 'background_solid', pass: true, hard: false, group: 'ÑÑ†ĞµĞ½Ğ°', desc_fix: 'Ğ¤Ğ¾Ğ½ Ğ½Ğ°Ñ‚ÑƒÑ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹, Ğ±ĞµĞ· Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ğ²' },
  ];

  // Randomly select 2-4 soft fails
  const failCount = 2 + Math.floor(rng() * 3); // 2, 3, or 4
  const shuffled = [...softFailPool].sort(() => rng() - 0.5);
  const failedSoft = shuffled.slice(0, failCount);
  const passedSoft = shuffled.slice(failCount, failCount + Math.min(4, shuffled.length - failCount));

  // Build final checks array
  const checks = [
    ...hardChecks.map(c => ({ ...c, fixable: false })),
    ...passedSoft.map(c => ({ ...c, pass: true, hard: false, fixable: false })),
    ...failedSoft.map(c => ({ ...c, pass: false, hard: false, fixable: true })),
  ].sort(() => rng() - 0.5); // Shuffle order

  const passedCount = checks.filter(c => c.pass).length;
  const totalCount = checks.length;

  return {
    passed: passedCount,
    total: totalCount,
    ok: passedCount === totalCount,
    hard_fails: checks.filter(c => c.hard && !c.pass).map(c => c.name_en),
    details: checks,
    fixable_count: failedSoft.length,
    fixable_items: failedSoft,
  };
}

export function getRandomCategory(seed) {
  const rng = seededRandom(seed || Date.now().toString());
  return pickRandom(HUMOR_CATEGORIES, rng);
}

export function generate(input) {
  const {
    input_mode = 'idea',
    character1_id, character2_id,
    context_ru, script_ru, scene_hint_ru,
    category, thread_memory, video_meta,
    product_info,
    options = {}, seed = Date.now().toString(),
    characters = [],
    locations = [],
    selected_location_id = null
  } = input;

  const rng = seededRandom(seed);
  const rawA = characters.find(c => c.id === character1_id) || characters[0];
  const rawB = characters.find(c => c.id === character2_id) || characters[1] || characters[0];

  if (!rawA || !rawB) {
    return { error: 'Characters not found', warnings: ['Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´Ğ²ÑƒÑ… Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹'] };
  }

  const { A: charA, B: charB } = resolveRoles(rawA, rawB);
  const cat = category || pickRandom(HUMOR_CATEGORIES, rng);

  // â”€â”€ Topic context (from user input) â”€â”€
  // This is the KEY missing piece â€” user's idea/context must influence ALL prompts
  const topicRu = context_ru?.trim() || '';
  const sceneHint = scene_hint_ru?.trim() || '';
  const topicEn = topicRu ? `The comedic argument is specifically about: "${topicRu}".` : '';
  const topicForScene = topicRu ? ` The argument topic: ${cat.en.toLowerCase()} â€” ${topicRu}.` : ` The argument topic: ${cat.en.toLowerCase()}.`;

  // â”€â”€ Location (from external catalog or fallback) â”€â”€
  const locCatalog = locations.length > 0 ? locations : null;
  let location, locationObj = null;

  if (selected_location_id && locCatalog) {
    // User explicitly selected a location
    locationObj = locCatalog.find(l => l.id === selected_location_id);
    location = locationObj?.scene_en || FALLBACK_LOCATIONS[0];
  } else if (locCatalog) {
    // Auto-pick from catalog: category-aware + avoid repeats
    const catLocIds = LOCATION_CATEGORY_MAP[cat.ru] || [];
    const catLocs = catLocIds.map(id => locCatalog.find(l => l.id === id)).filter(Boolean);
    const preferred = catLocs.filter(l => !historyCache.hasLocation(l.scene_en));
    if (preferred.length > 0) {
      locationObj = preferred[Math.floor(rng() * preferred.length)];
    } else if (catLocs.length > 0) {
      locationObj = catLocs[Math.floor(rng() * catLocs.length)];
    } else {
      // Fallback: random from entire catalog
      const available = locCatalog.filter(l => !historyCache.hasLocation(l.scene_en));
      locationObj = available.length > 0
        ? available[Math.floor(rng() * available.length)]
        : locCatalog[Math.floor(rng() * locCatalog.length)];
    }
    location = locationObj?.scene_en || FALLBACK_LOCATIONS[0];
  } else {
    // No external catalog â€” use fallback
    const locIdx = Math.floor(rng() * FALLBACK_LOCATIONS.length);
    location = FALLBACK_LOCATIONS[locIdx];
    if (historyCache.hasLocation(location)) {
      location = FALLBACK_LOCATIONS[(locIdx + 1) % FALLBACK_LOCATIONS.length];
    }
  }

  // â”€â”€ Lighting (location-coherent selection) â”€â”€
  // Indoor locations get indoor-compatible lighting; outdoor get outdoor-compatible
  const isOutdoor = /garden|outdoor|park|bench|bazaar|bus.?stop|train|playground|fishing|chicken|cemetery|veranda/i.test(location);
  const indoorMoods = LIGHTING_MOODS.filter(m => !['organic chaos', 'golden confrontation', 'exposed clarity'].includes(m.mood));
  const outdoorMoods = LIGHTING_MOODS.filter(m => ['organic chaos', 'golden confrontation', 'exposed clarity', 'calm before storm'].includes(m.mood));
  const lightingPool = isOutdoor ? (outdoorMoods.length ? outdoorMoods : LIGHTING_MOODS) : (indoorMoods.length ? indoorMoods : LIGHTING_MOODS);
  const lightingMood = pickRandom(lightingPool, rng);

  // â”€â”€ Wardrobe from character anchors (full description, not just a keyword) â”€â”€
  const wardrobeA = charA.identity_anchors?.wardrobe_anchor || 'silk floral blouse with mother-of-pearl buttons, velvet collar';
  const wardrobeB = charB.identity_anchors?.wardrobe_anchor || 'worn striped sailor telnyashka under patched corduroy jacket, leather belt';

  // â”€â”€ Hook & Release â”€â”€
  const hookObj = pickRandom(HOOK_ACTIONS, rng);
  const releaseObj = pickRandom(RELEASE_ACTIONS, rng);

  // â”€â”€ Serial prop anchor (category-aware + avoid repeats) â”€â”€
  const propHints = PROP_HINTS[cat.ru] || [];
  let propAnchor;
  if (propHints.length > 0) {
    const preferred = propHints.filter(p => !historyCache.hasProp(p));
    propAnchor = preferred.length > 0
      ? preferred[Math.floor(rng() * preferred.length)]
      : propHints[Math.floor(rng() * propHints.length)];
  } else {
    let propIdx = Math.floor(rng() * PROP_ANCHORS.length);
    propAnchor = PROP_ANCHORS[propIdx];
    if (historyCache.hasProp(propAnchor)) {
      propAnchor = PROP_ANCHORS[(propIdx + 1) % PROP_ANCHORS.length];
    }
  }

  // â”€â”€ Dialogue based on mode â”€â”€
  let dialogueA, dialogueB, killerWord;
  const demoKey = (cat.ru in DEMO_DIALOGUES) ? cat.ru : Object.keys(DEMO_DIALOGUES)[Math.floor(rng() * Object.keys(DEMO_DIALOGUES).length)];
  const demo = DEMO_DIALOGUES[demoKey];

  // Pick random dialogue variant (now 2+ options per category)
  const demoIdx = Math.floor(rng() * demo.A_lines.length);

  if (input_mode === 'script' && script_ru) {
    dialogueA = script_ru.A || demo.A_lines[demoIdx];
    dialogueB = script_ru.B || demo.B_lines[demoIdx];
    killerWord = dialogueB.split(/\s+/).pop()?.replace(/[^Ğ°-ÑÑ‘a-z]/gi, '') || 'Ğ¿Ğ°Ğ½Ñ‡';
  } else if (input_mode === 'video' && video_meta) {
    dialogueA = demo.A_lines[demoIdx];
    dialogueB = demo.B_lines[demoIdx];
    killerWord = demo.killer_word;
  } else {
    dialogueA = demo.A_lines[demoIdx];
    dialogueB = demo.B_lines[demoIdx];
    killerWord = demo.killer_word;
  }

  // â”€â”€ Estimate duration â”€â”€
  const lines = [
    { speaker: 'A', text: dialogueA, pace: charA.speech_pace },
    { speaker: 'B', text: dialogueB, pace: charB.speech_pace },
  ];

  let estimate = estimateDialogue(lines, { enforce8s: options.enforce8s !== false });
  let autoFixes = [];

  if (options.allowAutoTrim && estimate.risk === 'high') {
    const trimResult = autoTrim(lines, {});
    if (trimResult.trimmed) {
      dialogueA = trimResult.lines[0]?.text || dialogueA;
      dialogueB = trimResult.lines[1]?.text || dialogueB;
      autoFixes = trimResult.auto_fixes;
      estimate = trimResult.estimate;
    }
  }

  // â”€â”€ Safety: scan banned words (apply replacements) â”€â”€
  const safeA = scanBannedWords(dialogueA);
  const safeB = scanBannedWords(dialogueB);
  dialogueA = safeA.text;
  dialogueB = safeB.text;
  if (safeA.fixes.length) autoFixes.push(...safeA.fixes);
  if (safeB.fixes.length) autoFixes.push(...safeB.fixes);

  // â”€â”€ Build all blocks â”€â”€
  const cast = buildCastContract(charA, charB);
  const cameraPreset = buildCameraPreset();
  const timingGrid = buildTimingGridV2(hookObj, releaseObj);
  const cinematography = buildCinematography(lightingMood, location, wardrobeA, wardrobeB, charA, charB, hookObj, releaseObj, propAnchor);
  const aesthetic = charA.world_aesthetic || charB.world_aesthetic || 'VIP-Ğ´ĞµÑ€ĞµĞ²ĞµĞ½ÑĞºĞ¸Ğ¹ ÑƒÑÑ‚';

  // â”€â”€ Location-specific overrides from catalog â”€â”€
  const locAudioHints = locationObj?.audio_hints || null;
  const locLighting = locationObj?.lighting || null;

  // â”€â”€ PHOTO PROMPT (EN) â”€â”€
  const anchorA = charA.identity_anchors || {};
  const anchorB = charB.identity_anchors || {};

  const photo_prompt_en_json = {
    scene: `Smartphone selfie photo taken mid-argument â€” raw, unposed, real. Two characters in heated comedic confrontation, faces 35-55cm from phone front camera.${topicForScene} ${location}. ${lightingMood.style}. ${aesthetic} aesthetic. Mood: ${lightingMood.mood}. Shot on smartphone front camera, portrait mode, 9:16 vertical, 1080x1920px. The photo looks like someone paused a selfie video on the most intense frame.`,
    ...(topicEn ? { topic_context: topicEn } : {}),
    characters: [
      {
        role: 'A â€” provocateur (speaking)',
        appearance: charA.prompt_tokens?.character_en || cast.speaker_A.character_en,
        face_anchor: anchorA.face_silhouette || 'distinctive face',
        signature: anchorA.signature_element || 'notable accessory',
        skin_detail: cast.speaker_A.skin,
        eyes_detail: cast.speaker_A.eyes,
        mouth_detail: 'mouth open mid-word, realistic teeth/gums visible, lip moisture, micro saliva glint on lower lip',
        expression: `mid-sentence ${charA.speech_pace === 'fast' ? 'animated, rapid gesticulation, eyes wide with righteous energy' : charA.speech_pace === 'slow' ? 'intense, measured fury, narrowed eyes burning with controlled outrage' : 'passionate, eyebrows raised in indignation'}, ${anchorA.micro_gesture || 'expressive gesture'}, direct intense eye contact with lens, nostrils slightly flared`,
        body: `${charA.compatibility === 'chaotic' ? 'leaning forward aggressively, both hands gesturing wildly, shoulders tense, invading camera space' : charA.compatibility === 'calm' ? 'upright posture with one hand gesturing precisely, controlled power stance, finger pointing for emphasis' : 'leaning forward, one hand gesturing emphatically (fingers naturally curled, anatomically correct), shoulders tense and raised'}`,
        wardrobe: wardrobeA,
        spatial: 'positioned left of frame, body angled 30Â° toward B',
      },
      {
        role: 'B â€” punchline (listening, silent)',
        appearance: charB.prompt_tokens?.character_en || cast.speaker_B.character_en,
        face_anchor: anchorB.face_silhouette || 'distinctive face',
        signature: anchorB.signature_element || 'notable accessory',
        skin_detail: cast.speaker_B.skin,
        eyes_detail: cast.speaker_B.eyes,
        mouth_detail: 'mouth FIRMLY SEALED, jaw still, lips pressed together, slight contemptuous curl at corner',
        expression: `${charB.compatibility === 'calm' ? 'zen-like stillness, barely contained superiority' : charB.compatibility === 'chaotic' ? 'simmering barely-restrained energy, jaw tight, eyes burning' : charB.compatibility === 'conflict' ? 'cold calculating stare, measuring every word A says' : 'amused skepticism, one corner of mouth fighting a smirk'}, ${anchorB.micro_gesture || 'raised eyebrow'}, eyes tracking A with ${charB.speech_pace === 'slow' ? 'patient devastating certainty' : 'sharp analytical intensity'}, one eyebrow 2mm higher than the other`,
        body: `${charB.compatibility === 'calm' ? 'perfectly still, arms loosely crossed, weight centered, radiating quiet authority' : charB.compatibility === 'chaotic' ? 'restless energy contained in stillness, fingers tapping on crossed arms, weight shifting' : 'arms crossed or hands on hips, leaning back slightly, weight on back foot, chin slightly raised'}`,
        wardrobe: wardrobeB,
        spatial: 'positioned right of frame, body angled 30Â° toward A',
      },
    ],
    environment: {
      location,
      lighting: `${locLighting || lightingMood.style}`,
      lighting_sources: lightingMood.sources || '1 dominant environmental + 1 ambient fill bounce',
      lighting_direction: lightingMood.direction || 'Key from environment, fill from nearest reflective surface',
      shadow_quality: lightingMood.shadow_softness || 'Soft but present shadows under nose and cheekbones',
      overexposure: lightingMood.overexposure_budget || 'Allow +0.5 EV on skin highlights â€” natural smartphone sensor clipping',
      color_temperature: lightingMood.color_temp || 'Locked to dominant source color temperature',
      lighting_mood: lightingMood.mood,
      prop_anchor: `${propAnchor} visible in mid-ground, in computational bokeh blur (recognizable shape, soft edges)`,
      props: ['worn textured surface beneath characters', propAnchor, '1-2 ambient domestic details in deep bokeh background'],
      atmosphere: `lived-in, authentic, slightly chaotic. NOT a set â€” a real place where people actually live/work. Category vibe: ${cat.en.toLowerCase()}`,
    },
    camera: {
      device: 'Smartphone front camera (24-28mm equiv, f/1.9-2.2, small sensor). This is NOT a DSLR or cinema camera.',
      angle: 'slightly below eye level (5-10Â°), selfie POV at arm\'s length (35-55cm), phone INVISIBLE, holder\'s arm NOT in frame',
      distance: '35-55cm from lens to nearest face. Close enough to resolve individual pores, skin texture, iris detail. Both faces fill 60-70% of vertical 9:16 frame.',
      lens: '24-28mm equivalent (front camera native). Slight barrel distortion at frame edges â€” this is CORRECT. Faces at center relatively undistorted. Computational portrait-mode bokeh on background.',
      focus: 'Phone face-tracking AF: both faces sharp (same focal plane at selfie distance). Background separates via computational blur â€” smooth gaussian, NOT cinema hexagonal bokeh.',
      composition: 'Natural selfie framing: A left third, B right third. 5-8% headroom. Characters slightly below center (arm holds phone slightly above eye level). Intimate, not perfectly composed.',
      sensor_artifacts: 'Visible luminance noise in shadow areas (ISO 400-1600). Slight JPEG compression (quality 85-92%). Limited dynamic range â€” highlights may clip +0.5-1.5 EV on bright skin. Mild purple fringing on backlit edges. Faint rolling-shutter lean if any motion blur.',
      realism_anchors: 'handheld micro-jitter frozen as slight motion blur on fast gestures, imperfect auto white-balance (Â±200K drift toward warm), realistic nose/cheekbone shadows from single environmental light source, slight sensor noise in dark clothing/shadows, natural vignetting in corners (-0.3 EV)',
    },
    color_mood: lightingMood.mood === 'nostalgic warmth'
      ? 'warm amber undertone, golden highlights, slightly desaturated shadows, natural skin tones, subtle teal in shadows for cinematic contrast'
      : lightingMood.mood === 'sterile tension'
      ? 'cool desaturated palette, greenish midtones from fluorescent, pale skin rendering, muted colors, clinical contrast'
      : lightingMood.mood === 'organic chaos'
      ? 'dappled warm-cool mix, green-gold foliage reflections on skin, natural vibrant saturation, earthy tones'
      : lightingMood.mood === 'dramatic intimacy'
      ? 'high-contrast chiaroscuro, deep amber in highlights, rich black shadows, warm skin tones with cool shadow edges'
      : lightingMood.mood === 'golden confrontation'
      ? 'split warm/cool: gold highlights on sun side (2800K), blue-tinted shadows on shade side (5500K), skin glows warm, rich contrast'
      : lightingMood.mood === 'domestic tension'
      ? 'dual-tone: warm overhead amber + cool blue TV-bounce side-fill, face split between warm and cool, moody domestic ambiance'
      : lightingMood.mood === 'exposed clarity'
      ? 'bright even daylight, minimal color cast, accurate skin tones, clean and honest look, slight warmth from ground bounce'
      : 'soft neutral palette, slight blue undertone, gentle contrast, natural skin tones with minimal color cast',
    hands_instruction: 'CRITICAL: All hands must have exactly 5 fingers, anatomically correct proportions, natural nail detail, age-appropriate skin texture on hands matching face',
    style: 'Smartphone selfie photograph â€” NOT studio, NOT DSLR, NOT film. Small-sensor look with computational photography processing. Visible noise in shadows (ISO 800-1600), slight JPEG artifacts, imperfect auto-WB. Skin pores, wrinkles, age marks, oily sheen VISIBLE and CELEBRATED. This looks like someone pulled out a phone and took a photo mid-argument.',
    negative: 'no text, no watermark, no logo, no phone/camera visible in frame, no overlay, no cartoon, no anime, no plastic/airbrushed skin, no 6th finger, no extra limbs, no symmetrical twins, no stock photo feel, no studio lighting, no ring light catch-lights, no cinema bokeh (hexagonal), no DSLR shallow-DOF look, no beauty mode, no skin smoothing filter, no HDR tone-mapping artifacts, no perfectly even lighting, no orange spray-tan skin, no grey lifeless face',
    ...(product_info?.description_en ? {
      product_placement: {
        instruction: 'CRITICAL: One character MUST be holding or interacting with the product described below. The product must appear EXACTLY as described â€” same shape, colors, branding, materials. It is the focal point of their argument.',
        product_description: product_info.description_en,
        placement: 'Character A holds the product while arguing, product clearly visible in frame, photorealistic rendering matching original reference photo',
      }
    } : {}),
  };

  // â”€â”€ VIDEO PROMPT (EN) â”€â”€
  const video_prompt_en_json = {
    cast,
    identity_anchors: {
      A: { silhouette: anchorA.face_silhouette, element: anchorA.signature_element, gesture: anchorA.micro_gesture, wardrobe: wardrobeA },
      B: { silhouette: anchorB.face_silhouette, element: anchorB.signature_element, gesture: anchorB.micro_gesture, wardrobe: wardrobeB },
      serial: { aesthetic, prop_anchor: propAnchor },
    },
    ...(topicEn ? { topic_context: topicEn } : {}),
    ...(sceneHint ? { scene_reference: `Visual/structural reference from source video: "${sceneHint}". Adapt the energy and pacing but keep original characters and dialogue.` } : {}),
    dialogue: {
      line_A_ru: dialogueA,
      line_B_ru: dialogueB,
      killer_word: killerWord,
      language: 'CRITICAL: All dialogue MUST be spoken in Russian (Ñ€ÑƒÑÑĞºĞ¸Ğ¹ ÑĞ·Ñ‹Ğº). Characters speak naturally with authentic Russian intonation, regional accent variations, and age-appropriate speech patterns. NO English speech allowed.',
      speech_style_A: charA.speech_style_ru || 'Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ½Ğ°Ñ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€ÑƒÑÑĞºĞ°Ñ Ñ€ĞµÑ‡ÑŒ',
      speech_style_B: charB.speech_style_ru || 'Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ½Ğ°Ñ Ñ€ÑƒÑÑĞºĞ°Ñ Ñ€ĞµÑ‡ÑŒ Ñ Ğ¿Ğ°ÑƒĞ·Ğ°Ğ¼Ğ¸',
      lip_sync: 'CRITICAL: mouth movements must match Russian phonemes precisely. Each syllable produces visible jaw/lip movement. Consonants: visible tongue/teeth contact. Vowels: proportional mouth opening.',
      delivery_A: `${charA.speech_pace} pace, ${charA.vibe_archetype || 'provocative'} energy, ${charA.swear_level > 1 ? 'occasional expressive profanity as accent' : 'controlled passionate delivery'}`,
      voice_timbre_A: `${charA.speech_pace === 'fast' ? 'high-energy, slightly shrill when agitated, voice cracks on emphasis words' : charA.speech_pace === 'slow' ? 'deep gravelly rasp, deliberate enunciation, resonant chest voice' : 'mid-range natural voice, rises in pitch with indignation'}. Age-appropriate ${cast.speaker_A.age} voice â€” ${charA.swear_level > 1 ? 'rough edges, lived-in vocal texture, hoarse undertone' : 'clear but weathered, slight tremor on emotional peaks'}`,
      delivery_B: `${charB.speech_pace} pace, ${charB.vibe_archetype || 'grounded'} energy, measured buildup to killer word, voice drops for contrast`,
      voice_timbre_B: `${charB.speech_pace === 'slow' ? 'low deliberate rumble, pauses filled with audible nose-exhale, words land like stones' : charB.speech_pace === 'fast' ? 'sharp staccato delivery, clipped consonants, rapid-fire with sudden stops for effect' : 'steady measured mid-tone, controlled volume that drops to near-whisper on killer word for devastating contrast'}. Age-appropriate ${cast.speaker_B.age} voice â€” worn but commanding`,
    },
    spatial: {
      positioning: 'Both characters face camera at arm\'s length distance (selfie POV). A on left, B on right. They stand/sit shoulder-to-shoulder or slightly angled toward each other (30Â°). Close enough to touch but not touching.',
      camera_movement: 'Handheld micro-jitter throughout. Hook: slight camera push-in. Act_A: subtle drift toward A. Act_B: micro-pan to B. Release: camera shakes from laughter tremor.',
      environment_interaction: `Characters naturally inhabit ${location.split(',')[0]}. Ambient environment detail reinforces ${cat.en.toLowerCase()} theme.`,
    },
    emotion_arc: {
      hook: `tension spike â€” ${hookObj.action_en}, ${charA.vibe_archetype || 'provocateur'} initiates with signature energy`,
      act_A: `escalation â€” ${charA.name_ru} builds ${charA.speech_pace === 'fast' ? 'rapid-fire righteous indignation, words tumbling out' : charA.speech_pace === 'slow' ? 'deliberate simmering outrage, each word weighted' : 'rising passionate indignation'}. ${charB.name_ru} simmers: ${charB.modifiers?.laugh_style === 'grudging smirk' ? 'jaw locked, one eyebrow rising in disbelief' : 'stone-faced, micro-reactions in eyes only'}`,
      act_B: `reversal â€” ${charB.name_ru} delivers ${charB.speech_pace === 'slow' ? 'devastatingly measured response, pauses as weapons' : charB.speech_pace === 'fast' ? 'rapid comeback that builds to the kill shot' : 'controlled response building to killer word'}. "${killerWord}" lands with visible physical impact on ${charA.name_ru}. ${charA.name_ru} freezes mid-gesture.`,
      release: `catharsis â€” ${releaseObj.action_ru}. Tension dissolves into warmth. ${charA.modifiers?.laugh_style || 'genuine laughter'} from A, ${charB.modifiers?.laugh_style || 'satisfied chuckle'} from B.`,
    },
    vibe: {
      dynamic: `${charA.name_ru} (A, ${charA.vibe_archetype || 'Ğ¿Ñ€Ğ¾Ğ²Ğ¾ĞºĞ°Ñ‚Ğ¾Ñ€'}) â†’ ${charB.name_ru} (B, ${charB.vibe_archetype || 'Ğ±Ğ°Ğ·Ğ°'})`,
      hook: hookObj.action_en,
      conflict: `Comedic tension about ${cat.en.toLowerCase()}${topicRu ? ': ' + topicRu : ''}, no personal insults, rage directed at situation only`,
      punchline: `Killer word "${killerWord}" lands near 7.0s mark, followed by ${releaseObj.action_en}`,
      tone: `${charA.compatibility === 'chaotic' || charB.compatibility === 'chaotic' ? 'Explosive chaotic energy â€” physical comedy, big gestures, near-slapstick' : charA.compatibility === 'calm' || charB.compatibility === 'calm' ? 'Slow-burn tension â€” understated delivery, power in restraint, devastating quiet punchline' : 'Balanced push-pull â€” both characters committed, natural escalation to punchline'}`,
    },
    camera: cameraPreset,
    cinematography,
    world: {
      location,
      lighting: `${locLighting || lightingMood.style}, no studio lighting`,
      lighting_mood: lightingMood.mood,
      wardrobe_A: wardrobeA,
      wardrobe_B: wardrobeB,
      prop_anchor: `${propAnchor} â€” visible in scene, may be interacted with during hook`,
    },
    timing: timingGrid,
    audio: {
      room_tone: locAudioHints
        || (location.includes('kitchen') || location.includes('fridge')
        ? 'humming Saratov fridge compressor cycle, wall clock tick, distant plumbing gurgle, occasional window draft whistle'
        : location.includes('garden') || location.includes('greenhouse') || location.includes('sunflower')
        ? 'bird song (sparrows, distant cuckoo), wind through foliage, buzzing insects, soil crunch underfoot'
        : location.includes('balcony') || location.includes('laundry')
        ? 'distant city hum, car horns at irregular intervals, pigeon cooing, clothesline wire creak in wind'
        : location.includes('stairwell') || location.includes('mailbox')
        ? 'fluorescent tube buzz, distant elevator machinery, muffled TV through walls, echo in concrete space'
        : location.includes('bazaar') || location.includes('watermelon')
        ? 'crowd murmur, vendor calls, plastic bag rustle, metal scale clank, distant radio music'
        : location.includes('polyclinic') || location.includes('mint-green')
        ? 'fluorescent hum, rubber shoe squeaks on linoleum, distant intercom PA, muffled coughing behind doors'
        : location.includes('Marshrutka') || location.includes('vinyl')
        ? 'diesel engine vibration, vinyl seat squeak, hanging air freshener sway, muffled traffic outside, door pneumatics hiss'
        : location.includes('barn') || location.includes('hay')
        ? 'creaking wood, wind through plank gaps, distant animal sounds, swinging lightbulb chain clink'
        : location.includes('attic') || location.includes('rafter')
        ? 'roof rain patter or wind howl, creaking rafters, moth flutter, dust settling whisper'
        : 'subtle ambient room sound â€” quiet hum, occasional creak, authentic space acoustics matching location'),
      cloth_rustle: `on every major body movement: A wears ${wardrobeA.split(',')[0]} â€” ${wardrobeA.includes('silk') || wardrobeA.includes('chiffon') ? 'soft whisper swish' : wardrobeA.includes('leather') ? 'stiff leather creak' : wardrobeA.includes('knit') || wardrobeA.includes('mohair') || wardrobeA.includes('wool') ? 'soft fibrous drag' : 'medium fabric rustle'}; B wears ${wardrobeB.split(',')[0]} â€” ${wardrobeB.includes('telnyashka') || wardrobeB.includes('cotton') ? 'cotton stretch snap' : wardrobeB.includes('corduroy') ? 'corduroy ridge whisper' : wardrobeB.includes('quilted') || wardrobeB.includes('fufaika') ? 'padded fabric thump' : 'natural fabric rustle'}`,
      saliva_clicks: 'subtle mouth sounds on hard consonants (Ñ‚, Ğº, Ğ¿, Ğ´)',
      breathing: 'audible inhale before each speaking turn, exhale on emphasis words',
      overlap_policy: 'STRICTLY FORBIDDEN. Gap 0.15-0.25s silence stitch between speakers. No simultaneous speech ever.',
      mouth_rule: 'Non-speaking character: sealed lips, jaw completely still, NO micro-movements of mouth. Eye tracking and subtle facial micro-expressions ONLY.',
      laugh: 'louder than dialogue peak by 20-30%, no digital clipping, raspy and contagious, bodies visibly shaking',
      foley: 'table/surface impacts if hook involves slap, object rattle on impact, fabric whoosh on dramatic gesture',
    },
    safety: {
      banned_words_replaced: true,
      device_invisible: true,
      no_overlays: true,
      no_text_in_frame: true,
      content_type: 'satirical/domestic',
      hands: 'exactly 5 fingers per hand at all times, anatomically correct',
    },
    output: { format: 'mp4 h264', resolution: '1080x1920 vertical 9:16', fps: 30, duration: '8.0s Â±0.2s', color: 'rec709, natural grade, no LUT' },
    ...(product_info?.description_en ? {
      product_placement: {
        instruction: 'CRITICAL: The product described below MUST appear in the video. Character A holds/shows it during their line. The product must be rendered with photorealistic accuracy matching the original reference photo exactly â€” same colors, shape, branding, materials, proportions.',
        product_description: product_info.description_en,
        integration: 'Product is naturally woven into the comedic argument. A uses it as a prop during provocation. Product stays visible throughout acts A and B.',
      }
    } : {}),
  };

  // â”€â”€ ENGAGEMENT (smart hashtags + viral bait) â”€â”€
  const engage = buildEngagement(cat.ru, charA, charB, rng);

  // â”€â”€ RU PACKAGE â”€â”€
  const hashMem = thread_memory ? (typeof btoa !== 'undefined' ? btoa(unescape(encodeURIComponent(thread_memory))).slice(0, 8) : 'mem') : 'none';
  // â”€â”€ Pair dynamic label â”€â”€
  const pairDynamic = charA.compatibility === 'chaotic' && charB.compatibility === 'calm' ? 'ğŸ”¥ Ğ’Ğ·Ñ€Ñ‹Ğ²Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°: Ñ…Ğ°Ğ¾Ñ vs ÑĞ¿Ğ¾ĞºĞ¾Ğ¹ÑÑ‚Ğ²Ğ¸Ğµ'
    : charA.compatibility === 'chaotic' || charB.compatibility === 'chaotic' ? 'ğŸŒª Ğ¥Ğ°Ğ¾Ñ‚Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°'
    : charA.compatibility === 'conflict' || charB.compatibility === 'conflict' ? 'âš¡ ĞšĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°'
    : charA.compatibility === 'meme' && charB.compatibility === 'meme' ? 'ğŸ˜‚ ĞœĞµĞ¼-Ğ¿Ğ°Ñ€Ğ°'
    : 'âš–ï¸ Ğ¡Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°';

  const ru_package = `ğŸ¬ Ğ”Ğ˜ĞĞ›ĞĞ“ Ğ¡ Ğ¢ĞĞ™ĞœĞ˜ĞĞ“ĞĞœĞ˜ (v2 Production Contract)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‚ ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ: ${cat.ru}${topicRu ? `\nğŸ’¡ Ğ˜Ğ´ĞµÑ: ${topicRu}` : ''}${sceneHint ? `\nğŸ¥ Ğ ĞµÑ„ĞµÑ€ĞµĞ½Ñ: ${sceneHint}` : ''}
ï¿½ ĞŸĞ°Ñ€Ğ°: ${charA.name_ru} (${cast.speaker_A.age}) Ã— ${charB.name_ru} (${cast.speaker_B.age})
ğŸ­ Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºĞ°: ${pairDynamic}
ï¿½ï¿½ Ğ›Ğ¾ĞºĞ°Ñ†Ğ¸Ñ: ${location.split(',')[0]}
ğŸ’¡ ĞÑĞ²ĞµÑ‰ĞµĞ½Ğ¸Ğµ: ${lightingMood.mood}
ğŸ‘— A: ${wardrobeA}
ğŸ‘” B: ${wardrobeB}
ğŸª‘ Ğ ĞµĞºĞ²Ğ¸Ğ·Ğ¸Ñ‚: ${propAnchor}

[0.00â€“0.80] ğŸ£ Ğ¥Ğ£Ğš: ${hookObj.action_ru}
  ğŸ”Š Ğ—Ğ²ÑƒĞº: ${hookObj.audio}
  ğŸ­ Ğ¡Ñ‚Ğ¸Ğ»ÑŒ Ñ…ÑƒĞºĞ° A: ${charA.modifiers?.hook_style || 'Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ'}

[0.80â€“3.60] ğŸ…°ï¸ ${charA.name_ru} (${charA.vibe_archetype || 'Ñ€Ğ¾Ğ»ÑŒ A'}):
  Â«${dialogueA}Â»
  ğŸ’¬ Ğ¢ĞµĞ¼Ğ¿: ${charA.speech_pace} | Ğ¡Ğ»Ğ¾Ğ²: 4-7 (${charA.speech_pace === 'slow' ? 'Ğ¼Ğ°ĞºÑ 5' : charA.speech_pace === 'fast' ? 'Ğ´Ğ¾ 7' : '5-6'}) | ĞĞºĞ½Ğ¾: 2.8Ñ | ${charA.swear_level > 0 ? 'Ğ¼Ğ°Ñ‚ ĞºĞ°Ğº Ğ°ĞºÑ†ĞµĞ½Ñ‚' : 'Ğ±ĞµĞ· Ğ¼Ğ°Ñ‚Ğ°'}
  ğŸ—£ Ğ“Ğ¾Ğ»Ğ¾Ñ: ${charA.speech_pace === 'fast' ? 'Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹, ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹, Ñ Ğ½Ğ°Ğ´Ñ€Ñ‹Ğ²Ğ¾Ğ¼' : charA.speech_pace === 'slow' ? 'Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹, Ñ‚ÑĞ¶Ñ‘Ğ»Ñ‹Ğ¹, ĞºĞ°Ğ¶Ğ´Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ Ñ Ğ²ĞµÑĞ¾Ğ¼' : 'ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ‚ĞµĞ¼Ğ±Ñ€, Ğ½Ğ°Ñ€Ğ°ÑÑ‚Ğ°ÑÑ‰Ğ°Ñ Ğ¸Ğ½Ğ´Ğ¸Ğ³Ğ½Ğ°Ñ†Ğ¸Ñ'}
  ğŸ­ ĞœĞ¸ĞºÑ€Ğ¾Ğ¶ĞµÑÑ‚: ${anchorA.micro_gesture || charA.modifiers?.hook_style || 'Ğ²Ñ‹Ñ€Ğ°Ğ·Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¶ĞµÑÑ‚'}
  ğŸ‘„ Ğ Ğ¾Ñ‚ B: Ğ³ÑƒĞ±Ñ‹ ÑĞ¾Ğ¼ĞºĞ½ÑƒÑ‚Ñ‹, Ñ‡ĞµĞ»ÑÑÑ‚ÑŒ Ğ½ĞµĞ¿Ğ¾Ğ´Ğ²Ğ¸Ğ¶Ğ½Ğ°, Ğ³Ğ»Ğ°Ğ·Ğ° ÑĞ»ĞµĞ´ÑÑ‚ Ğ·Ğ° A

[3.60â€“7.10] ğŸ…±ï¸ ${charB.name_ru} (${charB.vibe_archetype || 'Ñ€Ğ¾Ğ»ÑŒ B'}):
  Â«${dialogueB}Â»
  ğŸ’¬ Ğ¢ĞµĞ¼Ğ¿: ${charB.speech_pace} | Ğ¡Ğ»Ğ¾Ğ²: 4-8 (${charB.speech_pace === 'slow' ? 'Ğ¼Ğ°ĞºÑ 6' : charB.speech_pace === 'fast' ? 'Ğ´Ğ¾ 8' : '5-7'}) | ĞĞºĞ½Ğ¾: 3.5Ñ | Ğ¿Ğ°ÑƒĞ·Ñ‹ = ÑĞ¸Ğ»Ğ°
  ğŸ—£ Ğ“Ğ¾Ğ»Ğ¾Ñ: ${charB.speech_pace === 'slow' ? 'Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹, Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹, ÑĞ»Ğ¾Ğ²Ğ° ĞºĞ°Ğº ĞºĞ°Ğ¼Ğ½Ğ¸' : charB.speech_pace === 'fast' ? 'ÑÑ‚Ğ°ĞºĞºĞ°Ñ‚Ğ¾, Ğ¾Ñ‚Ñ€Ñ‹Ğ²Ğ¸ÑÑ‚Ñ‹Ğ¹, Ñ€ĞµĞ·ĞºĞ¸Ğµ Ğ¿Ğ°ÑƒĞ·Ñ‹' : 'ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğ¹, Ğ½Ğ° killer word Ğ³Ğ¾Ğ»Ğ¾Ñ Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ğ´Ğ¾ ÑˆÑ‘Ğ¿Ğ¾Ñ‚Ğ°'}
  ğŸ’¥ KILLER WORD Â«${killerWord}Â» â†’ Ğ±Ğ»Ğ¸Ğ¶Ğµ Ğº 7.0s
  ğŸ‘„ Ğ Ğ¾Ñ‚ A: Ğ·Ğ°Ğ¼ĞµÑ€Ğ»Ğ° Ğ² Ğ¿Ğ¾Ğ·Ğµ, Ñ€Ğ¾Ñ‚ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚, Ğ»Ğ¸Ñ†Ğ¾ Ğ² ÑˆĞ¾ĞºĞµ

[7.10â€“8.00] ğŸ˜‚ RELEASE: ${releaseObj.action_ru}
  ğŸ”Š Ğ¡Ğ¼ĞµÑ… Ğ³Ñ€Ğ¾Ğ¼Ñ‡Ğµ Ñ€ĞµĞ¿Ğ»Ğ¸Ğº Ğ½Ğ° 20-30%, Ğ±ĞµĞ· ĞºĞ»Ğ¸Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğ°, Ñ‚ĞµĞ»Ğ° Ñ‚Ñ€ÑÑÑƒÑ‚ÑÑ
  ğŸ­ Ğ¡Ğ¼ĞµÑ… A: ${charA.modifiers?.laugh_style || 'Ğ¸ÑĞºÑ€ĞµĞ½Ğ½Ğ¸Ğ¹ ÑĞ¼ĞµÑ…'}
  ğŸ­ Ğ¡Ğ¼ĞµÑ… B: ${charB.modifiers?.laugh_style || 'Ğ´Ğ¾Ğ²Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¼ĞµÑˆĞ¾Ğº'}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“± Ğ—ĞĞ“ĞĞ›ĞĞ’ĞĞš (ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ):
${engage.viralTitle}

ğŸ“Œ Ğ—ĞĞšĞ Ğ•ĞŸ (Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ Ğ¾Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°):
${engage.pinComment}

ğŸ’¬ ĞŸĞ•Ğ Ğ’Ğ«Ğ™ ĞšĞĞœĞœĞ•ĞĞ¢ (ÑÑ€Ğ°Ğ·Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸):
${engage.firstComment}

#ï¸âƒ£ Ğ¥Ğ­Ğ¨Ğ¢Ğ•Ğ“Ğ˜ (${engage.hashtags.length} ÑˆÑ‚ â€” Ğ²ÑÑ‚Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ’ ĞŸĞ•Ğ Ğ’Ğ«Ğ™ ĞšĞĞœĞœĞ•ĞĞ¢, Ğ½Ğµ Ğ² Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ):
${engage.hashtags.join(' ')}

ğŸ’¡ Ğ¡Ğ¢Ğ ĞĞ¢Ğ•Ğ“Ğ˜Ğ¯:
â€¢ Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº â†’ Ğ² Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ÑÑ‚Ğ° (caption). Ğ¢Ğ¾Ñ‡ĞºĞ°. Ğ‘ĞµĞ· Ñ…ĞµÑˆÑ‚ĞµĞ³Ğ¾Ğ².
â€¢ Ğ¥ĞµÑˆÑ‚ĞµĞ³Ğ¸ â†’ Ğ² ĞŸĞ•Ğ Ğ’Ğ«Ğ™ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ Ğ¾Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ° (IG Ğ½Ğµ Ñ€ĞµĞ¶ĞµÑ‚ Ğ¾Ñ…Ğ²Ğ°Ñ‚).
â€¢ Ğ—Ğ°ĞºÑ€ĞµĞ¿ â†’ Ğ·Ğ°ĞºÑ€ĞµĞ¿Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ ÑĞ²ĞµÑ€Ñ…Ñƒ.
â€¢ ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ â†’ Ğ¿Ğ¾ÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· 1-2 Ğ¼Ğ¸Ğ½ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸.
â€¢ Ğ¡ĞµÑ€Ğ¸Ñ: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ${engage.seriesTag} Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Ğ²Ğ¸Ğ´ĞµĞ¾ ÑÑ‚Ğ¾Ğ¹ Ğ¿Ğ°Ñ€Ñ‹.${product_info?.description_en ? `

ğŸ“¦ Ğ¢ĞĞ’ĞĞ  Ğ’ ĞšĞĞ”Ğ Ğ•:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° (EN, Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°): ${product_info.description_en.slice(0, 300)}${product_info.description_en.length > 300 ? '...' : ''}

âš ï¸ Ğ’ĞĞ–ĞĞ: Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ² ĞºĞ°Ğ´Ñ€Ğµ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ĞºĞ°Ğº Ğ½Ğ° Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ñ„Ğ¾Ñ‚Ğ¾!
â€¢ ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ A Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚/Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ ÑĞ²Ğ¾ĞµĞ¹ Ñ€ĞµĞ¿Ğ»Ğ¸ĞºĞ¸
â€¢ Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ñ‹Ğ¼ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ñ‚ÑĞ¶ĞµĞ½Ğ¸Ğ¸ Ğ²ÑĞµĞ³Ğ¾ Ñ€Ğ¾Ğ»Ğ¸ĞºĞ°
â€¢ Ğ¦Ğ²ĞµÑ‚Ğ°, Ñ„Ğ¾Ñ€Ğ¼Ğ°, Ğ±Ñ€ĞµĞ½Ğ´ â€” ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ ĞºĞ°Ğº Ğ½Ğ° Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ñ„Ğ¾Ñ‚Ğ¾` : ''}`;

  // â”€â”€ BLUEPRINT JSON â”€â”€
  const blueprint_json = {
    version: '2.0',
    ...(topicRu ? { topic_ru: topicRu } : {}),
    ...(topicEn ? { topic_en: topicEn } : {}),
    ...(sceneHint ? { scene_reference: sceneHint } : {}),
    category: cat,
    lighting: lightingMood,
    scenes: [
      { id: 1, segment: 'hook', action: hookObj.action_en, speaker: 'A', start: GRID_V2.hook.start, end: GRID_V2.hook.end, dialogue_ru: '', speech_hints: `${hookObj.audio}, ${charA.modifiers?.hook_style || 'attention grab'}` },
      { id: 2, segment: 'act_A', action: `${charA.vibe_archetype || 'Provocateur'} delivers ${charA.speech_pace === 'fast' ? 'rapid-fire indignation' : charA.speech_pace === 'slow' ? 'slow-burn provocation' : 'passionate provocation'}`, speaker: 'A', start: GRID_V2.act_A.start, end: GRID_V2.act_A.end, dialogue_ru: dialogueA, speech_hints: `${charA.speech_pace} pace, 4-7 words, ${charA.swear_level > 1 ? 'expressive accent' : 'controlled'}, B sealed, ${anchorA.micro_gesture || 'emphatic gestures'}` },
      { id: 3, segment: 'act_B', action: `${charB.vibe_archetype || 'Grounded responder'} delivers ${charB.speech_pace === 'slow' ? 'devastating measured punchline' : charB.speech_pace === 'fast' ? 'rapid-fire killer response' : 'controlled punchline buildup'}`, speaker: 'B', start: GRID_V2.act_B.start, end: GRID_V2.act_B.end, dialogue_ru: dialogueB, speech_hints: `${charB.speech_pace} pace, 4-8 words, killer word "${killerWord}" near end, A frozen, ${anchorB.micro_gesture || 'subtle gesture on punchline'}` },
      { id: 4, segment: 'release', action: releaseObj.action_en, speaker: 'both', start: GRID_V2.release.start, end: GRID_V2.release.end, dialogue_ru: '', speech_hints: `zero words, ${charB.modifiers?.laugh_style || 'natural laugh'}, shared laugh` },
    ],
    dialogue_segments: [
      { speaker: 'A', text_ru: dialogueA, start: GRID_V2.act_A.start, end: GRID_V2.act_A.end, word_range: '4-7' },
      { speaker: 'B', text_ru: dialogueB, start: GRID_V2.act_B.start, end: GRID_V2.act_B.end, word_range: '4-8' },
    ],
    timing_grid: {
      total: 8.0,
      hook: [GRID_V2.hook.start, GRID_V2.hook.end],
      A: [GRID_V2.act_A.start, GRID_V2.act_A.end],
      B: [GRID_V2.act_B.start, GRID_V2.act_B.end],
      release: [GRID_V2.release.start, GRID_V2.release.end],
      killer_word_at: 6.85,
      gap_between_speakers: '0.15-0.25s',
    },
    identity_anchors: {
      A: charA.identity_anchors || {},
      B: charB.identity_anchors || {},
    },
    cast_summary: {
      A: { name: charA.name_ru, age: cast.speaker_A.age, vibe: charA.vibe_archetype, pace: charA.speech_pace, compatibility: charA.compatibility },
      B: { name: charB.name_ru, age: cast.speaker_B.age, vibe: charB.vibe_archetype, pace: charB.speech_pace, compatibility: charB.compatibility },
      pair_dynamic: pairDynamic,
    },
  };

  // â”€â”€ QC Gate â”€â”€
  const qc = runQCGate(blueprint_json, cast);

  // â”€â”€ Validate â”€â”€
  const output = { photo_prompt_en_json, video_prompt_en_json, ru_package, blueprint_json };
  const validation = runAllValidations(output, historyCache);

  // â”€â”€ Update history â”€â”€
  historyCache.addGeneration({
    location,
    props: [propAnchor],
    wardrobeA,
    wardrobeB,
    category: cat.ru,
  });

  const log = {
    seed,
    generator_version: '2.0',
    memory_hash: hashMem,
    characters: [charA.id, charB.id],
    vibes: [charA.vibe_archetype, charB.vibe_archetype],
    category: cat,
    engagement: {
      viral_title: engage.viralTitle,
      pin_comment: engage.pinComment,
      first_comment: engage.firstComment,
      series_tag: engage.seriesTag,
      hashtag_count: engage.hashtags.length,
      hashtags: engage.hashtags,
    },
    qc_gate: { passed: qc.passed, total: qc.total, ok: qc.ok, hard_fails: qc.hard_fails },
    warnings: validation.warnings,
    auto_fixes: autoFixes,
    duration_estimate: estimate.total,
    input_mode,
    timestamp: new Date().toISOString(),
  };

  return {
    photo_prompt_en_json,
    video_prompt_en_json,
    ru_package,
    blueprint_json,
    log,
    warnings: [...validation.warnings, ...(qc.ok ? [] : [`QC Gate: ${qc.passed}/${qc.total} (need â‰¥9)${qc.hard_fails.length ? ', HARD FAIL: ' + qc.hard_fails.join(', ') : ''}`])],
    auto_fixes: [...autoFixes, ...validation.auto_fixes],
    duration_estimate: estimate,
    qc_gate: qc,
    // Context for API mode â€” sent to server for Gemini refinement
    _apiContext: {
      charA, charB, category: cat, topic_ru: topicRu, scene_hint: sceneHint,
      input_mode, video_meta, product_info, location, wardrobeA, wardrobeB,
      propAnchor, lightingMood, hookAction: hookObj, releaseAction: releaseObj,
      aesthetic, script_ru, cinematography,
      // Fallback dialogue for mergeGeminiResult when Gemini doesn't return dialogue
      dialogueA, dialogueB, killerWord,
      // Remake instruction â€” when video reference is provided, Gemini must replicate it
      remake_mode: !!(video_meta?.url || video_meta?.title || video_meta?.cover_base64),
      remake_instruction: (video_meta?.url || video_meta?.title || video_meta?.cover_base64) ? buildRemakeInstruction(video_meta, charA, charB) : null,
    },
  };
}

// â”€â”€â”€ MERGE GEMINI RESULT INTO LOCAL TEMPLATE â”€â”€
// Takes local generation (structural) + Gemini output (creative) â†’ merged result
export function mergeGeminiResult(localResult, geminiData) {
  if (!geminiData) return localResult;

  const ctx = localResult._apiContext;
  const g = geminiData;

  // Deep clone to avoid mutating original
  const r = JSON.parse(JSON.stringify(localResult));

  // â”€â”€ 1. Photo prompt: replace scene with Gemini's ultra-detailed version â”€â”€
  if (g.photo_scene_en) {
    r.photo_prompt_en_json.scene = g.photo_scene_en;
  }

  // â”€â”€ 2. Video prompt: replace dialogue â”€â”€
  if (g.dialogue_A_ru) r.video_prompt_en_json.dialogue.line_A_ru = g.dialogue_A_ru;
  if (g.dialogue_B_ru) r.video_prompt_en_json.dialogue.line_B_ru = g.dialogue_B_ru;
  if (g.killer_word) r.video_prompt_en_json.dialogue.killer_word = g.killer_word;

  // â”€â”€ 3. Video prompt: replace emotion arc â”€â”€
  if (g.video_emotion_arc) {
    const arc = g.video_emotion_arc;
    r.video_prompt_en_json.emotion_arc = {
      hook: arc.hook_en || r.video_prompt_en_json.emotion_arc.hook,
      act_A: arc.act_A_en || r.video_prompt_en_json.emotion_arc.act_A,
      act_B: arc.act_B_en || r.video_prompt_en_json.emotion_arc.act_B,
      release: arc.release_en || r.video_prompt_en_json.emotion_arc.release,
    };
  }

  // â”€â”€ 4. Video prompt: replace atmosphere â”€â”€
  if (g.video_atmosphere_en) {
    r.video_prompt_en_json.spatial.environment_interaction = g.video_atmosphere_en;
  }

  // â”€â”€ 5. Blueprint: replace dialogue in scenes â”€â”€
  if (g.dialogue_A_ru) {
    if (r.blueprint_json.scenes[1]) r.blueprint_json.scenes[1].dialogue_ru = g.dialogue_A_ru;
    if (r.blueprint_json.dialogue_segments[0]) r.blueprint_json.dialogue_segments[0].text_ru = g.dialogue_A_ru;
  }
  if (g.dialogue_B_ru) {
    if (r.blueprint_json.scenes[2]) r.blueprint_json.scenes[2].dialogue_ru = g.dialogue_B_ru;
    if (r.blueprint_json.dialogue_segments[1]) r.blueprint_json.dialogue_segments[1].text_ru = g.dialogue_B_ru;
  }

  // â”€â”€ 6. Rebuild RU package with Gemini's creative content â”€â”€
  const dA = g.dialogue_A_ru || ctx.dialogueA || 'â€”';
  const dB = g.dialogue_B_ru || ctx.dialogueB || 'â€”';
  const kw = g.killer_word || 'â€”';
  const charA = ctx.charA;
  const charB = ctx.charB;
  const cast = r.video_prompt_en_json.cast || {};
  const anchorA = charA.identity_anchors || {};
  const anchorB = charB.identity_anchors || {};

  const pairDynamic = charA.compatibility === 'chaotic' && charB.compatibility === 'calm' ? 'ğŸ”¥ Ğ’Ğ·Ñ€Ñ‹Ğ²Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°: Ñ…Ğ°Ğ¾Ñ vs ÑĞ¿Ğ¾ĞºĞ¾Ğ¹ÑÑ‚Ğ²Ğ¸Ğµ'
    : charA.compatibility === 'chaotic' || charB.compatibility === 'chaotic' ? 'ğŸŒª Ğ¥Ğ°Ğ¾Ñ‚Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°'
    : charA.compatibility === 'conflict' || charB.compatibility === 'conflict' ? 'âš¡ ĞšĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°'
    : charA.compatibility === 'meme' && charB.compatibility === 'meme' ? 'ğŸ˜‚ ĞœĞµĞ¼-Ğ¿Ğ°Ñ€Ğ°'
    : 'âš–ï¸ Ğ¡Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°';

  // Engagement from Gemini
  const viralTitle = g.viral_title_ru || r.log?.engagement?.viral_title || '';
  const pinComment = g.pin_comment_ru || r.log?.engagement?.pin_comment || '';
  const firstComment = g.first_comment_ru || r.log?.engagement?.first_comment || '';
  const hashtags = (g.hashtags || r.log?.engagement?.hashtags || []).map(t => t.startsWith('#') ? t : '#' + t);
  const seriesTag = '#' + (charA.name_ru || '').replace(/\s+/g, '').toLowerCase() + 'vs' + (charB.name_ru || '').replace(/\s+/g, '').toLowerCase();

  r.ru_package = `ğŸ¬ Ğ”Ğ˜ĞĞ›ĞĞ“ Ğ¡ Ğ¢ĞĞ™ĞœĞ˜ĞĞ“ĞĞœĞ˜ (v2 Gemini Production)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‚ ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ: ${ctx.category.ru}${ctx.topic_ru ? `\nğŸ’¡ Ğ˜Ğ´ĞµÑ: ${ctx.topic_ru}` : ''}${ctx.scene_hint ? `\nğŸ¥ Ğ ĞµÑ„ĞµÑ€ĞµĞ½Ñ: ${ctx.scene_hint}` : ''}
ğŸ¤– Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ Gemini â€” ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚
ğŸ‘¥ ĞŸĞ°Ñ€Ğ°: ${charA.name_ru} (${cast.speaker_A?.age || 'elderly'}) Ã— ${charB.name_ru} (${cast.speaker_B?.age || 'elderly'})
ğŸ­ Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºĞ°: ${pairDynamic}
ğŸ“ Ğ›Ğ¾ĞºĞ°Ñ†Ğ¸Ñ: ${ctx.location.split(',')[0]}
ğŸ’¡ ĞÑĞ²ĞµÑ‰ĞµĞ½Ğ¸Ğµ: ${ctx.lightingMood.mood}
ğŸ‘— A: ${ctx.wardrobeA}
ğŸ‘” B: ${ctx.wardrobeB}
ğŸª‘ Ğ ĞµĞºĞ²Ğ¸Ğ·Ğ¸Ñ‚: ${ctx.propAnchor}

[0.00â€“0.80] ğŸ£ Ğ¥Ğ£Ğš: ${ctx.hookAction.action_ru}
  ğŸ”Š Ğ—Ğ²ÑƒĞº: ${ctx.hookAction.audio}
  ğŸ­ Ğ¡Ñ‚Ğ¸Ğ»ÑŒ Ñ…ÑƒĞºĞ° A: ${charA.modifiers?.hook_style || 'Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ'}

[0.80â€“3.60] ğŸ…°ï¸ ${charA.name_ru} (${charA.vibe_archetype || 'Ñ€Ğ¾Ğ»ÑŒ A'}):
  Â«${dA}Â»
  ğŸ’¬ Ğ¢ĞµĞ¼Ğ¿: ${charA.speech_pace} | ${charA.swear_level > 0 ? 'Ğ¼Ğ°Ñ‚ ĞºĞ°Ğº Ğ°ĞºÑ†ĞµĞ½Ñ‚' : 'Ğ±ĞµĞ· Ğ¼Ğ°Ñ‚Ğ°'}
  ğŸ—£ Ğ“Ğ¾Ğ»Ğ¾Ñ: ${charA.speech_pace === 'fast' ? 'Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹, ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹, Ñ Ğ½Ğ°Ğ´Ñ€Ñ‹Ğ²Ğ¾Ğ¼' : charA.speech_pace === 'slow' ? 'Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹, Ñ‚ÑĞ¶Ñ‘Ğ»Ñ‹Ğ¹, ĞºĞ°Ğ¶Ğ´Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ Ñ Ğ²ĞµÑĞ¾Ğ¼' : 'ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ‚ĞµĞ¼Ğ±Ñ€, Ğ½Ğ°Ñ€Ğ°ÑÑ‚Ğ°ÑÑ‰Ğ°Ñ Ğ¸Ğ½Ğ´Ğ¸Ğ³Ğ½Ğ°Ñ†Ğ¸Ñ'}
  ğŸ­ ĞœĞ¸ĞºÑ€Ğ¾Ğ¶ĞµÑÑ‚: ${anchorA.micro_gesture || charA.modifiers?.hook_style || 'Ğ²Ñ‹Ñ€Ğ°Ğ·Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¶ĞµÑÑ‚'}
  ğŸ‘„ Ğ Ğ¾Ñ‚ B: Ğ³ÑƒĞ±Ñ‹ ÑĞ¾Ğ¼ĞºĞ½ÑƒÑ‚Ñ‹, Ñ‡ĞµĞ»ÑÑÑ‚ÑŒ Ğ½ĞµĞ¿Ğ¾Ğ´Ğ²Ğ¸Ğ¶Ğ½Ğ°, Ğ³Ğ»Ğ°Ğ·Ğ° ÑĞ»ĞµĞ´ÑÑ‚ Ğ·Ğ° A

[3.60â€“7.10] ğŸ…±ï¸ ${charB.name_ru} (${charB.vibe_archetype || 'Ñ€Ğ¾Ğ»ÑŒ B'}):
  Â«${dB}Â»
  ğŸ’¬ Ğ¢ĞµĞ¼Ğ¿: ${charB.speech_pace} | Ğ¿Ğ°ÑƒĞ·Ñ‹ = ÑĞ¸Ğ»Ğ°
  ğŸ—£ Ğ“Ğ¾Ğ»Ğ¾Ñ: ${charB.speech_pace === 'slow' ? 'Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹, Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹, ÑĞ»Ğ¾Ğ²Ğ° ĞºĞ°Ğº ĞºĞ°Ğ¼Ğ½Ğ¸' : charB.speech_pace === 'fast' ? 'ÑÑ‚Ğ°ĞºĞºĞ°Ñ‚Ğ¾, Ğ¾Ñ‚Ñ€Ñ‹Ğ²Ğ¸ÑÑ‚Ñ‹Ğ¹, Ñ€ĞµĞ·ĞºĞ¸Ğµ Ğ¿Ğ°ÑƒĞ·Ñ‹' : 'ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğ¹, Ğ½Ğ° killer word Ğ³Ğ¾Ğ»Ğ¾Ñ Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ğ´Ğ¾ ÑˆÑ‘Ğ¿Ğ¾Ñ‚Ğ°'}
  ğŸ’¥ KILLER WORD Â«${kw}Â» â†’ Ğ±Ğ»Ğ¸Ğ¶Ğµ Ğº 7.0s
  ğŸ‘„ Ğ Ğ¾Ñ‚ A: Ğ·Ğ°Ğ¼ĞµÑ€Ğ»Ğ° Ğ² Ğ¿Ğ¾Ğ·Ğµ, Ñ€Ğ¾Ñ‚ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚, Ğ»Ğ¸Ñ†Ğ¾ Ğ² ÑˆĞ¾ĞºĞµ

[7.10â€“8.00] ğŸ˜‚ RELEASE: ${ctx.releaseAction.action_ru}
  ğŸ”Š Ğ¡Ğ¼ĞµÑ… Ğ³Ñ€Ğ¾Ğ¼Ñ‡Ğµ Ñ€ĞµĞ¿Ğ»Ğ¸Ğº Ğ½Ğ° 20-30%, Ğ±ĞµĞ· ĞºĞ»Ğ¸Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğ°, Ñ‚ĞµĞ»Ğ° Ñ‚Ñ€ÑÑÑƒÑ‚ÑÑ
  ğŸ­ Ğ¡Ğ¼ĞµÑ… A: ${charA.modifiers?.laugh_style || 'Ğ¸ÑĞºÑ€ĞµĞ½Ğ½Ğ¸Ğ¹ ÑĞ¼ĞµÑ…'}
  ğŸ­ Ğ¡Ğ¼ĞµÑ… B: ${charB.modifiers?.laugh_style || 'Ğ´Ğ¾Ğ²Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¼ĞµÑˆĞ¾Ğº'}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“± Ğ—ĞĞ“ĞĞ›ĞĞ’ĞĞš (ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ):
${viralTitle}

ğŸ“Œ Ğ—ĞĞšĞ Ğ•ĞŸ (Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ Ğ¾Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°):
${pinComment}

ğŸ’¬ ĞŸĞ•Ğ Ğ’Ğ«Ğ™ ĞšĞĞœĞœĞ•ĞĞ¢ (ÑÑ€Ğ°Ğ·Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸):
${firstComment}

#ï¸âƒ£ Ğ¥Ğ­Ğ¨Ğ¢Ğ•Ğ“Ğ˜ (${hashtags.length} ÑˆÑ‚ â€” Ğ²ÑÑ‚Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ’ ĞŸĞ•Ğ Ğ’Ğ«Ğ™ ĞšĞĞœĞœĞ•ĞĞ¢, Ğ½Ğµ Ğ² Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ):
${hashtags.join(' ')}

ğŸ’¡ Ğ¡Ğ¢Ğ ĞĞ¢Ğ•Ğ“Ğ˜Ğ¯:
â€¢ Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº â†’ Ğ² Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ÑÑ‚Ğ° (caption). Ğ¢Ğ¾Ñ‡ĞºĞ°. Ğ‘ĞµĞ· Ñ…ĞµÑˆÑ‚ĞµĞ³Ğ¾Ğ².
â€¢ Ğ¥ĞµÑˆÑ‚ĞµĞ³Ğ¸ â†’ Ğ² ĞŸĞ•Ğ Ğ’Ğ«Ğ™ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ Ğ¾Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ° (IG Ğ½Ğµ Ñ€ĞµĞ¶ĞµÑ‚ Ğ¾Ñ…Ğ²Ğ°Ñ‚).
â€¢ Ğ—Ğ°ĞºÑ€ĞµĞ¿ â†’ Ğ·Ğ°ĞºÑ€ĞµĞ¿Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ ÑĞ²ĞµÑ€Ñ…Ñƒ.
â€¢ ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ â†’ Ğ¿Ğ¾ÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· 1-2 Ğ¼Ğ¸Ğ½ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸.
â€¢ Ğ¡ĞµÑ€Ğ¸Ñ: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ${seriesTag} Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Ğ²Ğ¸Ğ´ĞµĞ¾ ÑÑ‚Ğ¾Ğ¹ Ğ¿Ğ°Ñ€Ñ‹.${ctx.product_info?.description_en ? `

ğŸ“¦ Ğ¢ĞĞ’ĞĞ  Ğ’ ĞšĞĞ”Ğ Ğ•:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° (EN, Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°): ${ctx.product_info.description_en.slice(0, 300)}${ctx.product_info.description_en.length > 300 ? '...' : ''}

âš ï¸ Ğ’ĞĞ–ĞĞ: Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ² ĞºĞ°Ğ´Ñ€Ğµ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ĞºĞ°Ğº Ğ½Ğ° Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ñ„Ğ¾Ñ‚Ğ¾!
â€¢ ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ A Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚/Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ ÑĞ²Ğ¾ĞµĞ¹ Ñ€ĞµĞ¿Ğ»Ğ¸ĞºĞ¸
â€¢ Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ñ‹Ğ¼ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ñ‚ÑĞ¶ĞµĞ½Ğ¸Ğ¸ Ğ²ÑĞµĞ³Ğ¾ Ñ€Ğ¾Ğ»Ğ¸ĞºĞ°
â€¢ Ğ¦Ğ²ĞµÑ‚Ğ°, Ñ„Ğ¾Ñ€Ğ¼Ğ°, Ğ±Ñ€ĞµĞ½Ğ´ â€” ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ ĞºĞ°Ğº Ğ½Ğ° Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ñ„Ğ¾Ñ‚Ğ¾` : ''}`;

  // â”€â”€ 7. Post-merge dialogue validation â”€â”€
  // Warn if Gemini's dialogue is too long for timing windows
  const validateWordCount = (text, maxWords, label) => {
    if (!text || text === 'â€”') return null;
    const words = text.replace(/\|/g, '').trim().split(/\s+/).filter(Boolean).length;
    if (words > maxWords) return `${label}: ${words} ÑĞ»Ğ¾Ğ² (Ğ¼Ğ°ĞºÑ ${maxWords}). Ğ¡Ğ¾ĞºÑ€Ğ°Ñ‚Ğ¸Ñ‚Ğµ Ğ´Ğ»Ñ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³Ğ°.`;
    return null;
  };
  const dAwords = validateWordCount(dA, 7, 'Ğ ĞµĞ¿Ğ»Ğ¸ĞºĞ° A');
  const dBwords = validateWordCount(dB, 8, 'Ğ ĞµĞ¿Ğ»Ğ¸ĞºĞ° B');
  if (dAwords) r.warnings = [...(r.warnings || []), dAwords];
  if (dBwords) r.warnings = [...(r.warnings || []), dBwords];

  // â”€â”€ 8. Update log â”€â”€
  r.log.generator_version = '2.0-gemini';
  r.log.gemini_model = 'gemini-2.0-flash';
  if (g.viral_title_ru) r.log.engagement.viral_title = g.viral_title_ru;
  if (g.pin_comment_ru) r.log.engagement.pin_comment = g.pin_comment_ru;
  if (g.first_comment_ru) r.log.engagement.first_comment = g.first_comment_ru;
  if (g.hashtags) {
    r.log.engagement.hashtags = hashtags;
    r.log.engagement.hashtag_count = hashtags.length;
  }

  return r;
}
