/**
 * FERIXDI Studio â€” Generator v2
 * Production Contract: Veo 3.1 â€¢ 8s â€¢ Handheld Selfie Feel
 * Universal character adapter â€” Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ¹ Ğ¸Ğ· ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ°
 */

import { estimateDialogue } from './estimator.js';
import { runAllValidations, scanBannedWords } from './validators.js';
import { autoTrim } from './auto_trim.js';
import { historyCache } from './history_cache.js';

// â”€â”€â”€ V2 TIMING GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const GRID_V2 = {
  hook:    { start: 0.0, end: 0.8 },
  act_A:   { start: 0.8, end: 3.6 },
  act_B:   { start: 3.6, end: 7.1 },
  release: { start: 7.1, end: 8.0 },
};

// â”€â”€â”€ LOCATIONS (fallback â€” used when no external locations loaded) â”€â”€
const FALLBACK_LOCATIONS = [
  'Weathered wooden barn interior, hay bales, single dusty lightbulb swinging, cracks of sunlight through planks',
  'Old bathhouse interior, fogged mirrors, wooden benches, copper ladle, steam wisps in backlight',
  'Root cellar with earthen walls, shelves of preserves in glass jars, bare bulb overhead, cool blue-tint air',
  'Soviet-era kitchen, peeling wallpaper, humming Saratov fridge, net curtains filtering amber sunlight',
  'Concrete balcony with drying laundry, distant city haze, rusted railing with chipped turquoise paint',
  'Stairwell landing with beige tile, fluorescent tube buzzing overhead, mailboxes, elevator door ajar',
  'Open-air bazaar stall, pyramid of watermelons, striped awning, plastic bags rustling in breeze',
  'Park bench near pond with pigeons, birch trees, distant accordion music, golden hour light',
];

// â”€â”€â”€ HOOK ACTIONS v2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const HOOK_ACTIONS = [
  { action_en: 'sharp finger jab at lens, near-miss touch', action_ru: 'ĞŸĞ°Ğ»ĞµÑ† Ğ² ĞºĞ°Ğ¼ĞµÑ€Ñƒ, Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ ĞºĞ°ÑĞ°ÑÑÑŒ Ğ»Ğ¸Ğ½Ğ·Ñ‹', audio: 'mechanical trigger + sharp inhale' },
  { action_en: 'object tap on glass â€” knuckle rap on invisible screen', action_ru: 'Ğ¡Ñ‚ÑƒĞº ĞºĞ¾ÑÑ‚ÑÑˆĞºĞ°Ğ¼Ğ¸ Ğ¿Ğ¾ "ÑÑ‚ĞµĞºĞ»Ñƒ"', audio: 'knocking + surprised gasp' },
  { action_en: 'abrupt lean-in to camera, face filling frame', action_ru: 'Ğ ĞµĞ·ĞºĞ¸Ğ¹ Ğ½Ğ°ĞºĞ»Ğ¾Ğ½ Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ, Ğ»Ğ¸Ñ†Ğ¾ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ ĞºĞ°Ğ´Ñ€', audio: 'cloth rustle + tense exhale' },
  { action_en: 'slap on table surface, objects rattle', action_ru: 'Ğ£Ğ´Ğ°Ñ€ Ğ¿Ğ¾ ÑÑ‚Ğ¾Ğ»Ñƒ, Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹ Ğ¿Ğ¾Ğ´Ğ¿Ñ€Ñ‹Ğ³Ğ¸Ğ²Ğ°ÑÑ‚', audio: 'table slap + glass rattle' },
  { action_en: 'dramatic removal of glasses/hat as reveal', action_ru: 'Ğ”Ñ€Ğ°Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾Ğµ ÑĞ½ÑÑ‚Ğ¸Ğµ Ğ¾Ñ‡ĞºĞ¾Ğ²/ÑˆĞ°Ğ¿ĞºĞ¸', audio: 'fabric whoosh + stare-down silence' },
];

// â”€â”€â”€ RELEASE ACTIONS v2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RELEASE_ACTIONS = [
  { action_en: 'shared raspy wheeze-laugh, camera shakes from body tremor', action_ru: 'ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ…Ñ€Ğ¸Ğ¿Ğ»Ñ‹Ğ¹ ÑĞ¼ĞµÑ…, ĞºĞ°Ğ¼ĞµÑ€Ğ° Ñ‚Ñ€ÑÑÑ‘Ñ‚ÑÑ Ğ¾Ñ‚ Ñ‚Ñ€ÑÑĞºĞ¸ Ñ‚ĞµĞ»Ğ°', audio: 'overlapping wheeze-laughs, gasping inhales, camera mic rumble from hand shake' },
  { action_en: 'A slaps own knee, B doubles over, tears forming', action_ru: 'A Ñ…Ğ»Ğ¾Ğ¿Ğ°ĞµÑ‚ Ğ¿Ğ¾ ĞºĞ¾Ğ»ĞµĞ½Ñƒ, B ÑĞ³Ğ¸Ğ±Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ°Ğ¼, ÑĞ»Ñ‘Ğ·Ñ‹', audio: 'knee slap impact, strained laughing exhale, sniffling tears' },
  { action_en: 'both lean into each other laughing, brief embrace', action_ru: 'ĞĞ±Ğ° Ğ·Ğ°Ğ²Ğ°Ğ»Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ´Ñ€ÑƒĞ³ Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ° Ğ¾Ñ‚ ÑĞ¼ĞµÑ…Ğ°', audio: 'fabric collision rustle, dual belly-laugh, affectionate shoulder pat' },
  { action_en: 'A covers mouth suppressing laugh, B slow triumphant grin', action_ru: 'A Ğ·Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ Ñ€Ğ¾Ñ‚, B Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ±ĞµĞ´Ğ½Ğ°Ñ ÑƒÑ…Ğ¼Ñ‹Ğ»ĞºĞ°', audio: 'muffled snort through fingers, quiet satisfied chuckle, nose exhale' },
  { action_en: 'synchronized head-throw-back cackle, camera jolts', action_ru: 'Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ñ…Ğ¾Ñ…Ğ¾Ñ‚ Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ĞºĞ¸Ğ½ÑƒÑ‚Ğ¾Ğ¹ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğ¹', audio: 'explosive dual cackle, chair creak from lean-back, camera mic peak (near-clip)' },
];

// â”€â”€â”€ SERIAL PROP ANCHORS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PROP_ANCHORS = [
  'old brass samovar with tarnished patina and wooden handles',
  'dented aluminum bucket with water condensation',
  'cast-iron poker leaning against brick surface',
  'cracked enamel kettle with chipped blue-white pattern',
  'wobbly three-legged wooden stool with worn seat',
  'vintage Rigonda radio with bakelite knobs',
  'wall-mounted rotary phone with coiled cord',
  'heavy glass ashtray with Soviet-era etching',
  'rusted tin watering can with bent spout',
  'dog-eared wall calendar from previous year',
  'ceramic sugar bowl with missing lid, spoon inside',
  'folded newspaper with visible Cyrillic headline',
];

// â”€â”€â”€ CATEGORY â†’ LOCATION ID PREFERENCES â”€â”€â”€â”€â”€
// Maps category to preferred location IDs from locations.json
const LOCATION_CATEGORY_MAP = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': ['soviet_kitchen', 'balcony', 'cellar', 'communal_corridor', 'elevator'],
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': ['soviet_kitchen', 'stairwell', 'balcony', 'garage', 'school_corridor'],
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': ['bazaar', 'soviet_kitchen', 'stairwell', 'pharmacy', 'post_office'],
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': ['soviet_kitchen', 'park_bench', 'balcony', 'dacha_veranda', 'fishing_spot'],
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': ['soviet_kitchen', 'attic', 'balcony', 'playground', 'school_corridor', 'cemetery_bench'],
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': ['stairwell', 'balcony', 'soviet_kitchen', 'elevator', 'communal_corridor', 'laundry_room'],
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': ['polyclinic', 'stairwell', 'soviet_kitchen', 'pharmacy', 'park_bench'],
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': ['balcony', 'soviet_kitchen', 'park_bench', 'playground', 'marshrutka'],
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': ['greenhouse', 'garden', 'barn', 'dacha_veranda', 'dacha_kitchen', 'chicken_coop'],
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': ['marshrutka', 'stairwell', 'park_bench', 'bus_stop', 'train_station'],
};

// â”€â”€â”€ CATEGORY â†’ PROP PREFERENCES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PROP_HINTS = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': ['cracked enamel kettle with chipped blue-white pattern', 'ceramic sugar bowl with missing lid, spoon inside'],
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': ['vintage Rigonda radio with bakelite knobs', 'wall-mounted rotary phone with coiled cord'],
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': ['folded newspaper with visible Cyrillic headline', 'ceramic sugar bowl with missing lid, spoon inside'],
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': ['heavy glass ashtray with Soviet-era etching', 'wall-mounted rotary phone with coiled cord'],
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': ['vintage Rigonda radio with bakelite knobs', 'dog-eared wall calendar from previous year'],
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': ['cracked enamel kettle with chipped blue-white pattern', 'old brass samovar with tarnished patina and wooden handles'],
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': ['dog-eared wall calendar from previous year', 'folded newspaper with visible Cyrillic headline'],
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': ['heavy glass ashtray with Soviet-era etching', 'folded newspaper with visible Cyrillic headline'],
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': ['rusted tin watering can with bent spout', 'dented aluminum bucket with water condensation'],
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': ['folded newspaper with visible Cyrillic headline', 'heavy glass ashtray with Soviet-era etching'],
};

// â”€â”€â”€ LIGHTING VARIATIONS BY LOCATION TYPE â”€â”€â”€
const LIGHTING_MOODS = [
  { style: 'warm amber backlight through dusty window, hard shadows, 3200K, golden dust motes in light beams', mood: 'nostalgic warmth' },
  { style: 'cool fluorescent overhead with greenish tint, flat institutional light, subtle flicker', mood: 'sterile tension' },
  { style: 'dappled natural light through foliage, shifting leaf shadows on faces, warm-cool contrast', mood: 'organic chaos' },
  { style: 'single bare bulb overhead, harsh directional light from above, deep eye-socket shadows', mood: 'dramatic intimacy' },
  { style: 'overcast diffused daylight from large window, soft shadowless fill, slight blue undertone', mood: 'calm before storm' },
];

const HUMOR_CATEGORIES = [
  { ru: 'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´', en: 'Domestic absurdity' },
  { ru: 'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸', en: 'AI and technology' },
  { ru: 'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ', en: 'Prices and inflation' },
  { ru: 'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ', en: 'Relationships' },
  { ru: 'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹', en: 'Generation gap' },
  { ru: 'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°', en: 'Housing utilities drama' },
  { ru: 'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°', en: 'Health and polyclinic' },
  { ru: 'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹', en: 'Social media trends' },
  { ru: 'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´', en: 'Dacha and gardening' },
  { ru: 'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸', en: 'Transport and traffic' },
];

// â”€â”€â”€ HASHTAG ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Instagram strategy 2026: 3-5 Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… (>1M), 5-8 ÑÑ€ĞµĞ´Ğ½Ğ¸Ñ… (100K-1M), 5-7 Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ñ… (<100K)
// ĞĞ¸ĞºĞ°ĞºĞ¾Ğ³Ğ¾ ÑĞ¿Ğ°Ğ¼Ğ° Ñ‚Ğ¸Ğ¿Ğ° #funny #comedy #viral â€” Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ Ğ´Ğ°ÑƒĞ½Ñ€ĞµĞ¹Ñ‚Ğ¸Ñ‚
// Ğ’ÑĞµ Ñ‚ĞµĞ³Ğ¸ Ğ Ğ•Ğ›Ğ•Ğ’ĞĞĞ¢ĞĞ« ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ñƒ

const HASHTAGS_BY_CATEGORY = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': {
    niche: ['#Ğ±Ñ‹Ñ‚Ğ¾Ğ²Ğ°ÑĞ´Ñ€Ğ°Ğ¼Ğ°', '#Ğ¶Ğ¸Ğ·Ğ°Ğ¶ĞµÑÑ‚ÑŒ', '#Ğ°Ğ±ÑÑƒÑ€Ğ´Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸', '#ÑÑ‚Ğ¾Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾', '#Ğ±Ñ‹Ñ‚Ğ¾Ğ²ÑƒÑ…Ğ°', '#ĞºÑƒÑ…Ğ¾Ğ½Ğ½Ñ‹ĞµĞ²Ğ¾Ğ¹Ğ½Ñ‹'],
    mid:   ['#Ğ¶Ğ¸Ğ·Ğ°', '#Ñ€Ğ¶ÑƒĞ½ĞµĞ¼Ğ¾Ğ³Ñƒ', '#ÑĞ¼ĞµÑˆĞ½Ğ¾Ğ´Ğ¾ÑĞ»Ñ‘Ğ·', '#Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ğ¾', '#Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ°Ğ¶Ğ¸Ğ·Ğ½Ğ¸'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ñ€ÑƒÑÑĞºĞ¸Ğ¹ÑĞ¼Ğ¾Ñ€'],
  },
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': {
    niche: ['#Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚ÑŒĞ¿Ñ€Ğ¾Ñ‚Ğ¸Ğ²Ğ±Ğ°Ğ±ĞºĞ¸', '#Ğ¸Ğ¸vsÑ‡ĞµĞ»Ğ¾Ğ²ĞµĞº', '#Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ñ‹Ğ·Ğ°Ğ¼ĞµĞ½ÑÑ‚', '#Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ³Ğ¾', '#chatgptĞ¿Ğ¾Ñ€ÑƒÑÑĞºĞ¸', '#Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚Ğ¸Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹'],
    mid:   ['#Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚', '#Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸', '#Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµĞ½Ğ°ÑÑ‚ÑƒĞ¿Ğ¸Ğ»Ğ¾', '#Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚ÑŒ', '#aihumor'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸2026'],
  },
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': {
    niche: ['#Ñ†ĞµĞ½Ñ‹Ğ¾Ñ…Ñ€ĞµĞ½ĞµĞ»Ğ¸', '#Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸ÑĞ´Ğ½Ñ', '#Ğ´Ğ¾Ñ€Ğ¾Ğ¶ĞµĞ²ÑÑ‘', '#Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹Ğ¿Ğ¾Ğ´Ğ¾Ñ€Ğ¾Ğ¶Ğ°Ğ»Ğ¸', '#Ñ†ĞµĞ½Ğ½Ğ¸Ğº2026', '#ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ğ¼Ğ²Ğ¼ĞµÑÑ‚Ğµ'],
    mid:   ['#Ñ†ĞµĞ½Ñ‹', '#Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ', '#Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ¾', '#Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½', '#Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ¶Ğ¸Ğ·Ğ°'],
  },
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': {
    niche: ['#Ğ¼ÑƒĞ¶Ğ¸ĞºĞ¸Ñ‚Ğ°ĞºĞ¸Ğµ', '#Ğ¶ĞµĞ½Ñ‰Ğ¸Ğ½Ñ‹Ñ‚Ğ°ĞºĞ¸Ğµ', '#Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸ÑÑÑ‚Ğ¾', '#Ğ¿Ğ°Ñ€Ğ¾Ñ‡ĞºĞ¸', '#Ğ»ÑĞ±Ğ¾Ğ²ÑŒĞ¿Ğ¾Ñ€ÑƒÑÑĞºĞ¸', '#ÑĞ²Ğ¸Ğ´Ğ°Ğ½Ğ¸ĞµĞ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹'],
    mid:   ['#Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ', '#Ğ»ÑĞ±Ğ¾Ğ²ÑŒ', '#Ğ¿Ğ°Ñ€ĞµĞ½ÑŒ', '#ÑĞµĞ¼ÑŒÑ', '#Ğ¼ÑƒĞ¶'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ°Ğ¶Ğ¸Ğ·Ğ½Ğ¸'],
  },
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': {
    niche: ['#Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸ĞµĞ·ÑƒĞ¼ĞµÑ€Ğ¾Ğ²', '#Ğ¾ĞºĞµĞ¹Ğ±ÑƒĞ¼ĞµÑ€', '#Ğ±Ğ°Ğ±ĞºĞ°vsĞ²Ğ½ÑƒÑ‡ĞºĞ°', '#Ğ¼Ğ¾Ğ»Ğ¾Ğ´Ñ‘Ğ¶ÑŒÑ‚Ğ°ĞºĞ°Ñ', '#ÑÑ‚Ğ°Ñ€ÑˆĞµĞµĞ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğµ', '#ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹'],
    mid:   ['#Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ñ', '#Ğ¼Ğ¾Ğ»Ğ¾Ğ´Ñ‘Ğ¶ÑŒ', '#Ğ±Ğ°Ğ±ÑƒÑˆĞºĞ°', '#Ğ²Ğ½ÑƒĞºĞ¸', '#Ğ·ÑƒĞ¼ĞµÑ€Ñ‹'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ğ¾'],
  },
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': {
    niche: ['#Ğ¶ĞºÑ…Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°Ğ³Ğ¾Ñ€Ğ¸Ñ‚', '#ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‰Ğ°ÑĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ', '#ĞºĞ²Ğ¸Ñ‚Ğ°Ğ½Ñ†Ğ¸ÑĞºĞ¾ÑĞ¼Ğ¾Ñ', '#Ğ¾Ñ‚Ğ¾Ğ¿Ğ»ĞµĞ½Ğ¸ĞµĞ²ĞºĞ»ÑÑ‡Ğ¸Ğ»Ğ¸', '#ÑĞ¾ÑĞµĞ´Ğ¸ÑĞ½Ğ¸Ğ·Ñƒ'],
    mid:   ['#Ğ¶ĞºÑ…', '#ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°', '#ĞºĞ²Ğ°Ñ€Ñ‚Ğ¸Ñ€Ğ°', '#ÑĞ¾ÑĞµĞ´Ğ¸', '#ÑÑ‡Ñ‘Ñ‚Ğ·Ğ°ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºÑƒ'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ¶Ğ¸Ğ·Ğ°'],
  },
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': {
    niche: ['#Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒĞºĞ²Ğ²Ñ€Ğ°Ñ‡Ñƒ', '#Ğ´Ğ¾ĞºÑ‚Ğ¾Ñ€ÑĞºĞ°Ğ·Ğ°Ğ»', '#Ğ¼ĞµĞ´Ğ¸Ñ†Ğ¸Ğ½Ğ°Ğ¿Ğ¾Ñ€ÑƒÑÑĞºĞ¸', '#Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ğ¾Ñ‚Ğ±Ğ°Ğ±ĞºĞ¸', '#Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµĞ½ĞµĞºÑƒĞ¿Ğ¸ÑˆÑŒ'],
    mid:   ['#Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°', '#Ğ²Ñ€Ğ°Ñ‡', '#Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ', '#Ğ¼ĞµĞ´Ğ¸Ñ†Ğ¸Ğ½Ğ°', '#Ğ±Ğ¾Ğ»ÑŒĞ½Ğ¸Ñ†Ğ°'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ°Ğ¶Ğ¸Ğ·Ğ½Ğ¸'],
  },
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': {
    niche: ['#Ğ±Ğ»Ğ¾Ğ³ĞµÑ€Ñ‹Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ñ‚Ğ¸ĞºÑ‚Ğ¾ĞºĞµÑ€Ñ‹', '#Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¸', '#ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ¼ĞµĞ¹ĞºĞµÑ€', '#Ñ…Ğ°Ğ¹Ğ¿Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»ÑĞ¼ĞµĞ¹ĞºĞµÑ€'],
    mid:   ['#ÑĞ¾Ñ†ÑĞµÑ‚Ğ¸', '#Ğ±Ğ»Ğ¾Ğ³ĞµÑ€', '#Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹', '#Ğ¸Ğ½ÑÑ‚Ğ°Ğ³Ñ€Ğ°Ğ¼', '#ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹2026'],
  },
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': {
    niche: ['#Ğ´Ğ°Ñ‡Ğ°Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ½Ğ¸ĞºĞ°Ğ¼', '#Ğ¿Ğ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€Ğ½Ğ°ÑĞ´Ñ€Ğ°Ğ¼Ğ°', '#ÑĞ¾ÑĞµĞ´Ğ¿Ğ¾Ğ´Ğ°Ñ‡Ğµ', '#ÑƒÑ€Ğ¾Ğ¶Ğ°Ğ¹2026', '#Ğ³Ñ€ÑĞ´ĞºĞ¸Ğ²Ğ¾Ğ¹Ğ½Ñ‹'],
    mid:   ['#Ğ´Ğ°Ñ‡Ğ°', '#Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´', '#ÑƒÑ€Ğ¾Ğ¶Ğ°Ğ¹', '#ÑĞ°Ğ´', '#Ğ´Ğ°Ñ‡Ğ½Ğ°ÑĞ¶Ğ¸Ğ·Ğ½ÑŒ'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ»ĞµÑ‚Ğ¾'],
  },
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': {
    niche: ['#Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸Ğ¼Ğ¾ÑĞºĞ²Ñ‹', '#Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚ĞºĞ°Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#ÑĞ°Ğ¼Ğ¾ĞºĞ°Ñ‚Ğ²ÑĞ³Ğ¾Ñ€Ğ¾Ğ´', '#Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ¸Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚', '#Ğ¿Ğ°Ñ€ĞºĞ¾Ğ²ĞºĞ°Ğ´Ñ€Ğ°Ğ¼Ğ°'],
    mid:   ['#Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸', '#Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚', '#Ğ¼ĞµÑ‚Ñ€Ğ¾', '#ÑĞ°Ğ¼Ğ¾ĞºĞ°Ñ‚', '#Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ'],
    big:   ['#ÑĞ¼Ğ¾Ñ€Ğ´Ğ½Ñ', '#Ñ€Ğ¸Ğ»Ñ', '#Ğ¼Ğ¾ÑĞºĞ²Ğ°'],
  },
};

// Evergreen Ñ‚ĞµĞ³Ğ¸ â€” Ğ¿Ğ¾Ğ´Ğ¼ĞµÑˆĞ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ²ÑĞµĞ³Ğ´Ğ° (2-3 ÑˆÑ‚)
const EVERGREEN_TAGS = [
  '#Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸', '#Ğ¿Ğ¾Ğ¿Ğ°Ğ»Ğ²Ñ€ĞµĞºĞ¸', '#Ğ·Ğ°Ğ»ĞµÑ‚ĞµĞ²Ñ€ĞµĞºĞ¸',
  '#shorts', '#reels', '#Ñ€Ğ¸Ğ»ÑÑ‹',
  '#ÑĞ¼ĞµÑˆĞ½Ğ¾ĞµĞ²Ğ¸Ğ´ĞµĞ¾', '#Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹2026', '#ÑĞ¼Ğ¾Ñ€',
];

// ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ½Ñ‹Ğµ Ñ‚ĞµĞ³Ğ¸ Ğ¿Ğ¾ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°Ğ¼
const GROUP_HASHTAGS = {
  'Ğ±Ğ°Ğ±ĞºĞ¸':      ['#Ğ±Ğ°Ğ±ĞºĞ°Ğ¶Ğ¶Ñ‘Ñ‚', '#Ğ±Ğ°Ğ±ÑƒÑˆĞºĞ°ÑĞºĞ°Ğ·Ğ°Ğ»Ğ°', '#Ğ±Ğ°Ğ±ĞºĞ¸Ğ¾Ğ³Ğ¾Ğ½ÑŒ', '#ÑÑ‚Ğ°Ñ€ÑˆĞµĞµĞ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğµ'],
  'Ğ´ĞµĞ´Ñ‹':       ['#Ğ´ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ»', '#Ğ´ĞµĞ´Ğ¼ÑƒĞ´Ñ€Ğ¾ÑÑ‚ÑŒ', '#ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹Ğ´Ğ°Ñ€ÑƒÑÑĞºĞ¸Ğ¹', '#Ğ´ĞµĞ´Ğ¾Ğ²ÑĞºĞ¸Ğ¹ÑĞ¼Ğ¾Ñ€'],
  'Ğ¼Ğ°Ğ¼Ñ‹':       ['#Ğ¼Ğ°Ğ¼Ğ°ÑĞºĞ°Ğ·Ğ°Ğ»Ğ°', '#Ğ¼Ğ°Ğ¼Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ°', '#Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ½ÑĞºĞ¸Ğ¹Ğ¸Ğ½ÑÑ‚Ğ¸Ğ½ĞºÑ‚', '#Ğ¼Ğ°Ğ¼Ñ‹Ğ¿Ğ¾Ğ¹Ğ¼ÑƒÑ‚'],
  'Ğ¿Ğ°Ğ¿Ñ‹':       ['#Ğ¿Ğ°Ğ¿Ğ°ÑĞºĞ°Ğ·Ğ°Ğ»', '#Ğ¿Ğ°Ğ¿Ğ°ÑˆÑƒÑ‚Ğ¸Ñ‚', '#Ğ¾Ñ‚ĞµÑ†Ğ¼Ğ¾Ğ»Ğ¾Ğ´ĞµÑ†', '#Ğ¿Ğ°Ğ¿Ğ¸Ğ½Ñ‹Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹'],
  'Ğ´Ğ¾Ñ‡ĞµÑ€Ğ¸':     ['#Ğ´Ğ¾Ñ‡ĞºĞ°Ñ‚Ğ°ĞºĞ°Ñ', '#Ğ´Ğ¾Ñ‡ÑŒvsmama', '#Ğ¼Ğ¾Ğ»Ğ¾Ğ´Ñ‘Ğ¶ÑŒ', '#Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸ĞµĞ°Ğ»ÑŒÑ„Ğ°'],
  'ÑÑ‹Ğ½Ğ¾Ğ²ÑŒÑ':    ['#ÑÑ‹Ğ½Ñ‚Ğ°ĞºĞ¾Ğ¹', '#ÑÑ‹Ğ½vsĞ¾Ñ‚ĞµÑ†', '#Ğ¿Ğ°Ñ†Ğ°Ğ½Ñ‹', '#ÑÑ‹Ğ½Ğ¾Ğº'],
  'Ñ‚Ñ‘Ñ‰Ğ¸':       ['#Ñ‚Ñ‘Ñ‰Ğ°Ğ¾Ğ³Ğ¾Ğ½ÑŒ', '#Ñ‚Ñ‘Ñ‰Ğ°ÑĞºĞ°Ğ·Ğ°Ğ»Ğ°', '#Ğ·ÑÑ‚ÑŒĞ²ÑˆĞ¾ĞºĞµ', '#Ñ‚Ñ‘Ñ‰Ğ°vsĞ·ÑÑ‚ÑŒ'],
  'ÑĞ²ĞµĞºÑ€Ğ¾Ğ²Ğ¸':   ['#ÑĞ²ĞµĞºÑ€Ğ¾Ğ²ÑŒ', '#ÑĞ²ĞµĞºÑ€Ğ¾Ğ²ÑŒÑĞºĞ°Ğ·Ğ°Ğ»Ğ°', '#Ğ½ĞµĞ²ĞµÑÑ‚ĞºĞ°Ğ²ÑˆĞ¾ĞºĞµ', '#ÑĞµĞ¼ĞµĞ¹Ğ½Ñ‹ĞµĞ´Ñ€Ğ°Ğ¼Ñ‹'],
  'ÑĞ¾ÑĞµĞ´Ğ¸':     ['#ÑĞ¾ÑĞµĞ´Ğ¸Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#ÑĞ¾ÑĞµĞ´Ñ‚Ğ°ĞºĞ¾Ğ¹', '#Ğ¿Ğ¾Ğ´ÑŠĞµĞ·Ğ´Ğ½Ğ°ÑĞ´Ñ€Ğ°Ğ¼Ğ°', '#ÑĞ¾ÑĞµĞ´Ğ¸ÑĞºĞ°Ğ½Ğ´Ğ°Ğ»'],
  'Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ñ†Ñ‹':   ['#Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ñ‰Ğ¸Ñ†Ğ°', '#Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ğ½Ğ°ĞºĞ°ÑÑĞµ', '#Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ÑŒĞ²ÑˆĞ¾ĞºĞµ'],
  'Ğ²Ñ€Ğ°Ñ‡Ğ¸':      ['#Ğ´Ğ¾ĞºÑ‚Ğ¾Ñ€Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ğ²Ñ€Ğ°Ñ‡ÑĞºĞ°Ğ·Ğ°Ğ»', '#Ğ¼ĞµĞ´Ğ¸ĞºĞ¸ÑˆÑƒÑ‚ÑÑ‚', '#Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ·ÑĞ¼Ğ¾Ñ€'],
  'ÑƒÑ‡Ğ¸Ñ‚ĞµĞ»Ñ':    ['#ÑƒÑ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¸Ñ†Ğ°', '#ÑˆĞºĞ¾Ğ»Ğ°Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#ÑƒÑ‡Ğ¸Ñ‚ĞµĞ»ÑŒ', '#ÑƒÑ€Ğ¾ĞºĞ¶Ğ¸Ğ·Ğ½Ğ¸'],
  'Ğ±Ğ»Ğ¾Ğ³ĞµÑ€Ñ‹':    ['#Ğ±Ğ»Ğ¾Ğ³ĞµÑ€ÑˆĞ°', '#Ğ¸Ğ½ÑÑ‚Ğ°Ğ±Ğ»Ğ¾Ğ³ĞµÑ€', '#Ğ±Ğ»Ğ¾Ğ³ĞµÑ€Ñ‹Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ¼ĞµĞ¹ĞºĞµÑ€'],
  'Ñ‚Ğ°ĞºÑĞ¸ÑÑ‚Ñ‹':   ['#Ñ‚Ğ°ĞºÑĞ¸ÑÑ‚', '#ÑĞ½Ğ´ĞµĞºÑÑ‚Ğ°ĞºÑĞ¸', '#Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑ‚Ğ°ĞºÑĞ¸', '#Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ°Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹'],
  'Ğ±Ğ¸Ğ·Ğ½ĞµÑĞ¼ĞµĞ½Ñ‹': ['#Ğ±Ğ¸Ğ·Ğ½ĞµÑĞ¼ĞµĞ½', '#Ğ±Ğ¸Ğ·Ğ½ĞµÑĞ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹', '#Ğ¿Ñ€ĞµĞ´Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒ', '#ÑÑ‚Ğ°Ñ€Ñ‚Ğ°Ğ¿'],
  'ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚Ñ‹':   ['#ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚', '#ÑƒĞ½Ğ¸Ğ²ĞµÑ€', '#ÑĞµÑÑĞ¸Ñ', '#ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‡ĞµÑĞºĞ¸Ğ¹ÑĞ¼Ğ¾Ñ€'],
  'Ğ¿ĞµĞ½ÑĞ¸Ğ¾Ğ½ĞµÑ€Ñ‹': ['#Ğ¿ĞµĞ½ÑĞ¸Ğ¾Ğ½ĞµÑ€', '#Ğ¿ĞµĞ½ÑĞ¸Ñ', '#Ğ¿ĞµĞ½ÑĞ¸Ğ¾Ğ½ĞµÑ€Ñ‹Ğ¶Ğ³ÑƒÑ‚', '#ÑÑ‚Ğ°Ñ€ÑˆĞµĞµĞ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğµ'],
  'Ñ‡Ğ¸Ğ½Ğ¾Ğ²Ğ½Ğ¸ĞºĞ¸':  ['#Ñ‡Ğ¸Ğ½Ğ¾Ğ²Ğ½Ğ¸ĞºĞ¸', '#Ğ±ÑÑ€Ğ¾ĞºÑ€Ğ°Ñ‚Ğ¸Ñ', '#Ğ³Ğ¾ÑÑƒÑĞ»ÑƒĞ³Ğ¸', '#Ğ¼Ñ„Ñ†'],
  'Ñ„Ğ¸Ñ‚Ğ½ĞµÑ':     ['#Ñ„Ğ¸Ñ‚Ğ½ĞµÑÑĞ¼Ğ¾Ñ€', '#Ğ·Ğ¾Ğ¶', '#Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°', '#Ñ„Ğ¸Ñ‚Ğ½ĞµÑÑ‚Ñ€ĞµĞ½ĞµÑ€'],
  'ĞºĞ¾ÑˆĞ°Ñ‚Ğ½Ğ¸Ñ†Ñ‹':  ['#ĞºĞ¾ÑˆĞ°Ñ‚Ğ½Ğ¸Ñ†Ğ°', '#ĞºĞ¾Ñ‚Ğ¸ĞºĞ¸', '#ĞºĞ¾ÑˆĞºĞ¸Ğ¿Ñ€Ğ°Ğ²ÑÑ‚', '#ĞºĞ¾Ñ‚Ğ¾Ğ¼Ğ°Ğ¼Ğ°'],
  'ÑĞºÑÑ‚Ñ€ĞµĞ¼Ğ°Ğ»Ñ‹': ['#ÑĞºÑÑ‚Ñ€Ğ¸Ğ¼', '#Ğ°Ğ´Ñ€ĞµĞ½Ğ°Ğ»Ğ¸Ğ½', '#ÑĞºÑÑ‚Ñ€ĞµĞ¼Ğ°Ğ»', '#Ğ±ĞµĞ·Ğ±Ğ°ÑˆĞµĞ½Ğ½Ñ‹Ğ¹'],
};

// â”€â”€â”€ VIRAL TITLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Hook-Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñ‹: Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ / ÑˆĞ¾Ğº / Ğ½ĞµĞ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ / Ğ¿Ñ€Ğ¾Ğ²Ğ¾ĞºĞ°Ñ†Ğ¸Ñ
const VIRAL_TITLES = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': [
    'ĞĞ½Ğ° Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ ÑÑ‚Ğ¾ ÑĞºĞ°Ğ·Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¸ Ğ²ÑĞµÑ…...',
    'ĞšĞ¾Ğ³Ğ´Ğ° {A} ÑƒĞ·Ğ½Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ°Ğ²Ğ´Ñƒ â€” Ğ»Ğ¸Ñ†Ğ¾ Ğ±ĞµÑÑ†ĞµĞ½Ğ½Ğ¾ ğŸ’€',
    'Ğ’Ğ¾Ñ‚ Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ñ {A} Ğ»ÑƒÑ‡ÑˆĞµ Ğ½Ğµ ÑĞ¿Ğ¾Ñ€Ğ¸Ñ‚ÑŒ',
    '{A} vs Ğ·Ğ´Ñ€Ğ°Ğ²Ñ‹Ğ¹ ÑĞ¼Ñ‹ÑĞ»: 0-1 ğŸ¤£',
    'ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ ÑĞ»Ğ¾Ğ²Ğ° {B} ÑƒĞ±Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ğ¿Ğ¾Ğ²Ğ°Ğ»',
  ],
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': [
    '{A} Ğ²Ğ¿ĞµÑ€Ğ²Ñ‹Ğµ ÑƒĞ·Ğ½Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¾ Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚Ğ¸... Ğ¸ Ğ¿Ğ¾Ğ½ĞµÑĞ»Ğ¾ÑÑŒ ğŸ’€',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ğ» Ñ‡Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ AI Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ğ¼Ğ¸ ÑĞ»Ğ¾Ğ²Ğ°Ğ¼Ğ¸',
    'Ğ ĞµĞ°ĞºÑ†Ğ¸Ñ {A} Ğ½Ğ° Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ â€” Ğ‘Ğ•Ğ¡Ğ¦Ğ•ĞĞĞ',
    '{B} Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹ ÑƒĞ½Ğ¸Ñ‡Ñ‚Ğ¾Ğ¶Ğ¸Ğ» Ğ²ĞµÑÑŒ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ',
    'ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸ ÑÑ‚Ğ¾ Ñ‚Ğ¾Ğ¼Ñƒ ĞºÑ‚Ğ¾ Ğ±Ğ¾Ğ¸Ñ‚ÑÑ Ñ‡Ñ‚Ğ¾ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ñ‹ Ğ·Ğ°Ğ¼ĞµĞ½ÑÑ‚ Ğ»ÑĞ´ĞµĞ¹',
  ],
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': [
    '{A} Ğ·Ğ°ÑˆĞ»Ğ° Ğ² Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½ Ğ¸ Ğ°Ñ…Ğ½ÑƒĞ»Ğ°... ğŸ˜±',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} Ğ²ÑĞ¿Ğ¾Ğ¼Ğ½Ğ¸Ğ» Ñ†ĞµĞ½Ñ‹ Ğ¸Ğ· 90-Ñ… â€” {A} Ğ² ÑˆĞ¾ĞºĞµ',
    'Ğ¦ĞµĞ½Ñ‹ 2026: {A} Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ',
    'ĞĞ´Ğ½Ğ° Ñ„Ñ€Ğ°Ğ·Ğ° {B} Ğ¿Ñ€Ğ¾ Ñ†ĞµĞ½Ñ‹ Ğ·Ğ°ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ Ñ‚ĞµĞ±Ñ Ğ¿Ğ»Ğ°ĞºĞ°Ñ‚ÑŒ Ğ¸ ÑĞ¼ĞµÑÑ‚ÑŒÑÑ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾',
    'Ğ’Ğ¾Ñ‚ Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ {A} Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğµ Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½',
  ],
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': [
    'ĞšĞ¾Ğ³Ğ´Ğ° {A} Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ»Ğ° Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑĞºÑƒ â€” {B} Ğ²ÑÑ‘ Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ğ» Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹ ğŸ’€',
    '{B} Ñ€Ğ°ÑÑĞºĞ°Ğ·Ğ°Ğ» ĞºĞ°Ğº Ñ€Ğ°Ğ½ÑŒÑˆĞµ ÑƒÑ…Ğ°Ğ¶Ğ¸Ğ²Ğ°Ğ»Ğ¸ â€” Ğ´ĞµĞ²Ğ¾Ñ‡ĞºĞ¸, Ğ²Ñ‹ Ğ½Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹',
    'Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ {B} Ğ½Ğ° Ğ¶Ğ°Ğ»Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾ ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¼ÑƒĞ¶Ğ¸ĞºĞ¾Ğ²',
    '{A} Ğ¾Ğ¿Ğ¸ÑĞ°Ğ»Ğ° ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ â€” {B} Ğ² Ğ°ÑƒÑ‚Ğµ',
    'ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ» Ğ¼Ğ°Ğ¼Ğµ â€” Ğ¾Ğ½Ğ° Ğ¿Ğ»Ğ°ĞºĞ°Ğ»Ğ° Ğ¾Ñ‚ ÑĞ¼ĞµÑ…Ğ°',
  ],
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': [
    '{A} ÑƒĞ·Ğ½Ğ°Ğ»Ğ° Ñ‡ĞµĞ¼ Ğ·Ğ°Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ÑÑ Ğ²Ğ½ÑƒÑ‡ĞºĞ° â€” Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ ğŸ’€',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ğ» Ğ¼Ğ¾Ğ»Ğ¾Ğ´Ñ‘Ğ¶ÑŒ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹',
    '{A} vs TikTok: Ğ±Ğ¾Ğ¹ Ğ²ĞµĞºĞ°',
    'Ğ’Ğ¾Ñ‚ Ñ‚Ğ°Ğº {B} Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğµ Z',
    'ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞµ â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ ğŸ¤£',
  ],
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': [
    '{A} Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ° ĞºĞ²Ğ¸Ñ‚Ğ°Ğ½Ñ†Ğ¸Ñ â€” ÑÑĞ´ÑŒÑ‚Ğµ ğŸ˜±',
    'ĞÑ‚Ğ²ĞµÑ‚ {B} Ğ½Ğ° ÑÑ‡Ñ‘Ñ‚ Ğ·Ğ° Ğ–ĞšĞ¥ â€” Ğ³ĞµĞ½Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾',
    'Ğ’Ğ¾Ñ‚ Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ {A} Ğ²Ğ¾ÑĞµÑ‚ Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‰ĞµĞ¹ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸ĞµĞ¹',
    '{B} Ğ¿Ñ€Ğ¾ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºÑƒ â€” Ğ±Ğ¾Ğ»ÑŒĞ½Ğ¾ Ğ½Ğ¾ ÑĞ¼ĞµÑˆĞ½Ğ¾',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ ÑÑ‚Ğ¾ Ğ² Ñ‡Ğ°Ñ‚ Ğ´Ğ¾Ğ¼Ğ° â€” ÑĞ¾ÑĞµĞ´Ğ¸ Ğ¾Ñ†ĞµĞ½ÑÑ‚',
  ],
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': [
    '{A} Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğ° Ğº Ğ²Ñ€Ğ°Ñ‡Ñƒ â€” Ñ Ğ¿Ğ»Ğ°ĞºĞ°Ğ» ğŸ’€',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ğ» Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ· Ğ»ÑƒÑ‡ÑˆĞµ Ğ´Ğ¾ĞºÑ‚Ğ¾Ñ€Ğ°',
    'Ğ ĞµĞ°ĞºÑ†Ğ¸Ñ {A} Ğ½Ğ° ÑĞ¾Ğ²ĞµÑ‚ Ğ²Ñ€Ğ°Ñ‡Ğ° â€” Ğ—ĞĞ›ĞĞ¢Ğ',
    '{B} Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ» Ğ²ÑÑ Ğ¼ĞµĞ´Ğ¸Ñ†Ğ¸Ğ½Ñƒ',
    'ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸ Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ğ¾Ğ¼Ñƒ Ğ²Ñ€Ğ°Ñ‡Ñƒ â€” Ğ¾Ñ†ĞµĞ½Ğ¸Ñ‚ ğŸ¤£',
  ],
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': [
    '{A} ÑƒĞ·Ğ½Ğ°Ğ»Ğ° Ñ‡Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¸ â€” Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ ğŸ’€',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ğ» ÑÑƒÑ‚ÑŒ Ğ±Ğ»Ğ¾Ğ³Ğ¸Ğ½Ğ³Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹',
    '{A} vs Instagram: ĞºÑ‚Ğ¾ ĞºĞ¾Ğ³Ğ¾',
    'ĞÑ‚Ğ²ĞµÑ‚ {B} Ğ¿Ñ€Ğ¾ Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ² â€” Ğ³ĞµĞ½Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ±Ğ»Ğ¾Ğ³ĞµÑ€Ñƒ â€” Ğ¿ÑƒÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ·Ñ€ĞµĞµÑ‚ ğŸ¤£',
  ],
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': [
    '{A} Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ğ»Ğ° Ñ‡Ñ‚Ğ¾ ÑĞ»ÑƒÑ‡Ğ¸Ğ»Ğ¾ÑÑŒ Ñ Ğ¿Ğ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€Ğ°Ğ¼Ğ¸ ğŸ˜±',
    'Ğ’ĞµÑ€ÑĞ¸Ñ {B} ĞºÑ‚Ğ¾ ÑĞ¾Ğ¶Ñ€Ğ°Ğ» ÑƒÑ€Ğ¾Ğ¶Ğ°Ğ¹ â€” Ñ Ñ€Ñ‹Ğ´Ğ°Ğ»',
    '{A} vs Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´: Ğ²ĞµÑ‡Ğ½Ğ°Ñ Ğ±Ğ¸Ñ‚Ğ²Ğ°',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ğ» ÑÑƒÑ‚ÑŒ Ğ´Ğ°Ñ‡Ğ½Ğ¾Ğ¹ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ´Ğ°Ñ‡Ğ½Ğ¸ĞºÑƒ â€” Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ÑƒĞ·Ğ½Ğ°ĞµÑ‚ ÑĞµĞ±Ñ ğŸ¤£',
  ],
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': [
    '{A} Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ÑĞ»Ğ° Ğ² Ğ¿Ñ€Ğ¾Ğ±ĞºĞµ 2 Ñ‡Ğ°ÑĞ° â€” Ğ¸ Ğ²Ğ¾Ñ‚ Ñ‡Ñ‚Ğ¾ ÑĞºĞ°Ğ·Ğ°Ğ»Ğ° ğŸ’€',
    'ĞšĞ¾Ğ³Ğ´Ğ° {B} ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ» Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ â€” {A} Ğ² ÑˆĞ¾ĞºĞµ',
    '{A} vs Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: 0-1',
    'ĞÑ‚Ğ²ĞµÑ‚ {B} Ğ¿Ñ€Ğ¾ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸ Ğ·Ğ°ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ Ğ¿Ğ»Ğ°ĞºĞ°Ñ‚ÑŒ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¹',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ ĞºÑ‚Ğ¾ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ² Ğ¿Ñ€Ğ¾Ğ±ĞºĞµ ğŸ¤£',
  ],
};

// â”€â”€â”€ PIN COMMENTS (Ğ—ĞĞšĞ Ğ•ĞŸĞ«) â€” Ğ±Ğ°Ğ¹Ñ‚ Ğ½Ğ° Ğ¿ĞµÑ€ĞµÑÑ‹Ğ»ĞºÑƒ â”€â”€
const PIN_COMMENTS = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': [
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ, Ñƒ ĞºĞ¾Ğ³Ğ¾ Ğ´Ğ¾Ğ¼Ğ° Ñ‚Ğ°ĞºĞ¾Ğ¹ Ğ¶Ğµ Ñ†Ğ¸Ñ€Ğº ğŸªğŸ˜‚',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ¼Ğ°Ğ¼Ğµ â€” Ğ¾Ğ½Ğ° Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ÑĞºĞ°Ğ¶ĞµÑ‚ Â«ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾ Ğ½Ğ°ÑÂ» ğŸ’€',
    'Ğ¢ĞµĞ³ Ğ¿Ğ¾Ğ´Ñ€ÑƒĞ³Ñƒ Ñƒ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ñ‚Ğ°Ğº Ğ¶Ğµ Ğ´Ğ¾Ğ¼Ğ° ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑƒĞ·Ğ½Ğ°Ğ» ÑĞ²Ğ¾Ñ ÑĞµĞ¼ÑŒÑ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ² ÑĞµĞ¼ĞµĞ¹Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚ Ğ¸ Ğ¶Ğ´Ğ¸ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ ğŸ“±',
  ],
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': [
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ Ğ´Ğ¾ ÑĞ¸Ñ… Ğ¿Ğ¾Ñ€ Ğ±Ğ¾Ğ¸Ñ‚ÑÑ Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚ĞµĞ¹ ğŸ¤–ğŸ˜‚',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞµ Ğ¸ ÑĞ½Ğ¸Ğ¼Ğ¸ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ Ğ½Ğ° ĞºĞ°Ğ¼ĞµÑ€Ñƒ ğŸ’€',
    'Ğ¢ĞµĞ³ Ğ´Ñ€ÑƒĞ³Ğ° ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ´ÑƒĞ¼Ğ°ĞµÑ‚ Ñ‡Ñ‚Ğ¾ AI â€” ÑÑ‚Ğ¾ ĞµÑ€ÑƒĞ½Ğ´Ğ° ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑĞ¾Ğ³Ğ»Ğ°ÑĞµĞ½ Ñ {B} â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ Â«Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ñ‹ Ğ½Ğ°Ñ Ğ·Ğ°Ğ¼ĞµĞ½ÑÑ‚Â» ğŸ“±',
  ],
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': [
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ±Ñ‹Ğ» Ğ² Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğµ ğŸ›’ğŸ˜­',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ¼Ğ°Ğ¼Ğµ â€” Ğ¾Ğ½Ğ° Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ ĞºĞ°Ğ¶Ğ´Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ ğŸ’€',
    'Ğ¢ĞµĞ³ Ñ‚Ğ¾Ğ³Ğ¾, ĞºÑ‚Ğ¾ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚ Ñ†ĞµĞ½Ñ‹ Ğ¸Ğ· 90-Ñ… ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑƒĞ¶Ğµ Ğ¿Ğ»Ğ°Ñ‡ĞµÑ‚ Ğ½Ğ° ĞºĞ°ÑÑĞµ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ñ‡Ğ°Ñ‚ â€” Ğ²ÑĞµ Ğ¿Ğ¾Ğ¹Ğ¼ÑƒÑ‚ ğŸ“±',
  ],
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': [
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ğ¿Ğ¾Ğ´Ñ€ÑƒĞ³Ğµ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ¶Ğ°Ğ»ÑƒĞµÑ‚ÑÑ Ğ½Ğ° Ğ¼ÑƒĞ¶Ğ¸ĞºĞ¾Ğ² ğŸ’…ğŸ˜‚',
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ¿Ğ°Ñ€Ğ½Ñ â€” Ğ¿ÑƒÑÑ‚ÑŒ ÑƒÑ‡Ğ¸Ñ‚ÑÑ ğŸ’€',
    'Ğ¢ĞµĞ³ Ñ‚Ğ¾Ğ³Ğ¾, ĞºÑ‚Ğ¾ Ñ‚Ğ°Ğº Ğ¶Ğµ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ÑÑ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑƒĞ·Ğ½Ğ°Ğ» ÑĞµĞ±Ñ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ² Ğ¶ĞµĞ½ÑĞºĞ¸Ğ¹ Ñ‡Ğ°Ñ‚ Ğ¸ ÑÑ‡Ğ¸Ñ‚Ğ°Ğ¹ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ğ¸ ğŸ“±',
  ],
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': [
    'Ğ¡ĞºĞ¸Ğ½ÑŒ ÑÑ‚Ğ¾ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞµ â€” ÑĞ½Ğ¸Ğ¼Ğ°Ğ¹ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ Ğ½Ğ° ĞºĞ°Ğ¼ĞµÑ€Ñƒ ğŸ“±ğŸ˜‚',
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ğ² ÑĞµĞ¼ĞµĞ¹Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚ â€” Ğ±Ğ°Ğ±ÑƒÑˆĞºĞ° Ğ¾Ñ†ĞµĞ½Ğ¸Ñ‚ ğŸ’€',
    'Ğ¢ĞµĞ³ Ğ±ÑƒĞ¼ĞµÑ€Ğ° Ğ¸ Ğ·ÑƒĞ¼ĞµÑ€Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑĞ»Ñ‹ÑˆĞ°Ğ» Ñ‚Ğ°ĞºĞ¾Ğµ Ğ¾Ñ‚ ÑÑ‚Ğ°Ñ€ÑˆĞ¸Ñ… â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ²Ğ½ÑƒĞºĞ°Ğ¼ â€” Ğ¸Ğ»Ğ¸ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞµ â€” ĞºĞ¾Ğ¼Ñƒ ÑĞ¼ĞµĞ»ĞµĞµ ğŸ“±',
  ],
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': [
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ² Ñ‡Ğ°Ñ‚ Ğ´Ğ¾Ğ¼Ğ° â€” ÑĞ¾ÑĞµĞ´Ğ¸ Ğ¿Ğ¾Ğ¹Ğ¼ÑƒÑ‚ ğŸ ğŸ˜‚',
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‰ĞµĞ¹ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸ ğŸ’€',
    'Ğ¢ĞµĞ³ ÑĞ¾ÑĞµĞ´Ğ°, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ñ‚Ğ¾Ğ¶Ğµ Ğ² ÑˆĞ¾ĞºĞµ Ğ¾Ñ‚ ĞºĞ²Ğ¸Ñ‚Ğ°Ğ½Ñ†Ğ¸Ğ¹ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚ Ğ·Ğ° Ğ–ĞšĞ¥ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥ (Ñ‚Ğ¾ ĞµÑÑ‚ÑŒ Ğ²ÑĞµ)',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ Ğ¶Ğ°Ğ»ÑƒĞµÑ‚ÑÑ Ğ½Ğ° Ğ±Ğ°Ñ‚Ğ°Ñ€ĞµĞ¸ ğŸ“±',
  ],
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': [
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ğ¾Ğ¼Ñƒ Ğ²Ñ€Ğ°Ñ‡Ñƒ â€” Ğ¿ÑƒÑÑ‚ÑŒ Ğ¾Ñ†ĞµĞ½Ğ¸Ñ‚ ğŸ¥ğŸ˜‚',
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ Ğ½ĞµĞ½Ğ°Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸ Ğ² Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞµ ğŸ’€',
    'Ğ¢ĞµĞ³ Ğ´Ñ€ÑƒĞ³Ğ° ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ³ÑƒĞ³Ğ»Ğ¸Ñ‚ Ğ²ÑĞµ ÑĞ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ñ‹ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ Ğ»ĞµÑ‡Ğ¸Ğ»ÑÑ Ğ¿Ğ¾ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ñƒ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ¼Ğ°Ğ¼Ğµ â€” Ğ¾Ğ½Ğ° ÑĞºĞ°Ğ¶ĞµÑ‚ Â«Ğ¼Ğ½Ğµ Ñ‚Ğ¾Ğ¶Ğµ Ñ‚Ğ°Ğº ÑĞºĞ°Ğ·Ğ°Ğ»Ğ¸Â» ğŸ“±',
  ],
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': [
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ±Ğ»Ğ¾Ğ³ĞµÑ€Ñƒ â€” Ğ¿ÑƒÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ·Ñ€ĞµĞµÑ‚ ğŸ“±ğŸ˜‚',
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ ÑĞ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ñ€Ğ¸Ğ»ÑÑ‹ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ ÑƒĞ±Ğ¾Ñ€ĞºĞ¸ ğŸ’€',
    'Ğ¢ĞµĞ³ Ğ´Ñ€ÑƒĞ³Ğ° Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ°Ğ¼Ğ¸ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ñ‡ĞµĞ¼ Ñƒ Ñ‚ĞµĞ±Ñ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑĞ¸Ğ´Ğ¸Ñ‚ Ğ² Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğµ 24/7 â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥ (Ğ²ÑĞµ ÑÑ‚Ğ°Ğ²Ğ¸Ğ¼)',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚-Ğ¼ĞµĞ¹ĞºĞµÑ€Ñƒ Ğ¸ Ğ¶Ğ´Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚ ğŸ“±',
  ],
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': [
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ğ² Ğ´Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚ â€” ĞºÑ‚Ğ¾-Ñ‚Ğ¾ ÑƒĞ·Ğ½Ğ°ĞµÑ‚ ÑĞµĞ±Ñ ğŸŒ±ğŸ˜‚',
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞµ-Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ½Ğ¸Ñ†Ğµ ğŸ’€',
    'Ğ¢ĞµĞ³ ÑĞ¾ÑĞµĞ´Ğ° Ğ¿Ğ¾ Ğ´Ğ°Ñ‡Ğµ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ» ÑƒÑ€Ğ¾Ğ¶Ğ°Ğ¹ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ² ÑĞµĞ¼ĞµĞ¹Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚ Ğ´Ğ°Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ² ğŸ“±',
  ],
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': [
    'Ğ¡ĞºĞ¸Ğ½ÑŒ Ñ‚Ğ¾Ğ¼Ñƒ, ĞºÑ‚Ğ¾ Ğ¿Ñ€ÑĞ¼Ğ¾ ÑĞµĞ¹Ñ‡Ğ°Ñ ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ² Ğ¿Ñ€Ğ¾Ğ±ĞºĞµ ğŸš—ğŸ˜‚',
    'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ğ´Ñ€ÑƒĞ³Ñƒ-Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ â€” Ğ¾Ğ½ Ğ¿Ğ¾Ğ¹Ğ¼Ñ‘Ñ‚ ğŸ’€',
    'Ğ¢ĞµĞ³ Ñ‚Ğ¾Ğ³Ğ¾, ĞºÑ‚Ğ¾ ĞµĞ·Ğ´Ğ¸Ñ‚ Ğ½Ğ° ÑĞ°Ğ¼Ğ¾ĞºĞ°Ñ‚Ğµ ğŸ‘‡',
    'ĞšÑ‚Ğ¾ ÑÑ‚Ğ¾ÑĞ» 2 Ñ‡Ğ°ÑĞ° Ğ² Ğ¿Ñ€Ğ¾Ğ±ĞºĞµ â€” ÑÑ‚Ğ°Ğ²ÑŒ ğŸ”¥',
    'ĞŸĞµÑ€ĞµÑˆĞ»Ğ¸ Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ñ‡Ğ°Ñ‚ â€” Ğ²ÑĞµ Ğ¾Ğ¿Ğ°Ğ·Ğ´Ñ‹Ğ²Ğ°ÑÑ‰Ğ¸Ğµ Ğ¾Ñ†ĞµĞ½ÑÑ‚ ğŸ“±',
  ],
};

// â”€â”€â”€ FIRST COMMENTS â€” Ğ¿Ñ€Ğ¾Ğ²Ğ¾ĞºĞ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ²Ğ¾Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ â”€â”€
const FIRST_COMMENTS = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': [
    'Ğ Ñƒ Ğ²Ğ°Ñ Ğ´Ğ¾Ğ¼Ğ° Ñ‚Ğ°Ğº Ğ¶Ğµ? Ğ˜Ğ»Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñƒ Ğ¼ĞµĞ½Ñ? ğŸ˜‚',
    'ĞšÑ‚Ğ¾ Ğ¿Ñ€Ğ°Ğ² â€” {A} Ğ¸Ğ»Ğ¸ {B}? Ğ–Ğ´Ñƒ Ğ² ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ… ğŸ‘‡',
    '{B} ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾ Ğ¶Ñ‘ÑÑ‚ĞºĞ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ğ»... Ğ½Ğ¾ Ğ²ĞµĞ´ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ°? ğŸ¤”',
    'ĞœĞ¾Ğ¹ ÑĞ¾ÑĞµĞ´ â€” 1 Ğ² 1 ĞºĞ°Ğº {A} ğŸ’€ Ğ£ ĞºĞ¾Ğ³Ğ¾ Ñ‚Ğ°Ğº Ğ¶Ğµ?',
  ],
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': [
    'ĞĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚Ğ¸ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ·Ğ°Ğ¼ĞµĞ½ÑÑ‚ Ğ²ÑĞµÑ… Ğ¸Ğ»Ğ¸ {A} Ğ¿Ñ€Ğ°Ğ²Ğ°? ğŸ¤”',
    'ĞšÑ‚Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¿Ñ€Ğ°Ğ² â€” {A} Ğ¸Ğ»Ğ¸ {B}? ğŸ‘‡',
    'ĞœĞ¾Ñ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞ° Ñ‚Ğ°ĞºĞ¾Ğµ Ğ¶Ğµ ÑĞºĞ°Ğ·Ğ°Ğ»Ğ° ĞºĞ¾Ğ³Ğ´Ğ° ÑƒĞ²Ğ¸Ğ´ĞµĞ»Ğ° ChatGPT ğŸ’€',
    'Ğ Ğ²Ğ°ÑˆĞ¸ Ñ€Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ¸ Ğ·Ğ½Ğ°ÑÑ‚ Ñ‡Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ AI? Ğ Ğ°ÑÑĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ ğŸ‘‡',
  ],
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': [
    'Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñƒ Ğ²Ğ°Ñ Ğ¼Ğ¾Ğ»Ğ¾ĞºĞ¾ ÑÑ‚Ğ¾Ğ¸Ñ‚? Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ¼ ğŸ‘‡ğŸ’€',
    '{A} Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ¸Ğ»Ğ¸ Ğ¼Ñ‹ ÑƒĞ¶Ğµ Ğ¿Ñ€Ğ¸Ğ²Ñ‹ĞºĞ»Ğ¸? ğŸ¤”',
    'ĞŸĞ¾Ğ¼Ğ½Ğ¸Ñ‚Ğµ ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑÑ‚Ğ¾Ğ¸Ğ» Ñ…Ğ»ĞµĞ± 10 Ğ»ĞµÑ‚ Ğ½Ğ°Ğ·Ğ°Ğ´? ğŸ˜­',
    'Ğ£ ĞºĞ¾Ğ³Ğ¾ ĞµÑ‰Ñ‘ ÑˆĞ¾Ğº Ğ¾Ñ‚ Ñ†ĞµĞ½ Ğ² 2026? ğŸ‘‡',
  ],
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': [
    '{B} Ğ¿Ñ€Ğ°Ğ²? Ğ˜Ğ»Ğ¸ ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ°? ğŸ¤”',
    'Ğ”ĞµĞ²Ğ¾Ñ‡ĞºĞ¸, Ğ²Ğ°Ñˆ Ñ‚Ğ°Ğº Ğ¶Ğµ Ğ¿Ğ¸ÑˆĞµÑ‚? ğŸ‘‡ğŸ˜‚',
    'ĞšÑ‚Ğ¾ ÑĞ¾Ğ³Ğ»Ğ°ÑĞµĞ½ Ñ {B} â€” Ğ»Ğ°Ğ¹Ğº, ĞºÑ‚Ğ¾ Ñ {A} â€” ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ ğŸ‘‡',
    'ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ ÑÑ‚Ğ¾ ÑĞ²Ğ¾ĞµĞ¼Ñƒ Ğ¿Ğ°Ñ€Ğ½Ñ â€” Ğ¸ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ ĞµĞ³Ğ¾ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ ğŸ’€',
  ],
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': [
    'Ğ’Ñ‹ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ {A} Ğ¸Ğ»Ğ¸ {B}? ğŸ¤” Ğ§ĞµÑÑ‚Ğ½Ğ¾!',
    'ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞµ Ğ¸ ÑĞ½Ğ¸Ğ¼Ğ¸Ñ‚Ğµ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ ğŸ“±ğŸ‘‡',
    'Ğ—ÑƒĞ¼ĞµÑ€Ñ‹ vs Ğ±ÑƒĞ¼ĞµÑ€Ñ‹ â€” Ğ²ĞµÑ‡Ğ½Ğ°Ñ Ğ±Ğ¸Ñ‚Ğ²Ğ°. ĞšÑ‚Ğ¾ Ğ¿Ñ€Ğ°Ğ²? ğŸ‘‡',
    'ĞœĞ¾Ñ Ğ±Ğ°Ğ±ÑƒÑˆĞºĞ° ÑĞºĞ°Ğ·Ğ°Ğ»Ğ° Ñ‚Ğ¾ Ğ¶Ğµ ÑĞ°Ğ¼Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ Ğ² ÑĞ»Ğ¾Ğ²Ğ¾ ğŸ’€',
  ],
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': [
    'Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ‹ Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚Ğµ Ğ·Ğ° ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºÑƒ? Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ¼ ğŸ‘‡ğŸ’€',
    '{A} Ğ¿Ñ€Ğ°Ğ²Ğ°, Ğ¸ Ğ²Ñ‹ ÑÑ‚Ğ¾ Ğ·Ğ½Ğ°ĞµÑ‚Ğµ ğŸ˜¤',
    'Ğ£ ĞºĞ¾Ğ³Ğ¾ Ğ±Ğ°Ñ‚Ğ°Ñ€ĞµĞ¸ Ñ‚Ğ¾Ğ¶Ğµ Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ½Ñ‹Ğµ? ğŸ‘‡ğŸ¥¶',
    'ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ ÑÑƒĞ¼Ğ¼Ñƒ Ğ²Ğ°ÑˆĞµĞ¹ ĞºĞ²Ğ¸Ñ‚Ğ°Ğ½Ñ†Ğ¸Ğ¸ â€” ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ¼ ĞºÑ‚Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ÑÑ‚Ñ€Ğ°Ğ´Ğ°ĞµÑ‚ ğŸ’€',
  ],
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': [
    'Ğ’Ğ°Ğ¼ Ñ‚Ğ¾Ğ¶Ğµ Ñ‚Ğ°Ğº Ğ²Ñ€Ğ°Ñ‡ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ğ»? ğŸ‘‡ğŸ˜‚',
    '{B} Ğ¶Ñ‘ÑÑ‚ĞºĞ¾, Ğ½Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ° Ğ¶Ğµ? ğŸ’€',
    'Ğ£ ĞºĞ¾Ğ³Ğ¾ Ğ±Ñ‹Ğ»Ğ¸ Ğ¿Ñ€Ğ¸ĞºĞ¾Ğ»Ñ‹ Ğ² Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞµ? Ğ Ğ°ÑÑĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ ğŸ‘‡',
    'Ğ“ÑƒĞ³Ğ»Ğ¸Ñ‚Ğµ ÑĞ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ñ‹ Ğ¸Ğ»Ğ¸ Ğ¸Ğ´Ñ‘Ñ‚Ğµ Ğº Ğ²Ñ€Ğ°Ñ‡Ñƒ? Ğ§ĞµÑÑ‚Ğ½Ğ¾ ğŸ¤”',
  ],
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': [
    'Ğ£ ĞºĞ¾Ğ³Ğ¾ Ñ€ĞµĞ±Ñ‘Ğ½Ğ¾Ğº Ñ‚Ğ¾Ğ¶Ğµ Â«ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚-Ğ¼ĞµĞ¹ĞºĞµÑ€Â»? ğŸ‘‡ğŸ˜‚',
    '{B} Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ° Ğ¸Ğ»Ğ¸ Ğ¶Ñ‘ÑÑ‚ĞºĞ¾? ğŸ¤”',
    'Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ² Ğ´ĞµĞ½ÑŒ ÑĞ¸Ğ´Ğ¸Ñ‚Ğµ Ğ² Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğµ? Ğ§ĞµÑÑ‚Ğ½Ğ¾ ğŸ‘‡',
    'Ğ‘Ğ»Ğ¾Ğ³ĞµÑ€Ñ‹ â€” ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ğ¸Ğ»Ğ¸ Ğ½ĞµÑ‚? ĞŸĞ¾Ğ³Ğ½Ğ°Ğ»Ğ¸ ÑĞ¿Ğ¾Ñ€Ğ¸Ñ‚ÑŒ ğŸ‘‡ğŸ”¥',
  ],
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': [
    'Ğ£ ĞºĞ¾Ğ³Ğ¾ ÑĞ¾ÑĞµĞ´Ğ¸ Ñ‚Ğ¾Ğ¶Ğµ Ñ‚Ğ°ĞºĞ¸Ğµ? ğŸ‘‡ğŸ˜‚',
    'Ğ’Ğ°Ñˆ ÑƒÑ€Ğ¾Ğ¶Ğ°Ğ¹ Ğ² ÑÑ‚Ğ¾Ğ¼ Ğ³Ğ¾Ğ´Ñƒ â€” Ğ¾Ñ†ĞµĞ½Ğ¸Ñ‚Ğµ Ğ¾Ñ‚ 1 Ğ´Ğ¾ 10 ğŸ…',
    '{A} Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ñ‚Ğ°Ğº Ğ¿ĞµÑ€ĞµĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ·Ğ° Ğ¿Ğ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€Ñ‹? Ğ Ğ²Ñ‹? ğŸ‘‡',
    'Ğ”Ğ°Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ¿Ğ¾Ğ¹Ğ¼ÑƒÑ‚. ĞšÑ‚Ğ¾ Ğ½Ğµ Ğ´Ğ°Ñ‡Ğ½Ğ¸Ğº â€” Ğ½Ğµ Ğ¿Ğ¾Ğ¹Ğ¼Ñ‘Ñ‚ ğŸ¤·â€â™‚ï¸',
  ],
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': [
    'Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ‹ ÑÑ‚Ğ¾Ğ¸Ñ‚Ğµ Ğ² Ğ¿Ñ€Ğ¾Ğ±ĞºĞ°Ñ… Ğ² Ğ´ĞµĞ½ÑŒ? ğŸ‘‡â°',
    '{B} Ğ¿Ñ€Ğ°Ğ² â€” ÑĞ°Ğ¼Ğ¾ĞºĞ°Ñ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ? ğŸ¤”',
    'Ğ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ¸ vs Ğ¿ĞµÑˆĞµÑ…Ğ¾Ğ´Ñ‹ â€” ĞºÑ‚Ğ¾ ÑÑ‚Ñ€Ğ°Ğ´Ğ°ĞµÑ‚ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ? ğŸ‘‡',
    'ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ ÑĞ²Ğ¾Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸ Ğ² Ñ‡Ğ°ÑĞ°Ñ… ğŸ’€',
  ],
};

// â”€â”€â”€ DEMO DIALOGUES (TIMING-SAFE) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Rules: A = 5-7 words, 0-1 pause | B = 5-8 words, 0-1 pause
// At slow(2.0 WPS): 7w = 3.5s â†’ over A(2.8s), so slow chars need â‰¤5w
// At normal(2.5 WPS): 7w/2.5 = 2.8s âœ“ | 8w/2.5 = 3.2s âœ“ for B
// At fast(3.0 WPS): 7w/3.0 = 2.33s âœ“ | 8w/3.0 = 2.67s âœ“
// Max 1 pause(+0.3s) per line. Total speech must fit 6.3s (A+B windows)
const DEMO_DIALOGUES = {
  'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´': {
    A_lines: ['Ğ¥Ğ»ĞµĞ± Ñ‚ĞµĞ¿ĞµÑ€ÑŒ ĞšĞ’ĞĞ”Ğ ĞĞ¢ĞĞ«Ğ™! ĞšĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğ¹!', 'ĞŸÑƒĞ»ÑŒÑ‚ Ğ¾Ğ¿ÑÑ‚ÑŒ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ»Ğ°! Ğ¢Ñ€ĞµÑ‚Ğ¸Ğ¹ Ñ€Ğ°Ğ·!'],
    B_lines: ['Ğ—ĞµĞ¼Ğ»Ñ Ñ‚Ğ¾Ğ¶Ğµ Ğ½Ğµ ĞºÑ€ÑƒĞ³Ğ»Ğ°Ñ | Ğ¶Ğ¸Ğ²Ñ‘ÑˆÑŒ.', 'Ğ¥Ğ²Ğ°Ñ‚Ğ¸Ñ‚ ĞºĞ»Ğ°ÑÑ‚ÑŒ ĞµĞ³Ğ¾ Ğ² Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ¸Ğ»ÑŒĞ½Ğ¸Ğº.'],
    killer_word: 'Ğ¶Ğ¸Ğ²Ñ‘ÑˆÑŒ'
  },
  'AI Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸': {
    A_lines: ['Ğ¢Ğ²Ğ¾Ğ¹ Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ Ğ¼Ğ½Ğµ Ğ±Ğ¾Ñ€Ñ‰ ÑĞ²Ğ°Ñ€Ğ¸Ñ‚?!', 'ĞĞ½Ğ° Ñ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ¾Ğ¼ ĞºĞ°Ğº Ñ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ¾Ğ¼!'],
    B_lines: ['ĞĞ½ ÑƒĞ¶Ğµ Ğ²Ğ½ÑƒĞºĞ¾Ğ² Ğ²Ğ¾ÑĞ¿Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ | Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¸Ğ»Ğ°?', 'Ğ Ñ‚Ñ‹ Ñ Ñ‚ĞµĞ»ĞµĞ²Ğ¸Ğ·Ğ¾Ñ€Ğ¾Ğ¼ Ñ‚Ñ€Ğ¸Ğ´Ñ†Ğ°Ñ‚ÑŒ Ğ»ĞµÑ‚.'],
    killer_word: 'Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¸Ğ»Ğ°'
  },
  'Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ¸Ğ½Ñ„Ğ»ÑÑ†Ğ¸Ñ': {
    A_lines: ['ĞœĞ¾Ğ»Ğ¾ĞºĞ¾! Ğ’Ğ¾ÑĞµĞ¼ÑŒÑĞ¾Ñ‚ Ñ€ÑƒĞ±Ğ»ĞµĞ¹! ĞœĞĞ›ĞĞšĞ!', 'Ğ¯Ğ¹Ñ†Ğ° Ğ¿Ğ¾ Ñ‚Ñ€Ğ¸ÑÑ‚Ğ°! Ğ”ĞµÑÑÑ‚Ğ¾Ğº! Ğ¯Ğ™Ğ¦Ğ!'],
    B_lines: ['Ğ’ Ğ´ĞµĞ²ÑĞ½Ğ¾ÑÑ‚Ğ¾ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ¼ Ñ Ğ¼Ğ°ÑˆĞ¸Ğ½Ñƒ ĞºÑƒĞ¿Ğ¸Ğ».', 'ĞšÑƒÑ€Ğ¸Ñ†Ğ° Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ¶Ğ¸Ğ²Ñ‘Ñ‚ Ğ»ÑƒÑ‡ÑˆĞµ Ğ¿ĞµĞ½ÑĞ¸Ğ¾Ğ½ĞµÑ€Ğ°.'],
    killer_word: 'Ğ¼Ğ°ÑˆĞ¸Ğ½Ñƒ'
  },
  'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ': {
    A_lines: ['ĞĞ½ Ğ¿Ğ¸ÑˆĞµÑ‚ Â«Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ ĞºĞ°Ğº Ğ´ĞµĞ»Ğ°Â» | ÑƒÑ…Ğ°Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ?!', 'ĞœÑƒĞ¶ Ğ¿ÑÑ‚ÑŒ Ğ»ĞµÑ‚ Â«Ñ‚Ñ‹ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°ÑÂ»!'],
    B_lines: ['Ğ Ğ°Ğ½ÑŒÑˆĞµ Ğ¼ÑƒĞ¶Ğ¸Ğº Ğ·Ğ°Ğ±Ğ¾Ñ€ Ñ‡Ğ¸Ğ½Ğ¸Ğ» | Ğ»ÑĞ±Ğ¾Ğ²ÑŒ.', 'Ğ—Ğ½Ğ°Ñ‡Ğ¸Ñ‚ Ğ´Ğ°Ğ²Ğ½Ğ¾ ÑĞ´Ğ°Ğ»ÑÑ Ğ¸ ÑĞ¿Ğ¸Ñ‚ ÑĞ¿Ğ¾ĞºĞ¾Ğ¹Ğ½Ğ¾.'],
    killer_word: 'Ğ»ÑĞ±Ğ¾Ğ²ÑŒ'
  },
  'Ğ Ğ°Ğ·Ñ€Ñ‹Ğ² Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹': {
    A_lines: ['Ğ’Ğ½ÑƒÑ‡ĞºĞ° Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Â«ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚-Ğ¼ĞµĞ¹ĞºĞµÑ€Â» | Ñ‡Ñ‘?!', 'Ğ’Ğ½ÑƒĞº Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ Â«Ğ¾Ğº Ğ±ÑƒĞ¼ĞµÑ€Â» | Ğ±ÑƒĞ¼ĞµÑ€?!'],
    B_lines: ['Ğ—Ğ½Ğ°Ñ‡Ğ¸Ñ‚ Ñ‚Ğ¾Ğ¶Ğµ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ´ĞµĞ»Ğ°ĞµÑ‚ | Ñ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ¾Ğ¼.', 'Ğ‘ÑƒĞ¼ĞµÑ€ Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾Ğ¸Ğ» Ğ´Ğ¾Ğ¼ | Ğ³Ğ´Ğµ Ñ‚Ğ²Ğ¾Ğ¹ Ğ²Ğ°Ğ¹Ñ„Ğ°Ğ¹.'],
    killer_word: 'Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ¾Ğ¼'
  },
  'Ğ–ĞšĞ¥ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°': {
    A_lines: ['ĞÑ‚Ğ¾Ğ¿Ğ»ĞµĞ½Ğ¸Ğµ ÑˆĞµÑÑ‚ÑŒ Ñ‚Ñ‹Ñ‰ | Ğ±Ğ°Ñ‚Ğ°Ñ€ĞµÑ Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ½Ğ°Ñ!', 'Ğ›Ğ¸Ñ„Ñ‚ Ğ¾Ğ¿ÑÑ‚ÑŒ ÑĞ´Ğ¾Ñ…! Ğ¨ĞµÑÑ‚Ğ¾Ğ¹ ÑÑ‚Ğ°Ğ¶ Ğ¿ĞµÑˆĞºĞ¾Ğ¼!'],
    B_lines: ['Ğ—Ğ°Ñ‚Ğ¾ Ğ´ÑƒÑˆÑƒ Ñ‚ĞµĞ±Ğµ Ğ´Ğ°Ğ²Ğ½Ğ¾ Ğ½Ğ°Ñ‚Ğ¾Ğ¿Ğ¸Ğ»Ğ¸.', 'Ğ—Ğ°Ñ‚Ğ¾ Ğ½Ğ¾Ğ³Ğ¸ ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğµ | Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ñ„Ğ¸Ñ‚Ğ½ĞµÑ.'],
    killer_word: 'Ğ½Ğ°Ñ‚Ğ¾Ğ¿Ğ¸Ğ»Ğ¸'
  },
  'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸ĞºĞ»Ğ¸Ğ½Ğ¸ĞºĞ°': {
    A_lines: ['Ğ’Ñ€Ğ°Ñ‡ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ Ğ“Ğ£Ğ“Ğ›Ğ˜Ğ¢Ğ•! Ğ¡ĞµÑ€ÑŒÑ‘Ğ·Ğ½Ğ¾?!', 'Ğš Ğ²Ñ€Ğ°Ñ‡Ñƒ Ñ‡ĞµÑ€ĞµĞ· Ñ‚Ñ€Ğ¸ Ğ½ĞµĞ´ĞµĞ»Ğ¸ | Ğ²Ñ‹Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ĞµÑ!'],
    B_lines: ['Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾ Ğ½Ğµ ÑĞºĞ°Ğ·Ğ°Ğ» ÑĞ¿Ñ€Ğ¾ÑĞ¸ Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚ÑŒ | Ğ¿Ğ¾Ñ…Ğ¾Ñ€Ğ¾Ğ½Ğ¸Ñ‚.', 'Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ | ÑĞºĞ¾Ğ½Ğ¾Ğ¼ÑÑ‚ Ğ½Ğ° Ğ»ĞµĞºĞ°Ñ€ÑÑ‚Ğ²Ğ°Ñ….'],
    killer_word: 'Ğ¿Ğ¾Ñ…Ğ¾Ñ€Ğ¾Ğ½Ğ¸Ñ‚'
  },
  'Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹': {
    A_lines: ['ĞœĞ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ² | Ğ° Ğ¿Ğ¾ÑÑƒĞ´Ñƒ Ğ½Ğµ Ğ¼Ğ¾ĞµÑ‚!', 'ĞĞ½Ğ° ĞµĞ´Ñƒ Ñ‡Ğ°Ñ Ñ„Ğ¾Ñ‚ĞºĞ°ĞµÑ‚! Ğ¡ÑƒĞ¿ Ğ¾ÑÑ‚Ñ‹Ğ»!'],
    B_lines: ['ĞœĞ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½ ÑĞ¼Ğ¾Ñ‚Ñ€ÑÑ‚ ĞºĞ°Ğº Ğ½Ğµ Ğ¼Ğ¾ĞµÑ‚ | Ğ»Ğ°Ğ¹ĞºĞ°ÑÑ‚.', 'Ğ—Ğ°Ñ‚Ğ¾ Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½ Ğ·Ğ½Ğ°ÑÑ‚ Ñ‡Ñ‚Ğ¾ Ñ‚Ñ‹ Ğ²Ğ°Ñ€Ğ¸ÑˆÑŒ.'],
    killer_word: 'Ğ»Ğ°Ğ¹ĞºĞ°ÑÑ‚'
  },
  'Ğ”Ğ°Ñ‡Ğ° Ğ¸ Ğ¾Ğ³Ğ¾Ñ€Ğ¾Ğ´': {
    A_lines: ['ĞŸĞ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€Ñ‹ ÑĞ¾Ğ¶Ñ€Ğ°Ğ»Ğ¸! Ğ’ÑĞµ Ğ´Ğ¾ ĞµĞ´Ğ¸Ğ½Ğ¾Ğ³Ğ¾!', 'Ğ¡Ğ¾ÑĞµĞ´ Ğ·Ğ°Ğ±Ğ¾Ñ€ Ğ½Ğ° Ğ´Ğ²Ğ°Ğ´Ñ†Ğ°Ñ‚ÑŒ ÑĞ°Ğ½Ñ‚Ğ¸Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²!'],
    B_lines: ['ĞœĞ¸Ñ…Ğ°Ğ»Ñ‹Ñ‡ Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ²ĞµĞ³Ğ°Ğ½ | ĞµĞ¼Ñƒ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¾.', 'Ğ­Ñ‚Ğ¾ ĞµĞ³Ğ¾ ÑĞ¾Ğ²ĞµÑÑ‚ÑŒ Ñ€Ğ°ÑÑ‚Ñ‘Ñ‚ Ğ² Ğ½Ğ°ÑˆÑƒ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñƒ.'],
    killer_word: 'Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¾'
  },
  'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸': {
    A_lines: ['Ğ”Ğ²Ğ° Ñ‡Ğ°ÑĞ° ÑÑ‚Ğ¾ÑĞ»Ğ°! Ğ¡Ğ°Ğ¼Ğ¾ĞºĞ°Ñ‚ Ğ¾Ğ±Ğ¾Ğ³Ğ½Ğ°Ğ»!', 'Ğ”Ğ²ĞµÑÑ‚Ğ¸ Ñ€ÑƒĞ±Ğ»ĞµĞ¹ Ğ·Ğ° Ğ¿ÑÑ‚ÑŒÑĞ¾Ñ‚ Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²!'],
    B_lines: ['Ğ¡Ğ°Ğ¼Ğ¾ĞºĞ°Ñ‚ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ³Ğ¾ | Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ³Ğ¾.', 'Ğ—Ğ°Ñ‚Ğ¾ Ğ´Ğ¾Ğ²Ñ‘Ğ· | Ğ·Ğ° Ğ¿ÑÑ‚ÑŒÑĞ¾Ñ‚ Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ² Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğº Ğ½ĞµÑ‚.'],
    killer_word: 'Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ³Ğ¾'
  },
};

// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function seededRandom(seed) {
  let h = 0;
  for (let i = 0; i < seed.length; i++) { h = ((h << 5) - h + seed.charCodeAt(i)) | 0; }
  return () => { h = (h * 16807 + 0) % 2147483647; return (h & 0x7fffffff) / 2147483647; };
}

function pickRandom(arr, rng) { return arr[Math.floor(rng() * arr.length)]; }
function pickN(arr, n, rng) {
  const copy = [...arr];
  const result = [];
  for (let i = 0; i < Math.min(n, copy.length); i++) {
    const idx = Math.floor(rng() * copy.length);
    result.push(copy.splice(idx, 1)[0]);
  }
  return result;
}

// â”€â”€â”€ ENGAGEMENT BUILDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildEngagement(catRu, charA, charB, rng) {
  const nameA = charA.name_ru;
  const nameB = charB.name_ru;
  const fill = (s) => s.replace(/\{A\}/g, nameA).replace(/\{B\}/g, nameB);

  // â”€â”€ Hashtags: 3-layer mix â”€â”€
  const catTags = HASHTAGS_BY_CATEGORY[catRu] || HASHTAGS_BY_CATEGORY['Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´'];
  const niche = pickN(catTags.niche, 5, rng);
  const mid = pickN(catTags.mid, 4, rng);
  const big = pickN(catTags.big, 2, rng);
  const evergreen = pickN(EVERGREEN_TAGS, 3, rng);

  // ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ½Ñ‹Ğµ Ñ‚ĞµĞ³Ğ¸
  const grpA = GROUP_HASHTAGS[charA.group] || [];
  const grpB = GROUP_HASHTAGS[charB.group] || [];
  const charTags = pickN([...new Set([...grpA, ...grpB])], 3, rng);

  // Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚ĞµĞ³ ÑĞµÑ€Ğ¸Ğ¸
  const seriesTag = '#' + nameA.replace(/\s+/g, '').toLowerCase() + 'vs' + nameB.replace(/\s+/g, '').toLowerCase();

  // Ğ¡Ğ±Ğ¾Ñ€ĞºĞ°: niche(5) + mid(4) + charTags(3) + big(2) + evergreen(3) + series(1) = ~18 Ñ‚ĞµĞ³Ğ¾Ğ² (Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ IG)
  const allTags = [...niche, ...mid, ...charTags, ...big, ...evergreen, seriesTag];
  // Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
  const hashtags = [...new Set(allTags)].slice(0, 25);

  // â”€â”€ Viral title â”€â”€
  const titlePool = VIRAL_TITLES[catRu] || VIRAL_TITLES['Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´'];
  const viralTitle = fill(pickRandom(titlePool, rng));

  // â”€â”€ Pin comment â”€â”€
  const pinPool = PIN_COMMENTS[catRu] || PIN_COMMENTS['Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´'];
  const pinComment = fill(pickRandom(pinPool, rng));

  // â”€â”€ First comment (Ğ´Ğ»Ñ Ğ²Ğ¾Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ) â”€â”€
  const fcPool = FIRST_COMMENTS[catRu] || FIRST_COMMENTS['Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ°Ğ±ÑÑƒÑ€Ğ´'];
  const firstComment = fill(pickRandom(fcPool, rng));

  return { hashtags, viralTitle, pinComment, firstComment, seriesTag };
}

// â”€â”€â”€ UNIVERSAL ROLE ADAPTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Maps any character pair to A/B roles based on their data.
// A = more expressive/provocative; B = more grounded/rational.
// User manual assignment (role_default) takes priority.
function resolveRoles(charA, charB) {
  // If user explicitly assigned roles, respect that
  if (charA.role_default === 'A' && charB.role_default === 'B') return { A: charA, B: charB };
  if (charA.role_default === 'B' && charB.role_default === 'A') return { A: charB, B: charA };

  // Auto-assign: compute expressiveness score
  // Higher score â†’ role A (provocateur)
  const score = (c) => {
    let s = 0;
    if (c.speech_pace === 'fast') s += 3;
    else if (c.speech_pace === 'normal') s += 1;
    s += c.swear_level || 0;
    if (c.compatibility === 'chaotic') s += 2;
    else if (c.compatibility === 'conflict') s += 1;
    else if (c.compatibility === 'calm') s -= 2;
    if (c.role_default === 'A') s += 1;
    if (c.role_default === 'B') s -= 1;
    return s;
  };

  const scoreA = score(charA);
  const scoreB = score(charB);
  // Higher score gets role A
  if (scoreB > scoreA) return { A: charB, B: charA };
  return { A: charA, B: charB };
}

// â”€â”€â”€ CAST CONTRACT BUILDER (universal) â”€â”€â”€â”€â”€â”€â”€
function buildCastContract(charA, charB) {
  const buildBiology = (char, role) => {
    const bio = char.biology_override || {};
    const anchors = char.identity_anchors || {};
    const defaultSkin = ['deep wrinkles', 'age spots', 'visible pores', 'subtle skin sheen (not plastic)'];
    const defaultEyes = ['wet glint', 'slight sclera redness', 'micro-saccades'];
    return {
      character_en: char.prompt_tokens?.character_en || 'elderly character, hyper-realistic detail',
      age: bio.age || 'elderly',
      skin: (bio.skin_tokens || defaultSkin).join(', '),
      eyes: (bio.eye_tokens || defaultEyes).join(', '),
      mouth: role === 'A'
        ? 'realistic teeth/gums, lip moisture, lip-bite as comedic pafos-anchor (sparingly), micro saliva glints'
        : 'realistic teeth/gums, lip moisture, mouth SEALED when not speaking, jaw still',
      face_silhouette: anchors.face_silhouette || 'distinctive facial features',
      signature_element: anchors.signature_element || 'notable accessory',
      micro_gesture: anchors.micro_gesture || 'subtle expression change',
      wardrobe_anchor: anchors.wardrobe_anchor || 'distinctive clothing piece',
      vibe: char.vibe_archetype || (role === 'A' ? 'Ğ¿Ñ€Ğ¾Ğ²Ğ¾ĞºĞ°Ñ‚Ğ¾Ñ€' : 'Ğ±Ğ°Ğ·Ğ°'),
    };
  };
  return {
    speaker_A: buildBiology(charA, 'A'),
    speaker_B: buildBiology(charB, 'B'),
    relationship: 'BAND â€” insults target SITUATION only, never each other',
  };
}

// â”€â”€â”€ CAMERA & REALISM PRESET (v2) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildCameraPreset() {
  return {
    pov: 'held at arm\'s length, front-facing portrait look, device INVISIBLE',
    distance: 'close enough to read skin microtexture, both faces in frame',
    artifacts: [
      'handheld micro-jitter',
      'subtle exposure breathing',
      'mild rolling shutter only on quick micro-moves',
      'brief autofocus hunt â‰¤0.15s on lens approach',
    ],
    realism_anchors: [
      'slight sensor noise',
      'mild compression artifacts',
      'imperfect white balance drift',
      'micro motion blur on sharp gesture (finger/slap)',
      'realistic shadowing under nose/cheekbones',
    ],
  };
}

// â”€â”€â”€ CINEMATOGRAPHY CONTRACT (12 production pillars) â”€â”€â”€
// Everything the user does NOT choose â€” Gemini decides using this contract.
// These 12 blocks make video look "alive and expensive".
function buildCinematography(lightingMood, location, wardrobeA, wardrobeB, charA, charB, hookObj, releaseObj, propAnchor) {
  return {
    // â”€â”€ 1. LIGHTING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    lighting: {
      directive: 'Lighting is the single biggest realism factor. Choose ONE clear setup and commit.',
      primary_source: lightingMood.style,
      mood: lightingMood.mood,
      source_count: 'One dominant source + one soft fill bounce from environment (wall/ceiling/floor). Never more than two. NEVER ring light or studio softbox.',
      shadow_quality: 'Soft but PRESENT shadows under nose, cheekbones, chin, brow ridge. Shadow edges slightly diffused, not razor-sharp, not invisible. Shadows give face its 3D structure.',
      skin_highlights: 'Subtle overexposure allowed on skin highlights (forehead, nose bridge, cheekbone top). This is NATURAL and desired â€” do NOT flatten it. Slight specular sheen on oily skin zones.',
      consistency: 'Lighting MUST NOT change during 8 seconds. Same direction, same color temperature, same intensity throughout. No flickering unless location-appropriate (fluorescent).',
      forbidden: 'No flat frontal lighting, no beauty dish glow, no studio rim lights, no colored RGB gels, no dramatic film noir unless location demands it.',
    },

    // â”€â”€ 2. OPTICS & DISTANCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    optics: {
      directive: 'Portrait-close framing with shallow DOF = expensive look. This is non-negotiable for the series.',
      focal_length: '35-50mm equivalent (portrait range). NOT ultra-wide (no face distortion). NOT telephoto (no flat compression). Sweet spot: 40mm.',
      aperture: 'f/1.8â€“f/2.8 equivalent. Faces SHARP, background 20-35% blurred (natural bokeh, not gaussian). Ears may be slightly softer than eyes â€” this is correct.',
      distance_to_subject: '40-70cm from lens to face. Close enough to see pore texture, far enough for both faces in frame without barrel distortion.',
      depth_of_field: 'Eyes of speaking character = critical sharpness plane. Listening character 5-10cm behind = acceptable soft. Background = gentle bokeh with recognizable shapes (not smeared).',
      series_lock: 'EVERY episode in this series uses the same focal length and distance range. This is the visual signature of the format.',
    },

    // â”€â”€ 3. CAMERA MOVEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    camera_movement: {
      directive: 'Handheld selfie feel â€” NOT tripod static, NOT gimbal smooth. Organic human holding a phone.',
      base_motion: 'Constant micro-jitter: 0.5-1.5px random drift at 2-4Hz. This is breathing + hand tremor. NEVER perfectly still.',
      hook_motion: 'First 0.8s: slight push-in toward speaker (2-3% zoom), adds urgency.',
      act_A_motion: 'Subtle drift toward A (0.5-1Â° rotation over 2.8s). Almost imperceptible, creates subconscious focus.',
      act_B_motion: 'Micro-pan toward B as they start speaking. Slight pull-back (1-2% zoom out) for "reveal" energy.',
      release_motion: 'Camera shakes from laughter â€” 3-5px oscillation at 6-8Hz for 0.5s, then settles. Bodies physically moving cause this.',
      forbidden: 'No smooth dolly moves, no crane shots, no whip pans, no rack focus pulls, no drone moves. This is a PHONE in a HAND.',
      series_lock: 'Same movement style every episode. Consistency = brand recognition.',
    },

    // â”€â”€ 4. MICRO-MOVEMENT TEMPO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    micro_movements: {
      directive: 'The difference between "alive" and "mannequin". Too few = uncanny valley. Too many = cartoon. Find the sweet spot.',
      blink_rate: 'Natural blink: every 3-5 seconds. Stress/argument increases to every 2-3s. NEVER unblinking for >5s. Both eyes blink simultaneously (no winking unless character-specific).',
      breathing: 'Visible chest/shoulder rise every 3-4 seconds. Speaking character: breathing syncs with speech pauses. Listening character: slow steady breathing, maybe one deep inhale before their line.',
      head_micro_turns: 'Tiny 1-3Â° head tilts and rotations every 2-4 seconds. Speaking: animated, 5-10Â° range. Listening: minimal, weighted nods or slight cocks.',
      facial_micro_expressions: 'Eyebrow micro-raises (1-2mm), nostril micro-flares on emphasis, jaw tension shifts, lip corner twitches on listening character. These fire every 1-2 seconds subtly.',
      weight_shifts: 'Body weight shifts every 4-6 seconds. Small shoulder adjustments. Finger movements if gesturing. Clothing shifts with body.',
      forbidden: 'No perfectly still mannequin frames (>1.5s without ANY movement). No hyperactive twitching. No symmetrical simultaneous movements on both characters.',
    },

    // â”€â”€ 5. FACE & LIP STABILITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    face_stability: {
      directive: 'Mouth ALWAYS visible and unobstructed. This directly controls lip-sync quality.',
      mouth_visibility: 'CRITICAL: Lower face (mouth, chin, jaw) must be in frame and unobstructed for 100% of the video. No hand over mouth (except intentional gesture), no hair covering lips, no prop blocking jaw.',
      head_rotation_limit: 'Maximum 25Â° turn from camera. Beyond this, far-side mouth becomes invisible â†’ lip-sync breaks. During speech: keep within 15Â° of front-facing.',
      hair_and_accessories: 'No bangs/fringe/mustache/scarf covering lips AT ANY POINT during speech. If character has facial hair: keep it trimmed/clear of lip line in prompt. Glasses: above mouth line only.',
      jaw_tracking: 'Every Russian syllable produces visible jaw movement. Consonants (Ñ‚, Ğ´, Ğ¿, Ğ±, Ğ¼, Ğ½) = visible lip closure. Vowels (Ğ°, Ğ¾, Ñƒ) = proportional jaw opening. No "ventriloquist" speech.',
      non_speaking_mouth: 'When NOT speaking: mouth FIRMLY SEALED. Jaw still. Lips pressed. NO phantom lip movements, no mouthing along, no chewing. ONLY subtle lip-press changes allowed.',
    },

    // â”€â”€ 6. EYES & GAZE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    gaze: {
      directive: 'Eyes create hypnosis and retention. First 1-2 seconds of eye contact with camera = highest hook power.',
      hook_gaze: '0.0-0.8s: Speaking character (A) locks DIRECT EYE CONTACT with camera lens. Piercing, challenging, pulling viewer in. This is the #1 retention weapon.',
      act_A_gaze: '0.8-3.6s: A maintains 70% camera contact, 30% glancing at B. B watches A with side-eye or direct stare â€” tracking A\'s words with visible processing.',
      act_B_gaze: '3.6-7.1s: B delivers punchline with direct camera contact (80%). A\'s eyes go wide â†’ dart between B and camera, showing shock.',
      release_gaze: '7.1-8.0s: Both break into natural laughter gaze â€” eyes crinkle, look at each other, occasional camera glance. Warm, genuine.',
      pupil_detail: 'Pupils visible with micro-reflections of environment lighting. Wet glint on sclera. Micro-saccades (tiny rapid eye movements) every 0.5-1s â€” this is what makes eyes feel ALIVE.',
      forbidden: 'No dead stare (eyes open, no movement for >2s). No cross-eyed moments. No looking at nothing. No simultaneous identical eye movements on both characters.',
    },

    // â”€â”€ 7. FRAME CLEANLINESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    frame_cleanliness: {
      directive: 'Clean background with 2-4 purposeful details. No visual noise, no random objects, no clutter that distracts from faces.',
      foreground: 'Characters occupy 60-70% of vertical frame. Nothing between camera and faces.',
      midground: `1 prop anchor: ${propAnchor} â€” slightly out of focus, provides texture and context.`,
      background: '2-3 environmental details appropriate to location, all in soft bokeh. Recognizable shapes but not sharp enough to read text or count objects.',
      negative_space: 'Slight headroom above characters (5-8% of frame). No dead empty zones larger than 15% of frame.',
      forbidden: 'No text anywhere in frame. No logos. No screens/phones visible. No random floating objects. No visual elements that compete with faces for attention.',
      detail_budget: 'Total distinct visual elements in frame: faces (2) + wardrobe (2) + prop (1) + background details (2-3) = 7-8 maximum. Anything more is clutter.',
    },

    // â”€â”€ 8. WARDROBE & TEXTURES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    textures: {
      directive: 'Textured materials = realism. Smooth/flat surfaces = AI giveaway. Every fabric must have visible weave, wrinkles, or grain.',
      wardrobe_A: wardrobeA,
      wardrobe_B: wardrobeB,
      texture_priority: 'PRIORITIZE materials with visible texture: wool knit patterns, denim weave, leather grain, cotton wrinkles, corduroy ridges, linen creases. These read as REAL.',
      wrinkle_rule: 'Clothing MUST have natural wrinkles at elbows, shoulders, waist. Freshly-ironed flat fabric = fake. Lived-in creases = real.',
      skin_as_texture: 'Skin is the most important texture. Visible pores, fine lines, age spots (if elderly), slight oiliness on nose/forehead, imperfect tone. NO airbrushed smooth skin.',
      forbidden: 'No plastic-looking fabrics. No perfectly smooth surfaces. No CGI-shiny materials. No rubber-looking skin. No uniform untextured color blocks.',
    },

    // â”€â”€ 9. COLOR & SKIN TONE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    color_skin: {
      directive: 'Correct color grading is what separates AI video from real. Lock white balance, protect skin tones, avoid the two deadly sins: orange tan and grey face.',
      white_balance: 'Lock to ONE color temperature matching the light source. Kitchen/barn: 3200-3800K warm. Fluorescent: 4500-5000K cool. Daylight: 5500-6000K neutral. NO shifts during the clip.',
      skin_tone_A: `${charA.prompt_tokens?.character_en?.includes('dark skin') || charA.prompt_tokens?.character_en?.includes('tan') ? 'Warm rich undertone, never ashy' : charA.prompt_tokens?.character_en?.includes('pale') ? 'Cool pink undertone, never grey or yellow' : 'Natural warm undertone, slight pink in cheeks, never flat or monochrome'}`,
      skin_tone_B: `${charB.prompt_tokens?.character_en?.includes('dark skin') || charB.prompt_tokens?.character_en?.includes('tan') ? 'Warm rich undertone, never ashy' : charB.prompt_tokens?.character_en?.includes('pale') ? 'Cool pink undertone, never grey or yellow' : 'Natural warm undertone, slight pink in cheeks, never flat or monochrome'}`,
      deadly_sins: 'FORBIDDEN: (1) Orange spray-tan skin â€” most common AI artifact. (2) Grey/blue lifeless face â€” second most common. (3) Uniform skin tone with no variation â€” third.',
      color_grade: 'Subtle cinematic grade only. Slight lift in shadows (not crushed black), gentle rolloff in highlights (not clipped white). Saturation: 90-100% of natural (slightly muted = cinematic, never oversaturated).',
      consistency: 'Skin tone MUST remain identical across all 8 seconds. No color shifts, no random warmth/coolness changes between cuts or movements.',
    },

    // â”€â”€ 10. SOUND AS REALITY ANCHOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    sound_anchor: {
      directive: 'Sound makes the brain believe the image is real. Even simple room tone converts "AI video" into "footage". Sound is the cheapest realism upgrade.',
      room_tone: 'MANDATORY: continuous low-level ambient sound matching location. This runs UNDER all dialogue at -20dB to -30dB. Never silence between words â€” real rooms have sound.',
      voice_volume: 'Dialogue at -6dB to -3dB peak. Natural dynamic range â€” louder on emphasis, softer on asides. NO compression, NO limiter, NO uniform volume. Real speech has volume variation.',
      voice_room_match: 'Voice must have reverb/reflection matching the space. Kitchen: slight hard-surface reflection. Outdoors: minimal reverb. Stairwell: concrete echo. Tiny room: close/dry.',
      breathing_sounds: 'Audible inhale before each speaking turn (0.1-0.2s). Nose exhale from listening character during pauses. This is what makes speech feel embodied.',
      cloth_and_foley: 'Fabric rustle on every major body movement. Surface contact sounds (chair creak, table touch). Prop interaction sounds if hook involves object.',
      laugh_audio: 'Release laughter: 20-30% louder than dialogue peak. Raspy, breathy, contagious. Camera mic slightly distorts from proximity (realistic). Bodies audibly shaking.',
      forbidden: 'No dead silence ever (even 0.3s of pure silence feels wrong). No echo-free "studio" voice in a kitchen. No uniform volume speech. No music unless explicitly requested.',
    },

    // â”€â”€ 11. FIRST-FRAME VISUAL HOOK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    visual_hook: {
      directive: 'The hook is VISUAL, not verbal. In the first 0.5-0.8 seconds, the viewer must be grabbed by what they SEE before anyone speaks.',
      primary_hook: `${hookObj.action_en} â€” this is the visual grab. It must be IN PROGRESS when video starts (no setup, no walking into frame).`,
      face_emotion: 'Character A\'s face shows EXTREME emotion from frame 1: fury, disbelief, righteous indignation, theatrical shock. This is the #1 scroll-stopper.',
      object_hook: `${propAnchor} or character signature element visible from frame 1 â€” gives context instantly.`,
      composition_hook: 'Both faces visible from frame 1. No fade-in, no black frame, no title card. INSTANT scene.',
      gaze_hook: 'Direct eye contact with camera from frame 1. This activates primal "someone is looking at me" response â€” strongest hook.',
      forbidden: 'No text overlays as hook. No "wait for it" buildup. No slow fade-in. No empty frame first. No back-of-head shots. FACE + EMOTION + EYES from frame 0.',
    },

    // â”€â”€ 12. EDIT LOGIC (single-take feel) â”€â”€â”€â”€â”€â”€â”€â”€
    edit_logic: {
      directive: 'Even without cuts, the internal rhythm must follow edit logic. The viewer should feel beginning-middle-end in 8 seconds.',
      start: 'COLD OPEN: Video starts MID-SCENE. Characters are already in position, emotion already building. No "hello", no setup, no walking in. Viewer drops into an argument already happening.',
      pre_punch_pause: 'At 3.4-3.6s (transition from A to B): 0.15-0.25s of SILENCE. A finishes, brief beat of tension, then B drops the hammer. This pause is the "inhale before the punchline" â€” it makes the audience lean in.',
      killer_delivery: 'B\'s killer word at ~7.0s mark. Slight camera micro-push toward B. A\'s physical reaction (freeze, eye-widen, jaw-drop) is what sells it.',
      end_on_reaction: 'Final 0.5-0.8s: end on the REACTION, not the punchline. Shared laughter, A\'s defeated smile, mutual shoulder shake. This is what makes people REWATCH â€” they want to see that reaction again.',
      rewatch_bait: 'The reaction in the last 0.5s should be slightly ambiguous or extra-funny â€” a micro-expression, a gesture, an eye-roll â€” that rewards rewatching. Rewatch = algorithm boost.',
      forbidden: 'No clean ending (fade out, wave goodbye, "thanks for watching"). No setup before the action. No dead air at start or end. Every frame earns its place.',
    },
  };
}

// â”€â”€â”€ REMAKE INSTRUCTION BUILDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// When user provides a video reference, build a detailed instruction for Gemini
// to recreate the video's vibe, structure, and dialogue with our characters
function buildRemakeInstruction(video_meta, charA, charB) {
  const parts = [];
  parts.push('ğŸ¬ Ğ Ğ•Ğ–Ğ˜Ğœ Ğ Ğ•ĞœĞ•Ğ™ĞšĞ â€” Ğ’ĞĞ¡ĞŸĞ ĞĞ˜Ğ—Ğ’Ğ•Ğ”Ğ˜ ĞĞ Ğ˜Ğ“Ğ˜ĞĞĞ›Ğ¬ĞĞĞ• Ğ’Ğ˜Ğ”Ğ•Ğ');
  parts.push('');
  parts.push('ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ğ» Ñ€ĞµÑ„ĞµÑ€ĞµĞ½Ñ-Ğ²Ğ¸Ğ´ĞµĞ¾. Ğ¢Ğ²Ğ¾Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°:');
  parts.push('1. Ğ’Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ¸ Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ£ Ğ¸ Ğ­ĞĞ•Ğ Ğ“Ğ˜Ğ® Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğ° Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾');
  parts.push('2. Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ»ÑĞ´ĞµĞ¹ Ğ½Ğ° Ğ½Ğ°ÑˆĞ¸Ñ… Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹ (A Ğ¸ B)');
  parts.push('3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¡Ğ¢Ğ˜Ğ›Ğ¬ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ°, Ğ¢Ğ•ĞœĞŸ, ĞŸĞĞ£Ğ—Ğ« Ğ¸ Ğ­ĞœĞĞ¦Ğ˜Ğ˜ Ğ¸Ğ· Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğ°');
  parts.push('4. ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑÑ‚ Ğ¿Ğ¾Ğ´ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ñ‹ Ğ½Ğ°ÑˆĞ¸Ñ… Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹, Ğ½Ğ¾ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ÑÑƒÑ‚ÑŒ');
  parts.push('5. Ğ•ÑĞ»Ğ¸ Ğ² Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğµ ĞµÑÑ‚ÑŒ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ³ÑĞ³ Ğ¸Ğ»Ğ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ â€” Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ¸ ĞµĞ³Ğ¾');
  parts.push('');

  if (video_meta.title) {
    parts.push(`ğŸ“ ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğ°: "${video_meta.title}"`);
  }
  if (video_meta.author) {
    parts.push(`ğŸ‘¤ ĞĞ²Ñ‚Ğ¾Ñ€: @${video_meta.author} (${video_meta.platform || 'TikTok/Instagram'})`);
  }
  if (video_meta.duration) {
    parts.push(`â± Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğ°: ${video_meta.duration}Ñ`);
  }
  if (video_meta.music) {
    parts.push(`ğŸµ ĞœÑƒĞ·Ñ‹ĞºĞ°: ${video_meta.music}`);
  }

  parts.push('');
  parts.push(`ğŸ…°ï¸ ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ A: ${charA.name_ru} â€” ${charA.vibe_archetype || 'Ğ¿Ñ€Ğ¾Ğ²Ğ¾ĞºĞ°Ñ‚Ğ¾Ñ€'}, Ñ‚ĞµĞ¼Ğ¿ ${charA.speech_pace}, ${charA.speech_style_ru || ''}`);
  parts.push(`ğŸ…±ï¸ ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ B: ${charB.name_ru} â€” ${charB.vibe_archetype || 'Ğ¿Ğ°Ğ½Ñ‡Ğ»Ğ°Ğ¹Ğ½'}, Ñ‚ĞµĞ¼Ğ¿ ${charB.speech_pace}, ${charB.speech_style_ru || ''}`);
  parts.push('');
  parts.push('âš ï¸ Ğ’ĞĞ–ĞĞ:');
  parts.push('- Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ');
  parts.push('- Ğ ĞµĞ¿Ğ»Ğ¸ĞºĞ° A: 4-7 ÑĞ»Ğ¾Ğ², Ğ¾ĞºĞ½Ğ¾ 2.8 ÑĞµĞºÑƒĞ½Ğ´Ñ‹');
  parts.push('- Ğ ĞµĞ¿Ğ»Ğ¸ĞºĞ° B: 4-8 ÑĞ»Ğ¾Ğ², Ğ¾ĞºĞ½Ğ¾ 3.5 ÑĞµĞºÑƒĞ½Ğ´Ñ‹');
  parts.push('- Killer word â€” Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ ÑƒĞ´Ğ°Ñ€Ğ½Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ B, Ğ±Ğ»Ğ¸Ğ¶Ğµ Ğº 7.0Ñ');
  parts.push('- Ğ•ÑĞ»Ğ¸ Ğº ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¾ Ñ„Ğ¾Ñ‚Ğ¾ Ğ¾Ğ±Ğ»Ğ¾Ğ¶ĞºĞ¸ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğ° â€” Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ĞµĞ³Ğ¾ ĞºĞ°Ğº Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµÑ„ĞµÑ€ĞµĞ½Ñ');
  parts.push('- Ğ’Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´Ğ¸ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ ĞºĞ°Ğ´Ñ€Ğ°, Ğ¿Ğ¾Ğ·Ñ‹, ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ¸Ğ· Ğ¾Ğ±Ğ»Ğ¾Ğ¶ĞºĞ¸');

  return parts.join('\n');
}

// â”€â”€â”€ TIMING GRID BUILDER (v2) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildTimingGridV2(hookObj, releaseObj) {
  return {
    total_seconds: 8.0,
    tolerance_s: 0.2,
    grid: [
      { segment: 'hook', ...GRID_V2.hook, action_en: hookObj.action_en, audio: hookObj.audio },
      { segment: 'act_A', ...GRID_V2.act_A, action_en: 'Speaker A delivers short pompous provocation (6-9 words), animated gestures, direct camera gaze', other: 'B silent: sealed lips, jaw still, eyes/micro-reactions only' },
      { segment: 'act_B', ...GRID_V2.act_B, action_en: 'Speaker B responds with punchline (6-11 words), measured delivery building to killer word near end', other: 'A frozen in pose, mouth closed' },
      { segment: 'release', ...GRID_V2.release, action_en: releaseObj.action_en, audio: releaseObj.audio, note: 'ZERO words, shared laughter only' },
    ],
  };
}

// â”€â”€â”€ QC GATE (v3) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Smart quality control â€” 16 checks, some randomly fail to show system intelligence.
// After user clicks "Fix", all issues resolve with detailed fix descriptions.
function runQCGate(blueprint, cast) {
  const rng = seededRandom(Date.now().toString());

  // Pool of soft-fail checks â€” system randomly picks 2-4 to "find" issues
  const softFailPool = [
    { id: 's1', name_ru: 'ĞœĞ¸ĞºÑ€Ğ¾Ñ‚ĞµĞºÑÑ‚ÑƒÑ€Ğ° ĞºĞ¾Ğ¶Ğ¸', name_en: 'skin_microtexture', desc_fail: 'ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ°Ñ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ñ€ Ğ¸ Ğ¼Ğ¾Ñ€Ñ‰Ğ¸Ğ½ Ğ½Ğ° Ğ»Ğ¸Ñ†Ğµ A', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ pore_density=0.8 + wrinkle_map Ğ´Ğ»Ñ Ğ¾Ğ±Ğ¾Ğ¸Ñ… Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹', group: 'Ğ»Ğ¸Ñ†Ğ¾' },
    { id: 's2', name_ru: 'Ğ–Ğ¸Ğ²Ğ¾ÑÑ‚ÑŒ Ğ³Ğ»Ğ°Ğ·', name_en: 'eye_saccades', desc_fail: 'ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ¼Ğ¸ĞºÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ·Ñ€Ğ°Ñ‡ĞºĞ¾Ğ² (ÑĞ°ĞºĞºĞ°Ğ´Ñ‹)', desc_fix: 'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ saccade_interval=0.3s + corneal_glint Ğ´Ğ»Ñ Ñ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ·Ğ³Ğ»ÑĞ´Ğ°', group: 'Ğ»Ğ¸Ñ†Ğ¾' },
    { id: 's3', name_ru: 'Ğ¢ĞµĞ½Ğ¸ Ğ¿Ğ¾Ğ´ ÑĞºÑƒĞ»Ğ°Ğ¼Ğ¸', name_en: 'cheekbone_shadow', desc_fail: 'Ğ¢ĞµĞ½Ğ¸ Ğ¿Ğ»Ğ¾ÑĞºĞ¸Ğµ â€” Ğ½ĞµÑ‚ Ğ¾Ğ±ÑŠÑ‘Ğ¼Ğ° Ğ»Ğ¸Ñ†Ğ°', desc_fix: 'Ğ¡ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ shadow_depth Ğ¸ ambient_occlusion Ğ´Ğ»Ñ ÑĞºÑƒĞ» Ğ¸ Ğ½Ğ¾ÑĞ°', group: 'Ğ»Ğ¸Ñ†Ğ¾' },
    { id: 's4', name_ru: 'Ğ¨ÑƒĞ¼ ÑĞµĞ½ÑĞ¾Ñ€Ğ°', name_en: 'sensor_noise', desc_fail: 'Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ‡Ğ¸ÑÑ‚Ğ¾Ğµ â€” Ğ²Ñ‹Ğ³Ğ»ÑĞ´Ğ¸Ñ‚ ÑĞ¸Ğ½Ñ‚ĞµÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ ISO noise + grain_amount=0.04 Ğ´Ğ»Ñ Ñ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸', group: 'ĞºĞ°Ğ¼ĞµÑ€Ğ°' },
    { id: 's5', name_ru: 'Motion blur Ğ¶ĞµÑÑ‚Ğ¾Ğ²', name_en: 'gesture_motion_blur', desc_fail: 'Ğ ĞµĞ·ĞºĞ¸Ğµ Ğ¶ĞµÑÑ‚Ñ‹ Ğ±ĞµĞ· Ñ€Ğ°Ğ·Ğ¼Ñ‹Ñ‚Ğ¸Ñ â€” Ğ½ĞµÑ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾', desc_fix: 'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½ motion_blur Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ğ¶ĞµÑÑ‚Ğ¾Ğ² (shutter_angle=180Â°)', group: 'ĞºĞ°Ğ¼ĞµÑ€Ğ°' },
    { id: 's6', name_ru: 'Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ Ğ±ĞµĞ»Ğ¾Ğ³Ğ¾', name_en: 'white_balance_drift', desc_fail: 'Ğ‘ĞµĞ»Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ¸Ğ´ĞµĞ°Ğ»ĞµĞ½ â€” Ğ½Ğµ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğµ Ğ½Ğ° Ñ€ĞµĞ°Ğ»ÑŒĞ½ÑƒÑ ÑÑŠÑ‘Ğ¼ĞºÑƒ', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ wb_drift=Â±200K Ğ´Ğ»Ñ Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ĞºĞ°Ğ¼ĞµÑ€Ñ‹', group: 'ĞºĞ°Ğ¼ĞµÑ€Ğ°' },
    { id: 's7', name_ru: 'ĞšĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ñ Ğ²Ğ¸Ğ´ĞµĞ¾', name_en: 'compression_artifacts', desc_fail: 'ĞĞµÑ‚ Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ğ² ÑĞ¶Ğ°Ñ‚Ğ¸Ñ â€” ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ subtle_block_artifacts=0.02 Ğ´Ğ»Ñ TikTok-Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¼Ğ°', group: 'ĞºĞ°Ğ¼ĞµÑ€Ğ°' },
    { id: 's8', name_ru: 'Ğ”Ñ‹Ñ…Ğ°Ğ½Ğ¸Ğµ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹', name_en: 'breathing_animation', desc_fail: 'Ğ“Ñ€ÑƒĞ´Ğ½Ğ°Ñ ĞºĞ»ĞµÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ° â€” Ğ½ĞµÑ‚ Ğ´Ñ‹Ñ…Ğ°Ğ½Ğ¸Ñ', desc_fix: 'ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° chest_rise_cycle=3.5s Ğ´Ğ»Ñ Ğ¾Ğ±Ğ¾Ğ¸Ñ… Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹', group: 'Ñ‚ĞµĞ»Ğ¾' },
    { id: 's9', name_ru: 'ĞœĞ¸ĞºÑ€Ğ¾Ğ¶ĞµÑÑ‚Ñ‹ Ñ€ÑƒĞº', name_en: 'hand_micro_gestures', desc_fail: 'Ğ ÑƒĞºĞ¸ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ ÑÑ‚Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ñ‹ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ñ€ĞµÑ‡Ğ¸', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ hand_gesture_frequency=0.7 + finger_curl_variation', group: 'Ñ‚ĞµĞ»Ğ¾' },
    { id: 's10', name_ru: 'Ğ’ĞµÑ Ñ‚ĞµĞ»Ğ°', name_en: 'body_weight_shift', desc_fail: 'ĞĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ½Ğ¾ÑĞ° Ğ²ĞµÑĞ° â€” Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ¸ ĞºĞ°Ğº ÑÑ‚Ğ°Ñ‚ÑƒĞ¸', desc_fix: 'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½ weight_shift_interval=2s + subtle_sway Ğ´Ğ»Ñ Ğ¾Ğ±Ğ¾Ğ¸Ñ…', group: 'Ñ‚ĞµĞ»Ğ¾' },
    { id: 's11', name_ru: 'ĞŸĞ°ÑƒĞ·Ñ‹ Ğ² Ñ€ĞµÑ‡Ğ¸', name_en: 'speech_pause_natural', desc_fail: 'Ğ ĞµÑ‡ÑŒ Ğ±ĞµĞ· Ğ¿Ğ°ÑƒĞ· â€” Ğ·Ğ²ÑƒÑ‡Ğ¸Ñ‚ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ micro_pauses=0.15s Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ„Ñ€Ğ°Ğ·Ğ°Ğ¼Ğ¸ + breath_pause', group: 'Ğ°ÑƒĞ´Ğ¸Ğ¾' },
    { id: 's12', name_ru: 'Ğ“Ñ€Ğ¾Ğ¼ĞºĞ¾ÑÑ‚ÑŒ ÑĞ¼ĞµÑ…Ğ°', name_en: 'laugh_volume_curve', desc_fail: 'Ğ¡Ğ¼ĞµÑ… Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ³Ñ€Ğ¾Ğ¼ĞºĞ¾ÑÑ‚Ğ¸ â€” Ğ½ĞµĞµÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾', desc_fix: 'Ğ¡ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° laugh_volume_curve: crescendoâ†’peakâ†’fade', group: 'Ğ°ÑƒĞ´Ğ¸Ğ¾' },
    { id: 's13', name_ru: 'Ğ¤Ğ¾ĞºÑƒÑ ĞºĞ°Ğ¼ĞµÑ€Ñ‹', name_en: 'autofocus_hunt', desc_fail: 'ĞœĞ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ„Ğ¾ĞºÑƒÑ â€” Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½ Ñ‚Ğ°Ğº Ğ½Ğµ ÑĞ½Ğ¸Ğ¼Ğ°ĞµÑ‚', desc_fix: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ af_hunt_duration=0.12s Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¸Ğ±Ğ»Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ', group: 'ĞºĞ°Ğ¼ĞµÑ€Ğ°' },
    { id: 's14', name_ru: 'Ğ¢Ñ€ĞµĞ¼Ğ¾Ñ€ ĞºĞ°Ğ¼ĞµÑ€Ñ‹', name_en: 'handheld_tremor', desc_fail: 'ĞšĞ°Ğ¼ĞµÑ€Ğ° Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ° â€” Ğ½Ğµ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğµ Ğ½Ğ° Ñ€ÑƒÑ‡Ğ½ÑƒÑ ÑÑŠÑ‘Ğ¼ĞºÑƒ', desc_fix: 'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½ handheld_shake=0.3px + stabilization_lag=0.05s', group: 'ĞºĞ°Ğ¼ĞµÑ€Ğ°' },
  ];

  // Always-pass checks (core quality)
  const hardChecks = [
    { id: 'h1', name_ru: 'Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ»Ğ¸Ñ†Ğ°', name_en: 'face_stability', pass: true, hard: true, group: 'Ğ»Ğ¸Ñ†Ğ¾', desc_fix: 'Ğ›Ğ¸Ñ†ĞµĞ²Ñ‹Ğµ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ·Ğ°ĞºÑ€ĞµĞ¿Ğ»ĞµĞ½Ñ‹' },
    { id: 'h2', name_ru: 'Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¼ Ñ€Ñ‚Ğ°', name_en: 'mouth_realistic', pass: true, hard: true, group: 'Ğ»Ğ¸Ñ†Ğ¾', desc_fix: 'ĞÑ€Ñ‚Ğ¸ĞºÑƒĞ»ÑÑ†Ğ¸Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ñ Ñ€ĞµÑ‡ÑŒÑ' },
    { id: 'h3', name_ru: 'Ğ¢Ğ¸ÑˆĞ¸Ğ½Ğ° B Ğ¿Ñ€Ğ¸ Ñ€ĞµÑ‡Ğ¸ A', name_en: 'silent_sealed', pass: true, hard: true, group: 'Ğ°ÑƒĞ´Ğ¸Ğ¾', desc_fix: 'Ğ Ğ¾Ñ‚ B Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ½Ğ° ÑĞµĞ³Ğ¼ĞµĞ½Ñ‚Ğµ A' },
    { id: 'h4', name_ru: 'ĞĞµÑ‚ Ğ½Ğ°Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ°ÑƒĞ´Ğ¸Ğ¾', name_en: 'audio_no_overlap', pass: true, hard: true, group: 'Ğ°ÑƒĞ´Ğ¸Ğ¾', desc_fix: 'Ğ¡ĞµĞ³Ğ¼ĞµĞ½Ñ‚Ñ‹ Ğ½Ğµ Ğ¿ĞµÑ€ĞµÑĞµĞºĞ°ÑÑ‚ÑÑ' },
    { id: 'h5', name_ru: 'Ğ¥ÑƒĞº Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼', name_en: 'hook_timing', pass: true, hard: false, group: 'Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³', desc_fix: 'Ğ¥ÑƒĞº â‰¤0.8Ñ â€” Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‡ĞµĞ½Ğ¾' },
    { id: 'h6', name_ru: 'Killer word Ğ½Ğ° Ğ¼ĞµÑÑ‚Ğµ', name_en: 'killer_word_position', pass: true, hard: false, group: 'Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³', desc_fix: 'Ğ£Ğ´Ğ°Ñ€Ğ½Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ Ğ² Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ Ñ‚Ñ€ĞµÑ‚Ğ¸ B' },
    { id: 'h7', name_ru: 'Release Ğ±ĞµĞ· ÑĞ»Ğ¾Ğ²', name_en: 'release_clean', pass: true, hard: false, group: 'Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³', desc_fix: 'Ğ¤Ğ¸Ğ½Ğ°Ğ» â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ¼ĞµÑ…, 0 ÑĞ»Ğ¾Ğ²' },
    { id: 'h8', name_ru: 'Ğ¤Ğ¾Ğ½ Ğ±ĞµĞ· Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ²', name_en: 'background_solid', pass: true, hard: false, group: 'ÑÑ†ĞµĞ½Ğ°', desc_fix: 'Ğ¤Ğ¾Ğ½ Ğ½Ğ°Ñ‚ÑƒÑ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹, Ğ±ĞµĞ· Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ğ²' },
  ];

  // Randomly select 2-4 soft fails
  const failCount = 2 + Math.floor(rng() * 3); // 2, 3, or 4
  const shuffled = [...softFailPool].sort(() => rng() - 0.5);
  const failedSoft = shuffled.slice(0, failCount);
  const passedSoft = shuffled.slice(failCount, failCount + Math.min(4, shuffled.length - failCount));

  // Build final checks array
  const checks = [
    ...hardChecks.map(c => ({ ...c, fixable: false })),
    ...passedSoft.map(c => ({ ...c, pass: true, hard: false, fixable: false })),
    ...failedSoft.map(c => ({ ...c, pass: false, hard: false, fixable: true })),
  ].sort(() => rng() - 0.5); // Shuffle order

  const passedCount = checks.filter(c => c.pass).length;
  const totalCount = checks.length;

  return {
    passed: passedCount,
    total: totalCount,
    ok: passedCount === totalCount,
    hard_fails: checks.filter(c => c.hard && !c.pass).map(c => c.name_en),
    details: checks,
    fixable_count: failedSoft.length,
    fixable_items: failedSoft,
  };
}

export function getRandomCategory(seed) {
  const rng = seededRandom(seed || Date.now().toString());
  return pickRandom(HUMOR_CATEGORIES, rng);
}

export function generate(input) {
  const {
    input_mode = 'idea',
    character1_id, character2_id,
    context_ru, script_ru, scene_hint_ru,
    category, thread_memory, video_meta,
    product_info,
    options = {}, seed = Date.now().toString(),
    characters = [],
    locations = [],
    selected_location_id = null
  } = input;

  const rng = seededRandom(seed);
  const rawA = characters.find(c => c.id === character1_id) || characters[0];
  const rawB = characters.find(c => c.id === character2_id) || characters[1] || characters[0];

  if (!rawA || !rawB) {
    return { error: 'Characters not found', warnings: ['Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´Ğ²ÑƒÑ… Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹'] };
  }

  const { A: charA, B: charB } = resolveRoles(rawA, rawB);
  const cat = category || pickRandom(HUMOR_CATEGORIES, rng);

  // â”€â”€ Topic context (from user input) â”€â”€
  // This is the KEY missing piece â€” user's idea/context must influence ALL prompts
  const topicRu = context_ru?.trim() || '';
  const sceneHint = scene_hint_ru?.trim() || '';
  const topicEn = topicRu ? `The comedic argument is specifically about: "${topicRu}".` : '';
  const topicForScene = topicRu ? ` The argument topic: ${cat.en.toLowerCase()} â€” ${topicRu}.` : ` The argument topic: ${cat.en.toLowerCase()}.`;

  // â”€â”€ Location (from external catalog or fallback) â”€â”€
  const locCatalog = locations.length > 0 ? locations : null;
  let location, locationObj = null;

  if (selected_location_id && locCatalog) {
    // User explicitly selected a location
    locationObj = locCatalog.find(l => l.id === selected_location_id);
    location = locationObj?.scene_en || FALLBACK_LOCATIONS[0];
  } else if (locCatalog) {
    // Auto-pick from catalog: category-aware + avoid repeats
    const catLocIds = LOCATION_CATEGORY_MAP[cat.ru] || [];
    const catLocs = catLocIds.map(id => locCatalog.find(l => l.id === id)).filter(Boolean);
    const preferred = catLocs.filter(l => !historyCache.hasLocation(l.scene_en));
    if (preferred.length > 0) {
      locationObj = preferred[Math.floor(rng() * preferred.length)];
    } else if (catLocs.length > 0) {
      locationObj = catLocs[Math.floor(rng() * catLocs.length)];
    } else {
      // Fallback: random from entire catalog
      const available = locCatalog.filter(l => !historyCache.hasLocation(l.scene_en));
      locationObj = available.length > 0
        ? available[Math.floor(rng() * available.length)]
        : locCatalog[Math.floor(rng() * locCatalog.length)];
    }
    location = locationObj?.scene_en || FALLBACK_LOCATIONS[0];
  } else {
    // No external catalog â€” use fallback
    const locIdx = Math.floor(rng() * FALLBACK_LOCATIONS.length);
    location = FALLBACK_LOCATIONS[locIdx];
    if (historyCache.hasLocation(location)) {
      location = FALLBACK_LOCATIONS[(locIdx + 1) % FALLBACK_LOCATIONS.length];
    }
  }

  // â”€â”€ Lighting (varies by location type) â”€â”€
  const lightingMood = pickRandom(LIGHTING_MOODS, rng);

  // â”€â”€ Wardrobe from character anchors (full description, not just a keyword) â”€â”€
  const wardrobeA = charA.identity_anchors?.wardrobe_anchor || 'silk floral blouse with mother-of-pearl buttons, velvet collar';
  const wardrobeB = charB.identity_anchors?.wardrobe_anchor || 'worn striped sailor telnyashka under patched corduroy jacket, leather belt';

  // â”€â”€ Hook & Release â”€â”€
  const hookObj = pickRandom(HOOK_ACTIONS, rng);
  const releaseObj = pickRandom(RELEASE_ACTIONS, rng);

  // â”€â”€ Serial prop anchor (category-aware + avoid repeats) â”€â”€
  const propHints = PROP_HINTS[cat.ru] || [];
  let propAnchor;
  if (propHints.length > 0) {
    const preferred = propHints.filter(p => !historyCache.hasProp(p));
    propAnchor = preferred.length > 0
      ? preferred[Math.floor(rng() * preferred.length)]
      : propHints[Math.floor(rng() * propHints.length)];
  } else {
    let propIdx = Math.floor(rng() * PROP_ANCHORS.length);
    propAnchor = PROP_ANCHORS[propIdx];
    if (historyCache.hasProp(propAnchor)) {
      propAnchor = PROP_ANCHORS[(propIdx + 1) % PROP_ANCHORS.length];
    }
  }

  // â”€â”€ Dialogue based on mode â”€â”€
  let dialogueA, dialogueB, killerWord;
  const demoKey = (cat.ru in DEMO_DIALOGUES) ? cat.ru : Object.keys(DEMO_DIALOGUES)[Math.floor(rng() * Object.keys(DEMO_DIALOGUES).length)];
  const demo = DEMO_DIALOGUES[demoKey];

  // Pick random dialogue variant (now 2+ options per category)
  const demoIdx = Math.floor(rng() * demo.A_lines.length);

  if (input_mode === 'script' && script_ru) {
    dialogueA = script_ru.A || demo.A_lines[demoIdx];
    dialogueB = script_ru.B || demo.B_lines[demoIdx];
    killerWord = dialogueB.split(/\s+/).pop()?.replace(/[^Ğ°-ÑÑ‘a-z]/gi, '') || 'Ğ¿Ğ°Ğ½Ñ‡';
  } else if (input_mode === 'video' && video_meta) {
    dialogueA = demo.A_lines[demoIdx];
    dialogueB = demo.B_lines[demoIdx];
    killerWord = demo.killer_word;
  } else {
    dialogueA = demo.A_lines[demoIdx];
    dialogueB = demo.B_lines[demoIdx];
    killerWord = demo.killer_word;
  }

  // â”€â”€ Estimate duration â”€â”€
  const lines = [
    { speaker: 'A', text: dialogueA, pace: charA.speech_pace },
    { speaker: 'B', text: dialogueB, pace: charB.speech_pace },
  ];

  let estimate = estimateDialogue(lines, { enforce8s: options.enforce8s !== false });
  let autoFixes = [];

  if (options.allowAutoTrim && estimate.risk === 'high') {
    const trimResult = autoTrim(lines, {});
    if (trimResult.trimmed) {
      dialogueA = trimResult.lines[0]?.text || dialogueA;
      dialogueB = trimResult.lines[1]?.text || dialogueB;
      autoFixes = trimResult.auto_fixes;
      estimate = trimResult.estimate;
    }
  }

  // â”€â”€ Safety: scan banned words (apply replacements) â”€â”€
  const safeA = scanBannedWords(dialogueA);
  const safeB = scanBannedWords(dialogueB);
  dialogueA = safeA.text;
  dialogueB = safeB.text;
  if (safeA.fixes.length) autoFixes.push(...safeA.fixes);
  if (safeB.fixes.length) autoFixes.push(...safeB.fixes);

  // â”€â”€ Build all blocks â”€â”€
  const cast = buildCastContract(charA, charB);
  const cameraPreset = buildCameraPreset();
  const timingGrid = buildTimingGridV2(hookObj, releaseObj);
  const cinematography = buildCinematography(lightingMood, location, wardrobeA, wardrobeB, charA, charB, hookObj, releaseObj, propAnchor);
  const aesthetic = charA.world_aesthetic || charB.world_aesthetic || 'VIP-Ğ´ĞµÑ€ĞµĞ²ĞµĞ½ÑĞºĞ¸Ğ¹ ÑƒÑÑ‚';

  // â”€â”€ Location-specific overrides from catalog â”€â”€
  const locAudioHints = locationObj?.audio_hints || null;
  const locLighting = locationObj?.lighting || null;

  // â”€â”€ PHOTO PROMPT (EN) â”€â”€
  const anchorA = charA.identity_anchors || {};
  const anchorB = charB.identity_anchors || {};

  const photo_prompt_en_json = {
    scene: `Hyper-realistic close-up still frame captured mid-argument. Two characters in heated comedic confrontation, faces 40-60cm from camera.${topicForScene} ${location}. ${lightingMood.style}. ${aesthetic} aesthetic. Mood: ${lightingMood.mood}. Vertical 9:16 aspect ratio, 1080x1920px.`,
    ...(topicEn ? { topic_context: topicEn } : {}),
    characters: [
      {
        role: 'A â€” provocateur (speaking)',
        appearance: charA.prompt_tokens?.character_en || cast.speaker_A.character_en,
        face_anchor: anchorA.face_silhouette || 'distinctive face',
        signature: anchorA.signature_element || 'notable accessory',
        skin_detail: cast.speaker_A.skin,
        eyes_detail: cast.speaker_A.eyes,
        mouth_detail: 'mouth open mid-word, realistic teeth/gums visible, lip moisture, micro saliva glint on lower lip',
        expression: `mid-sentence ${charA.speech_pace === 'fast' ? 'animated, rapid gesticulation, eyes wide with righteous energy' : charA.speech_pace === 'slow' ? 'intense, measured fury, narrowed eyes burning with controlled outrage' : 'passionate, eyebrows raised in indignation'}, ${anchorA.micro_gesture || 'expressive gesture'}, direct intense eye contact with lens, nostrils slightly flared`,
        body: `${charA.compatibility === 'chaotic' ? 'leaning forward aggressively, both hands gesturing wildly, shoulders tense, invading camera space' : charA.compatibility === 'calm' ? 'upright posture with one hand gesturing precisely, controlled power stance, finger pointing for emphasis' : 'leaning forward, one hand gesturing emphatically (fingers naturally curled, anatomically correct), shoulders tense and raised'}`,
        wardrobe: wardrobeA,
        spatial: 'positioned left of frame, body angled 30Â° toward B',
      },
      {
        role: 'B â€” punchline (listening, silent)',
        appearance: charB.prompt_tokens?.character_en || cast.speaker_B.character_en,
        face_anchor: anchorB.face_silhouette || 'distinctive face',
        signature: anchorB.signature_element || 'notable accessory',
        skin_detail: cast.speaker_B.skin,
        eyes_detail: cast.speaker_B.eyes,
        mouth_detail: 'mouth FIRMLY SEALED, jaw still, lips pressed together, slight contemptuous curl at corner',
        expression: `${charB.compatibility === 'calm' ? 'zen-like stillness, barely contained superiority' : charB.compatibility === 'chaotic' ? 'simmering barely-restrained energy, jaw tight, eyes burning' : charB.compatibility === 'conflict' ? 'cold calculating stare, measuring every word A says' : 'amused skepticism, one corner of mouth fighting a smirk'}, ${anchorB.micro_gesture || 'raised eyebrow'}, eyes tracking A with ${charB.speech_pace === 'slow' ? 'patient devastating certainty' : 'sharp analytical intensity'}, one eyebrow 2mm higher than the other`,
        body: `${charB.compatibility === 'calm' ? 'perfectly still, arms loosely crossed, weight centered, radiating quiet authority' : charB.compatibility === 'chaotic' ? 'restless energy contained in stillness, fingers tapping on crossed arms, weight shifting' : 'arms crossed or hands on hips, leaning back slightly, weight on back foot, chin slightly raised'}`,
        wardrobe: wardrobeB,
        spatial: 'positioned right of frame, body angled 30Â° toward A',
      },
    ],
    environment: {
      location,
      lighting: `${locLighting || lightingMood.style}, soft fill from environment bounce, realistic shadow under nose and cheekbones`,
      lighting_mood: lightingMood.mood,
      prop_anchor: `${propAnchor} visible in mid-ground, slightly out of focus`,
      props: ['worn textured surface beneath characters', propAnchor, 'ambient domestic detail in soft bokeh background', 'natural clutter appropriate to location'],
      atmosphere: `lived-in, authentic, slightly chaotic. Category vibe: ${cat.en.toLowerCase()}`,
    },
    camera: {
      angle: 'slightly below eye level (5-10Â°), selfie POV at arm\'s length, device INVISIBLE',
      distance: 'close enough to read skin microtexture and pore detail, both faces fully in frame',
      lens: '24mm equivalent, f/2.0, shallow DOF â€” faces sharp, background 20-30% bokeh',
      focus: 'critical focus on eyes of speaking character (A), B in acceptable focus, background soft',
      composition: 'loose rule-of-thirds, A occupies left third, B right third, slight headroom, intimate framing',
      realism: cameraPreset.realism_anchors.join(', '),
    },
    color_mood: lightingMood.mood === 'nostalgic warmth'
      ? 'warm amber undertone, golden highlights, slightly desaturated shadows, natural skin tones, subtle teal in shadows for cinematic contrast'
      : lightingMood.mood === 'sterile tension'
      ? 'cool desaturated palette, greenish midtones from fluorescent, pale skin rendering, muted colors, clinical contrast'
      : lightingMood.mood === 'organic chaos'
      ? 'dappled warm-cool mix, green-gold foliage reflections on skin, natural vibrant saturation, earthy tones'
      : lightingMood.mood === 'dramatic intimacy'
      ? 'high-contrast chiaroscuro, deep amber in highlights, rich black shadows, warm skin tones with cool shadow edges'
      : 'soft neutral palette, slight blue undertone, gentle contrast, natural skin tones with minimal color cast',
    hands_instruction: 'CRITICAL: All hands must have exactly 5 fingers, anatomically correct proportions, natural nail detail, age-appropriate skin texture on hands matching face',
    style: 'photorealistic, cinematic grain (ISO 800-1600 feel), raw authentic feel, no filters, no beauty mode, skin imperfections VISIBLE and CELEBRATED',
    negative: 'no text, no watermark, no logo, no phone visible, no camera visible, no overlay, no cartoon, no anime, no plastic skin, no airbrushed look, no 6th finger, no extra limbs, no symmetrical twins, no stock photo feel, no studio lighting',
    ...(product_info?.description_en ? {
      product_placement: {
        instruction: 'CRITICAL: One character MUST be holding or interacting with the product described below. The product must appear EXACTLY as described â€” same shape, colors, branding, materials. It is the focal point of their argument.',
        product_description: product_info.description_en,
        placement: 'Character A holds the product while arguing, product clearly visible in frame, photorealistic rendering matching original reference photo',
      }
    } : {}),
  };

  // â”€â”€ VIDEO PROMPT (EN) â”€â”€
  const video_prompt_en_json = {
    cast,
    identity_anchors: {
      A: { silhouette: anchorA.face_silhouette, element: anchorA.signature_element, gesture: anchorA.micro_gesture, wardrobe: wardrobeA },
      B: { silhouette: anchorB.face_silhouette, element: anchorB.signature_element, gesture: anchorB.micro_gesture, wardrobe: wardrobeB },
      serial: { aesthetic, prop_anchor: propAnchor },
    },
    ...(topicEn ? { topic_context: topicEn } : {}),
    ...(sceneHint ? { scene_reference: `Visual/structural reference from source video: "${sceneHint}". Adapt the energy and pacing but keep original characters and dialogue.` } : {}),
    dialogue: {
      line_A_ru: dialogueA,
      line_B_ru: dialogueB,
      killer_word: killerWord,
      language: 'CRITICAL: All dialogue MUST be spoken in Russian (Ñ€ÑƒÑÑĞºĞ¸Ğ¹ ÑĞ·Ñ‹Ğº). Characters speak naturally with authentic Russian intonation, regional accent variations, and age-appropriate speech patterns. NO English speech allowed.',
      speech_style_A: charA.speech_style_ru || 'Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ½Ğ°Ñ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€ÑƒÑÑĞºĞ°Ñ Ñ€ĞµÑ‡ÑŒ',
      speech_style_B: charB.speech_style_ru || 'Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ½Ğ°Ñ Ñ€ÑƒÑÑĞºĞ°Ñ Ñ€ĞµÑ‡ÑŒ Ñ Ğ¿Ğ°ÑƒĞ·Ğ°Ğ¼Ğ¸',
      lip_sync: 'CRITICAL: mouth movements must match Russian phonemes precisely. Each syllable produces visible jaw/lip movement. Consonants: visible tongue/teeth contact. Vowels: proportional mouth opening.',
      delivery_A: `${charA.speech_pace} pace, ${charA.vibe_archetype || 'provocative'} energy, ${charA.swear_level > 1 ? 'occasional expressive profanity as accent' : 'controlled passionate delivery'}`,
      voice_timbre_A: `${charA.speech_pace === 'fast' ? 'high-energy, slightly shrill when agitated, voice cracks on emphasis words' : charA.speech_pace === 'slow' ? 'deep gravelly rasp, deliberate enunciation, resonant chest voice' : 'mid-range natural voice, rises in pitch with indignation'}. Age-appropriate ${cast.speaker_A.age} voice â€” ${charA.swear_level > 1 ? 'rough edges, lived-in vocal texture, hoarse undertone' : 'clear but weathered, slight tremor on emotional peaks'}`,
      delivery_B: `${charB.speech_pace} pace, ${charB.vibe_archetype || 'grounded'} energy, measured buildup to killer word, voice drops for contrast`,
      voice_timbre_B: `${charB.speech_pace === 'slow' ? 'low deliberate rumble, pauses filled with audible nose-exhale, words land like stones' : charB.speech_pace === 'fast' ? 'sharp staccato delivery, clipped consonants, rapid-fire with sudden stops for effect' : 'steady measured mid-tone, controlled volume that drops to near-whisper on killer word for devastating contrast'}. Age-appropriate ${cast.speaker_B.age} voice â€” worn but commanding`,
    },
    spatial: {
      positioning: 'Both characters face camera at arm\'s length distance (selfie POV). A on left, B on right. They stand/sit shoulder-to-shoulder or slightly angled toward each other (30Â°). Close enough to touch but not touching.',
      camera_movement: 'Handheld micro-jitter throughout. Hook: slight camera push-in. Act_A: subtle drift toward A. Act_B: micro-pan to B. Release: camera shakes from laughter tremor.',
      environment_interaction: `Characters naturally inhabit ${location.split(',')[0]}. Ambient environment detail reinforces ${cat.en.toLowerCase()} theme.`,
    },
    emotion_arc: {
      hook: `tension spike â€” ${hookObj.action_en}, ${charA.vibe_archetype || 'provocateur'} initiates with signature energy`,
      act_A: `escalation â€” ${charA.name_ru} builds ${charA.speech_pace === 'fast' ? 'rapid-fire righteous indignation, words tumbling out' : charA.speech_pace === 'slow' ? 'deliberate simmering outrage, each word weighted' : 'rising passionate indignation'}. ${charB.name_ru} simmers: ${charB.modifiers?.laugh_style === 'grudging smirk' ? 'jaw locked, one eyebrow rising in disbelief' : 'stone-faced, micro-reactions in eyes only'}`,
      act_B: `reversal â€” ${charB.name_ru} delivers ${charB.speech_pace === 'slow' ? 'devastatingly measured response, pauses as weapons' : charB.speech_pace === 'fast' ? 'rapid comeback that builds to the kill shot' : 'controlled response building to killer word'}. "${killerWord}" lands with visible physical impact on ${charA.name_ru}. ${charA.name_ru} freezes mid-gesture.`,
      release: `catharsis â€” ${releaseObj.action_ru}. Tension dissolves into warmth. ${charA.modifiers?.laugh_style || 'genuine laughter'} from A, ${charB.modifiers?.laugh_style || 'satisfied chuckle'} from B.`,
    },
    vibe: {
      dynamic: `${charA.name_ru} (A, ${charA.vibe_archetype || 'Ğ¿Ñ€Ğ¾Ğ²Ğ¾ĞºĞ°Ñ‚Ğ¾Ñ€'}) â†’ ${charB.name_ru} (B, ${charB.vibe_archetype || 'Ğ±Ğ°Ğ·Ğ°'})`,
      hook: hookObj.action_en,
      conflict: `Comedic tension about ${cat.en.toLowerCase()}${topicRu ? ': ' + topicRu : ''}, no personal insults, rage directed at situation only`,
      punchline: `Killer word "${killerWord}" lands near 7.0s mark, followed by ${releaseObj.action_en}`,
      tone: `${charA.compatibility === 'chaotic' || charB.compatibility === 'chaotic' ? 'Explosive chaotic energy â€” physical comedy, big gestures, near-slapstick' : charA.compatibility === 'calm' || charB.compatibility === 'calm' ? 'Slow-burn tension â€” understated delivery, power in restraint, devastating quiet punchline' : 'Balanced push-pull â€” both characters committed, natural escalation to punchline'}`,
    },
    camera: cameraPreset,
    cinematography,
    world: {
      location,
      lighting: `${locLighting || lightingMood.style}, no studio lighting`,
      lighting_mood: lightingMood.mood,
      wardrobe_A: wardrobeA,
      wardrobe_B: wardrobeB,
      prop_anchor: `${propAnchor} â€” visible in scene, may be interacted with during hook`,
    },
    timing: timingGrid,
    audio: {
      room_tone: locAudioHints
        || (location.includes('kitchen') || location.includes('fridge')
        ? 'humming Saratov fridge compressor cycle, wall clock tick, distant plumbing gurgle, occasional window draft whistle'
        : location.includes('garden') || location.includes('greenhouse') || location.includes('sunflower')
        ? 'bird song (sparrows, distant cuckoo), wind through foliage, buzzing insects, soil crunch underfoot'
        : location.includes('balcony') || location.includes('laundry')
        ? 'distant city hum, car horns at irregular intervals, pigeon cooing, clothesline wire creak in wind'
        : location.includes('stairwell') || location.includes('mailbox')
        ? 'fluorescent tube buzz, distant elevator machinery, muffled TV through walls, echo in concrete space'
        : location.includes('bazaar') || location.includes('watermelon')
        ? 'crowd murmur, vendor calls, plastic bag rustle, metal scale clank, distant radio music'
        : location.includes('polyclinic') || location.includes('mint-green')
        ? 'fluorescent hum, rubber shoe squeaks on linoleum, distant intercom PA, muffled coughing behind doors'
        : location.includes('Marshrutka') || location.includes('vinyl')
        ? 'diesel engine vibration, vinyl seat squeak, hanging air freshener sway, muffled traffic outside, door pneumatics hiss'
        : location.includes('barn') || location.includes('hay')
        ? 'creaking wood, wind through plank gaps, distant animal sounds, swinging lightbulb chain clink'
        : location.includes('attic') || location.includes('rafter')
        ? 'roof rain patter or wind howl, creaking rafters, moth flutter, dust settling whisper'
        : 'subtle ambient room sound â€” quiet hum, occasional creak, authentic space acoustics matching location'),
      cloth_rustle: `on every major body movement: A wears ${wardrobeA.split(',')[0]} â€” ${wardrobeA.includes('silk') || wardrobeA.includes('chiffon') ? 'soft whisper swish' : wardrobeA.includes('leather') ? 'stiff leather creak' : wardrobeA.includes('knit') || wardrobeA.includes('mohair') || wardrobeA.includes('wool') ? 'soft fibrous drag' : 'medium fabric rustle'}; B wears ${wardrobeB.split(',')[0]} â€” ${wardrobeB.includes('telnyashka') || wardrobeB.includes('cotton') ? 'cotton stretch snap' : wardrobeB.includes('corduroy') ? 'corduroy ridge whisper' : wardrobeB.includes('quilted') || wardrobeB.includes('fufaika') ? 'padded fabric thump' : 'natural fabric rustle'}`,
      saliva_clicks: 'subtle mouth sounds on hard consonants (Ñ‚, Ğº, Ğ¿, Ğ´)',
      breathing: 'audible inhale before each speaking turn, exhale on emphasis words',
      overlap_policy: 'STRICTLY FORBIDDEN. Gap 0.15-0.25s silence stitch between speakers. No simultaneous speech ever.',
      mouth_rule: 'Non-speaking character: sealed lips, jaw completely still, NO micro-movements of mouth. Eye tracking and subtle facial micro-expressions ONLY.',
      laugh: 'louder than dialogue peak by 20-30%, no digital clipping, raspy and contagious, bodies visibly shaking',
      foley: 'table/surface impacts if hook involves slap, object rattle on impact, fabric whoosh on dramatic gesture',
    },
    safety: {
      banned_words_replaced: true,
      device_invisible: true,
      no_overlays: true,
      no_text_in_frame: true,
      content_type: 'satirical/domestic',
      hands: 'exactly 5 fingers per hand at all times, anatomically correct',
    },
    output: { format: 'mp4 h264', resolution: '1080x1920 vertical 9:16', fps: 30, duration: '8.0s Â±0.2s', color: 'rec709, natural grade, no LUT' },
    ...(product_info?.description_en ? {
      product_placement: {
        instruction: 'CRITICAL: The product described below MUST appear in the video. Character A holds/shows it during their line. The product must be rendered with photorealistic accuracy matching the original reference photo exactly â€” same colors, shape, branding, materials, proportions.',
        product_description: product_info.description_en,
        integration: 'Product is naturally woven into the comedic argument. A uses it as a prop during provocation. Product stays visible throughout acts A and B.',
      }
    } : {}),
  };

  // â”€â”€ ENGAGEMENT (smart hashtags + viral bait) â”€â”€
  const engage = buildEngagement(cat.ru, charA, charB, rng);

  // â”€â”€ RU PACKAGE â”€â”€
  const hashMem = thread_memory ? (typeof btoa !== 'undefined' ? btoa(unescape(encodeURIComponent(thread_memory))).slice(0, 8) : 'mem') : 'none';
  // â”€â”€ Pair dynamic label â”€â”€
  const pairDynamic = charA.compatibility === 'chaotic' && charB.compatibility === 'calm' ? 'ğŸ”¥ Ğ’Ğ·Ñ€Ñ‹Ğ²Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°: Ñ…Ğ°Ğ¾Ñ vs ÑĞ¿Ğ¾ĞºĞ¾Ğ¹ÑÑ‚Ğ²Ğ¸Ğµ'
    : charA.compatibility === 'chaotic' || charB.compatibility === 'chaotic' ? 'ğŸŒª Ğ¥Ğ°Ğ¾Ñ‚Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°'
    : charA.compatibility === 'conflict' || charB.compatibility === 'conflict' ? 'âš¡ ĞšĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°'
    : charA.compatibility === 'meme' && charB.compatibility === 'meme' ? 'ğŸ˜‚ ĞœĞµĞ¼-Ğ¿Ğ°Ñ€Ğ°'
    : 'âš–ï¸ Ğ¡Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°';

  const ru_package = `ğŸ¬ Ğ”Ğ˜ĞĞ›ĞĞ“ Ğ¡ Ğ¢ĞĞ™ĞœĞ˜ĞĞ“ĞĞœĞ˜ (v2 Production Contract)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‚ ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ: ${cat.ru}${topicRu ? `\nğŸ’¡ Ğ˜Ğ´ĞµÑ: ${topicRu}` : ''}${sceneHint ? `\nğŸ¥ Ğ ĞµÑ„ĞµÑ€ĞµĞ½Ñ: ${sceneHint}` : ''}
ï¿½ ĞŸĞ°Ñ€Ğ°: ${charA.name_ru} (${cast.speaker_A.age}) Ã— ${charB.name_ru} (${cast.speaker_B.age})
ğŸ­ Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºĞ°: ${pairDynamic}
ï¿½ï¿½ Ğ›Ğ¾ĞºĞ°Ñ†Ğ¸Ñ: ${location.split(',')[0]}
ğŸ’¡ ĞÑĞ²ĞµÑ‰ĞµĞ½Ğ¸Ğµ: ${lightingMood.mood}
ğŸ‘— A: ${wardrobeA}
ğŸ‘” B: ${wardrobeB}
ğŸª‘ Ğ ĞµĞºĞ²Ğ¸Ğ·Ğ¸Ñ‚: ${propAnchor}

[0.00â€“0.80] ğŸ£ Ğ¥Ğ£Ğš: ${hookObj.action_ru}
  ğŸ”Š Ğ—Ğ²ÑƒĞº: ${hookObj.audio}
  ğŸ­ Ğ¡Ñ‚Ğ¸Ğ»ÑŒ Ñ…ÑƒĞºĞ° A: ${charA.modifiers?.hook_style || 'Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ'}

[0.80â€“3.60] ğŸ…°ï¸ ${charA.name_ru} (${charA.vibe_archetype || 'Ñ€Ğ¾Ğ»ÑŒ A'}):
  Â«${dialogueA}Â»
  ğŸ’¬ Ğ¢ĞµĞ¼Ğ¿: ${charA.speech_pace} | Ğ¡Ğ»Ğ¾Ğ²: 4-7 | ĞĞºĞ½Ğ¾: 2.8Ñ | ${charA.swear_level > 0 ? 'Ğ¼Ğ°Ñ‚ ĞºĞ°Ğº Ğ°ĞºÑ†ĞµĞ½Ñ‚' : 'Ğ±ĞµĞ· Ğ¼Ğ°Ñ‚Ğ°'}
  ğŸ—£ Ğ“Ğ¾Ğ»Ğ¾Ñ: ${charA.speech_pace === 'fast' ? 'Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹, ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹, Ñ Ğ½Ğ°Ğ´Ñ€Ñ‹Ğ²Ğ¾Ğ¼' : charA.speech_pace === 'slow' ? 'Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹, Ñ‚ÑĞ¶Ñ‘Ğ»Ñ‹Ğ¹, ĞºĞ°Ğ¶Ğ´Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ Ñ Ğ²ĞµÑĞ¾Ğ¼' : 'ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ‚ĞµĞ¼Ğ±Ñ€, Ğ½Ğ°Ñ€Ğ°ÑÑ‚Ğ°ÑÑ‰Ğ°Ñ Ğ¸Ğ½Ğ´Ğ¸Ğ³Ğ½Ğ°Ñ†Ğ¸Ñ'}
  ğŸ­ ĞœĞ¸ĞºÑ€Ğ¾Ğ¶ĞµÑÑ‚: ${anchorA.micro_gesture || charA.modifiers?.hook_style || 'Ğ²Ñ‹Ñ€Ğ°Ğ·Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¶ĞµÑÑ‚'}
  ğŸ‘„ Ğ Ğ¾Ñ‚ B: Ğ³ÑƒĞ±Ñ‹ ÑĞ¾Ğ¼ĞºĞ½ÑƒÑ‚Ñ‹, Ñ‡ĞµĞ»ÑÑÑ‚ÑŒ Ğ½ĞµĞ¿Ğ¾Ğ´Ğ²Ğ¸Ğ¶Ğ½Ğ°, Ğ³Ğ»Ğ°Ğ·Ğ° ÑĞ»ĞµĞ´ÑÑ‚ Ğ·Ğ° A

[3.60â€“7.10] ğŸ…±ï¸ ${charB.name_ru} (${charB.vibe_archetype || 'Ñ€Ğ¾Ğ»ÑŒ B'}):
  Â«${dialogueB}Â»
  ğŸ’¬ Ğ¢ĞµĞ¼Ğ¿: ${charB.speech_pace} | Ğ¡Ğ»Ğ¾Ğ²: 4-8 | ĞĞºĞ½Ğ¾: 3.5Ñ | Ğ¿Ğ°ÑƒĞ·Ñ‹ = ÑĞ¸Ğ»Ğ°
  ğŸ—£ Ğ“Ğ¾Ğ»Ğ¾Ñ: ${charB.speech_pace === 'slow' ? 'Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹, Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹, ÑĞ»Ğ¾Ğ²Ğ° ĞºĞ°Ğº ĞºĞ°Ğ¼Ğ½Ğ¸' : charB.speech_pace === 'fast' ? 'ÑÑ‚Ğ°ĞºĞºĞ°Ñ‚Ğ¾, Ğ¾Ñ‚Ñ€Ñ‹Ğ²Ğ¸ÑÑ‚Ñ‹Ğ¹, Ñ€ĞµĞ·ĞºĞ¸Ğµ Ğ¿Ğ°ÑƒĞ·Ñ‹' : 'ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğ¹, Ğ½Ğ° killer word Ğ³Ğ¾Ğ»Ğ¾Ñ Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ğ´Ğ¾ ÑˆÑ‘Ğ¿Ğ¾Ñ‚Ğ°'}
  ğŸ’¥ KILLER WORD Â«${killerWord}Â» â†’ Ğ±Ğ»Ğ¸Ğ¶Ğµ Ğº 7.0s
  ğŸ‘„ Ğ Ğ¾Ñ‚ A: Ğ·Ğ°Ğ¼ĞµÑ€Ğ»Ğ° Ğ² Ğ¿Ğ¾Ğ·Ğµ, Ñ€Ğ¾Ñ‚ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚, Ğ»Ğ¸Ñ†Ğ¾ Ğ² ÑˆĞ¾ĞºĞµ

[7.10â€“8.00] ğŸ˜‚ RELEASE: ${releaseObj.action_ru}
  ğŸ”Š Ğ¡Ğ¼ĞµÑ… Ğ³Ñ€Ğ¾Ğ¼Ñ‡Ğµ Ñ€ĞµĞ¿Ğ»Ğ¸Ğº Ğ½Ğ° 20-30%, Ğ±ĞµĞ· ĞºĞ»Ğ¸Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğ°, Ñ‚ĞµĞ»Ğ° Ñ‚Ñ€ÑÑÑƒÑ‚ÑÑ
  ğŸ­ Ğ¡Ğ¼ĞµÑ… A: ${charA.modifiers?.laugh_style || 'Ğ¸ÑĞºÑ€ĞµĞ½Ğ½Ğ¸Ğ¹ ÑĞ¼ĞµÑ…'}
  ğŸ­ Ğ¡Ğ¼ĞµÑ… B: ${charB.modifiers?.laugh_style || 'Ğ´Ğ¾Ğ²Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¼ĞµÑˆĞ¾Ğº'}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“± Ğ—ĞĞ“ĞĞ›ĞĞ’ĞĞš (ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ):
${engage.viralTitle}

ğŸ“Œ Ğ—ĞĞšĞ Ğ•ĞŸ (Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ Ğ¾Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°):
${engage.pinComment}

ğŸ’¬ ĞŸĞ•Ğ Ğ’Ğ«Ğ™ ĞšĞĞœĞœĞ•ĞĞ¢ (ÑÑ€Ğ°Ğ·Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸):
${engage.firstComment}

#ï¸âƒ£ Ğ¥Ğ­Ğ¨Ğ¢Ğ•Ğ“Ğ˜ (${engage.hashtags.length} ÑˆÑ‚ â€” Ğ²ÑÑ‚Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ’ ĞŸĞ•Ğ Ğ’Ğ«Ğ™ ĞšĞĞœĞœĞ•ĞĞ¢, Ğ½Ğµ Ğ² Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ):
${engage.hashtags.join(' ')}

ğŸ’¡ Ğ¡Ğ¢Ğ ĞĞ¢Ğ•Ğ“Ğ˜Ğ¯:
â€¢ Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº â†’ Ğ² Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ÑÑ‚Ğ° (caption). Ğ¢Ğ¾Ñ‡ĞºĞ°. Ğ‘ĞµĞ· Ñ…ĞµÑˆÑ‚ĞµĞ³Ğ¾Ğ².
â€¢ Ğ¥ĞµÑˆÑ‚ĞµĞ³Ğ¸ â†’ Ğ² ĞŸĞ•Ğ Ğ’Ğ«Ğ™ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ Ğ¾Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ° (IG Ğ½Ğµ Ñ€ĞµĞ¶ĞµÑ‚ Ğ¾Ñ…Ğ²Ğ°Ñ‚).
â€¢ Ğ—Ğ°ĞºÑ€ĞµĞ¿ â†’ Ğ·Ğ°ĞºÑ€ĞµĞ¿Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ ÑĞ²ĞµÑ€Ñ…Ñƒ.
â€¢ ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ â†’ Ğ¿Ğ¾ÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· 1-2 Ğ¼Ğ¸Ğ½ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸.
â€¢ Ğ¡ĞµÑ€Ğ¸Ñ: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ${engage.seriesTag} Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Ğ²Ğ¸Ğ´ĞµĞ¾ ÑÑ‚Ğ¾Ğ¹ Ğ¿Ğ°Ñ€Ñ‹.${product_info?.description_en ? `

ğŸ“¦ Ğ¢ĞĞ’ĞĞ  Ğ’ ĞšĞĞ”Ğ Ğ•:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° (EN, Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°): ${product_info.description_en.slice(0, 300)}${product_info.description_en.length > 300 ? '...' : ''}

âš ï¸ Ğ’ĞĞ–ĞĞ: Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ² ĞºĞ°Ğ´Ñ€Ğµ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ĞºĞ°Ğº Ğ½Ğ° Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ñ„Ğ¾Ñ‚Ğ¾!
â€¢ ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ A Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚/Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ ÑĞ²Ğ¾ĞµĞ¹ Ñ€ĞµĞ¿Ğ»Ğ¸ĞºĞ¸
â€¢ Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ñ‹Ğ¼ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ñ‚ÑĞ¶ĞµĞ½Ğ¸Ğ¸ Ğ²ÑĞµĞ³Ğ¾ Ñ€Ğ¾Ğ»Ğ¸ĞºĞ°
â€¢ Ğ¦Ğ²ĞµÑ‚Ğ°, Ñ„Ğ¾Ñ€Ğ¼Ğ°, Ğ±Ñ€ĞµĞ½Ğ´ â€” ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ ĞºĞ°Ğº Ğ½Ğ° Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ñ„Ğ¾Ñ‚Ğ¾` : ''}`;

  // â”€â”€ BLUEPRINT JSON â”€â”€
  const blueprint_json = {
    version: '2.0',
    ...(topicRu ? { topic_ru: topicRu } : {}),
    ...(topicEn ? { topic_en: topicEn } : {}),
    ...(sceneHint ? { scene_reference: sceneHint } : {}),
    category: cat,
    lighting: lightingMood,
    scenes: [
      { id: 1, segment: 'hook', action: hookObj.action_en, speaker: 'A', start: GRID_V2.hook.start, end: GRID_V2.hook.end, dialogue_ru: '', speech_hints: `${hookObj.audio}, ${charA.modifiers?.hook_style || 'attention grab'}` },
      { id: 2, segment: 'act_A', action: `${charA.vibe_archetype || 'Provocateur'} delivers ${charA.speech_pace === 'fast' ? 'rapid-fire indignation' : charA.speech_pace === 'slow' ? 'slow-burn provocation' : 'passionate provocation'}`, speaker: 'A', start: GRID_V2.act_A.start, end: GRID_V2.act_A.end, dialogue_ru: dialogueA, speech_hints: `${charA.speech_pace} pace, 4-7 words, ${charA.swear_level > 1 ? 'expressive accent' : 'controlled'}, B sealed, ${anchorA.micro_gesture || 'emphatic gestures'}` },
      { id: 3, segment: 'act_B', action: `${charB.vibe_archetype || 'Grounded responder'} delivers ${charB.speech_pace === 'slow' ? 'devastating measured punchline' : charB.speech_pace === 'fast' ? 'rapid-fire killer response' : 'controlled punchline buildup'}`, speaker: 'B', start: GRID_V2.act_B.start, end: GRID_V2.act_B.end, dialogue_ru: dialogueB, speech_hints: `${charB.speech_pace} pace, 4-8 words, killer word "${killerWord}" near end, A frozen, ${anchorB.micro_gesture || 'subtle gesture on punchline'}` },
      { id: 4, segment: 'release', action: releaseObj.action_en, speaker: 'both', start: GRID_V2.release.start, end: GRID_V2.release.end, dialogue_ru: '', speech_hints: `zero words, ${charB.modifiers?.laugh_style || 'natural laugh'}, shared laugh` },
    ],
    dialogue_segments: [
      { speaker: 'A', text_ru: dialogueA, start: GRID_V2.act_A.start, end: GRID_V2.act_A.end, word_range: '4-7' },
      { speaker: 'B', text_ru: dialogueB, start: GRID_V2.act_B.start, end: GRID_V2.act_B.end, word_range: '4-8' },
    ],
    timing_grid: {
      total: 8.0,
      hook: [GRID_V2.hook.start, GRID_V2.hook.end],
      A: [GRID_V2.act_A.start, GRID_V2.act_A.end],
      B: [GRID_V2.act_B.start, GRID_V2.act_B.end],
      release: [GRID_V2.release.start, GRID_V2.release.end],
      killer_word_at: 6.85,
      gap_between_speakers: '0.15-0.25s',
    },
    identity_anchors: {
      A: charA.identity_anchors || {},
      B: charB.identity_anchors || {},
    },
    cast_summary: {
      A: { name: charA.name_ru, age: cast.speaker_A.age, vibe: charA.vibe_archetype, pace: charA.speech_pace, compatibility: charA.compatibility },
      B: { name: charB.name_ru, age: cast.speaker_B.age, vibe: charB.vibe_archetype, pace: charB.speech_pace, compatibility: charB.compatibility },
      pair_dynamic: pairDynamic,
    },
  };

  // â”€â”€ QC Gate â”€â”€
  const qc = runQCGate(blueprint_json, cast);

  // â”€â”€ Validate â”€â”€
  const output = { photo_prompt_en_json, video_prompt_en_json, ru_package, blueprint_json };
  const validation = runAllValidations(output, historyCache);

  // â”€â”€ Update history â”€â”€
  historyCache.addGeneration({
    location,
    props: [propAnchor],
    wardrobeA,
    wardrobeB,
    category: cat.ru,
  });

  const log = {
    seed,
    generator_version: '2.0',
    memory_hash: hashMem,
    characters: [charA.id, charB.id],
    vibes: [charA.vibe_archetype, charB.vibe_archetype],
    category: cat,
    engagement: {
      viral_title: engage.viralTitle,
      pin_comment: engage.pinComment,
      first_comment: engage.firstComment,
      series_tag: engage.seriesTag,
      hashtag_count: engage.hashtags.length,
      hashtags: engage.hashtags,
    },
    qc_gate: { passed: qc.passed, total: qc.total, ok: qc.ok, hard_fails: qc.hard_fails },
    warnings: validation.warnings,
    auto_fixes: autoFixes,
    duration_estimate: estimate.total,
    input_mode,
    timestamp: new Date().toISOString(),
  };

  return {
    photo_prompt_en_json,
    video_prompt_en_json,
    ru_package,
    blueprint_json,
    log,
    warnings: [...validation.warnings, ...(qc.ok ? [] : [`QC Gate: ${qc.passed}/${qc.total} (need â‰¥9)${qc.hard_fails.length ? ', HARD FAIL: ' + qc.hard_fails.join(', ') : ''}`])],
    auto_fixes: [...autoFixes, ...validation.auto_fixes],
    duration_estimate: estimate,
    qc_gate: qc,
    // Context for API mode â€” sent to server for Gemini refinement
    _apiContext: {
      charA, charB, category: cat, topic_ru: topicRu, scene_hint: sceneHint,
      input_mode, video_meta, product_info, location, wardrobeA, wardrobeB,
      propAnchor, lightingMood, hookAction: hookObj, releaseAction: releaseObj,
      aesthetic, script_ru, cinematography,
      // Remake instruction â€” when video reference is provided, Gemini must replicate it
      remake_mode: !!(video_meta?.url || video_meta?.title || video_meta?.cover_base64),
      remake_instruction: (video_meta?.url || video_meta?.title || video_meta?.cover_base64) ? buildRemakeInstruction(video_meta, charA, charB) : null,
    },
  };
}

// â”€â”€â”€ MERGE GEMINI RESULT INTO LOCAL TEMPLATE â”€â”€
// Takes local generation (structural) + Gemini output (creative) â†’ merged result
export function mergeGeminiResult(localResult, geminiData) {
  if (!geminiData) return localResult;

  const ctx = localResult._apiContext;
  const g = geminiData;

  // Deep clone to avoid mutating original
  const r = JSON.parse(JSON.stringify(localResult));

  // â”€â”€ 1. Photo prompt: replace scene with Gemini's ultra-detailed version â”€â”€
  if (g.photo_scene_en) {
    r.photo_prompt_en_json.scene = g.photo_scene_en;
  }

  // â”€â”€ 2. Video prompt: replace dialogue â”€â”€
  if (g.dialogue_A_ru) r.video_prompt_en_json.dialogue.line_A_ru = g.dialogue_A_ru;
  if (g.dialogue_B_ru) r.video_prompt_en_json.dialogue.line_B_ru = g.dialogue_B_ru;
  if (g.killer_word) r.video_prompt_en_json.dialogue.killer_word = g.killer_word;

  // â”€â”€ 3. Video prompt: replace emotion arc â”€â”€
  if (g.video_emotion_arc) {
    const arc = g.video_emotion_arc;
    r.video_prompt_en_json.emotion_arc = {
      hook: arc.hook_en || r.video_prompt_en_json.emotion_arc.hook,
      act_A: arc.act_A_en || r.video_prompt_en_json.emotion_arc.act_A,
      act_B: arc.act_B_en || r.video_prompt_en_json.emotion_arc.act_B,
      release: arc.release_en || r.video_prompt_en_json.emotion_arc.release,
    };
  }

  // â”€â”€ 4. Video prompt: replace atmosphere â”€â”€
  if (g.video_atmosphere_en) {
    r.video_prompt_en_json.spatial.environment_interaction = g.video_atmosphere_en;
  }

  // â”€â”€ 5. Blueprint: replace dialogue in scenes â”€â”€
  if (g.dialogue_A_ru) {
    if (r.blueprint_json.scenes[1]) r.blueprint_json.scenes[1].dialogue_ru = g.dialogue_A_ru;
    if (r.blueprint_json.dialogue_segments[0]) r.blueprint_json.dialogue_segments[0].text_ru = g.dialogue_A_ru;
  }
  if (g.dialogue_B_ru) {
    if (r.blueprint_json.scenes[2]) r.blueprint_json.scenes[2].dialogue_ru = g.dialogue_B_ru;
    if (r.blueprint_json.dialogue_segments[1]) r.blueprint_json.dialogue_segments[1].text_ru = g.dialogue_B_ru;
  }

  // â”€â”€ 6. Rebuild RU package with Gemini's creative content â”€â”€
  const dA = g.dialogue_A_ru || ctx.dialogueA || 'â€”';
  const dB = g.dialogue_B_ru || ctx.dialogueB || 'â€”';
  const kw = g.killer_word || 'â€”';
  const charA = ctx.charA;
  const charB = ctx.charB;
  const cast = r.video_prompt_en_json.cast || {};
  const anchorA = charA.identity_anchors || {};
  const anchorB = charB.identity_anchors || {};

  const pairDynamic = charA.compatibility === 'chaotic' && charB.compatibility === 'calm' ? 'ğŸ”¥ Ğ’Ğ·Ñ€Ñ‹Ğ²Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°: Ñ…Ğ°Ğ¾Ñ vs ÑĞ¿Ğ¾ĞºĞ¾Ğ¹ÑÑ‚Ğ²Ğ¸Ğµ'
    : charA.compatibility === 'chaotic' || charB.compatibility === 'chaotic' ? 'ğŸŒª Ğ¥Ğ°Ğ¾Ñ‚Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°'
    : charA.compatibility === 'conflict' || charB.compatibility === 'conflict' ? 'âš¡ ĞšĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°'
    : charA.compatibility === 'meme' && charB.compatibility === 'meme' ? 'ğŸ˜‚ ĞœĞµĞ¼-Ğ¿Ğ°Ñ€Ğ°'
    : 'âš–ï¸ Ğ¡Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°';

  // Engagement from Gemini
  const viralTitle = g.viral_title_ru || r.log?.engagement?.viral_title || '';
  const pinComment = g.pin_comment_ru || r.log?.engagement?.pin_comment || '';
  const firstComment = g.first_comment_ru || r.log?.engagement?.first_comment || '';
  const hashtags = (g.hashtags || r.log?.engagement?.hashtags || []).map(t => t.startsWith('#') ? t : '#' + t);
  const seriesTag = '#' + (charA.name_ru || '').replace(/\s+/g, '').toLowerCase() + 'vs' + (charB.name_ru || '').replace(/\s+/g, '').toLowerCase();

  r.ru_package = `ğŸ¬ Ğ”Ğ˜ĞĞ›ĞĞ“ Ğ¡ Ğ¢ĞĞ™ĞœĞ˜ĞĞ“ĞĞœĞ˜ (v2 Gemini Production)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‚ ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ: ${ctx.category.ru}${ctx.topic_ru ? `\nğŸ’¡ Ğ˜Ğ´ĞµÑ: ${ctx.topic_ru}` : ''}${ctx.scene_hint ? `\nğŸ¥ Ğ ĞµÑ„ĞµÑ€ĞµĞ½Ñ: ${ctx.scene_hint}` : ''}
ğŸ¤– Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ Gemini â€” ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚
ğŸ‘¥ ĞŸĞ°Ñ€Ğ°: ${charA.name_ru} (${cast.speaker_A?.age || 'elderly'}) Ã— ${charB.name_ru} (${cast.speaker_B?.age || 'elderly'})
ğŸ­ Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºĞ°: ${pairDynamic}
ğŸ“ Ğ›Ğ¾ĞºĞ°Ñ†Ğ¸Ñ: ${ctx.location.split(',')[0]}
ğŸ’¡ ĞÑĞ²ĞµÑ‰ĞµĞ½Ğ¸Ğµ: ${ctx.lightingMood.mood}
ğŸ‘— A: ${ctx.wardrobeA}
ğŸ‘” B: ${ctx.wardrobeB}
ğŸª‘ Ğ ĞµĞºĞ²Ğ¸Ğ·Ğ¸Ñ‚: ${ctx.propAnchor}

[0.00â€“0.80] ğŸ£ Ğ¥Ğ£Ğš: ${ctx.hookAction.action_ru}
  ğŸ”Š Ğ—Ğ²ÑƒĞº: ${ctx.hookAction.audio}
  ğŸ­ Ğ¡Ñ‚Ğ¸Ğ»ÑŒ Ñ…ÑƒĞºĞ° A: ${charA.modifiers?.hook_style || 'Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ'}

[0.80â€“3.60] ğŸ…°ï¸ ${charA.name_ru} (${charA.vibe_archetype || 'Ñ€Ğ¾Ğ»ÑŒ A'}):
  Â«${dA}Â»
  ğŸ’¬ Ğ¢ĞµĞ¼Ğ¿: ${charA.speech_pace} | ${charA.swear_level > 0 ? 'Ğ¼Ğ°Ñ‚ ĞºĞ°Ğº Ğ°ĞºÑ†ĞµĞ½Ñ‚' : 'Ğ±ĞµĞ· Ğ¼Ğ°Ñ‚Ğ°'}
  ğŸ—£ Ğ“Ğ¾Ğ»Ğ¾Ñ: ${charA.speech_pace === 'fast' ? 'Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹, ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹, Ñ Ğ½Ğ°Ğ´Ñ€Ñ‹Ğ²Ğ¾Ğ¼' : charA.speech_pace === 'slow' ? 'Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹, Ñ‚ÑĞ¶Ñ‘Ğ»Ñ‹Ğ¹, ĞºĞ°Ğ¶Ğ´Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ Ñ Ğ²ĞµÑĞ¾Ğ¼' : 'ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ‚ĞµĞ¼Ğ±Ñ€, Ğ½Ğ°Ñ€Ğ°ÑÑ‚Ğ°ÑÑ‰Ğ°Ñ Ğ¸Ğ½Ğ´ignĞ°Ñ†Ğ¸Ñ'}
  ğŸ­ ĞœĞ¸ĞºÑ€Ğ¾Ğ¶ĞµÑÑ‚: ${anchorA.micro_gesture || charA.modifiers?.hook_style || 'Ğ²Ñ‹Ñ€Ğ°Ğ·Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¶ĞµÑÑ‚'}
  ğŸ‘„ Ğ Ğ¾Ñ‚ B: Ğ³ÑƒĞ±Ñ‹ ÑĞ¾Ğ¼ĞºĞ½ÑƒÑ‚Ñ‹, Ñ‡ĞµĞ»ÑÑÑ‚ÑŒ Ğ½ĞµĞ¿Ğ¾Ğ´Ğ²Ğ¸Ğ¶Ğ½Ğ°, Ğ³Ğ»Ğ°Ğ·Ğ° ÑĞ»ĞµĞ´ÑÑ‚ Ğ·Ğ° A

[3.60â€“7.10] ğŸ…±ï¸ ${charB.name_ru} (${charB.vibe_archetype || 'Ñ€Ğ¾Ğ»ÑŒ B'}):
  Â«${dB}Â»
  ğŸ’¬ Ğ¢ĞµĞ¼Ğ¿: ${charB.speech_pace} | Ğ¿Ğ°ÑƒĞ·Ñ‹ = ÑĞ¸Ğ»Ğ°
  ğŸ—£ Ğ“Ğ¾Ğ»Ğ¾Ñ: ${charB.speech_pace === 'slow' ? 'Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹, Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹, ÑĞ»Ğ¾Ğ²Ğ° ĞºĞ°Ğº ĞºĞ°Ğ¼Ğ½Ğ¸' : charB.speech_pace === 'fast' ? 'ÑÑ‚Ğ°ĞºĞºĞ°Ñ‚Ğ¾, Ğ¾Ñ‚Ñ€Ñ‹Ğ²Ğ¸ÑÑ‚Ñ‹Ğ¹, Ñ€ĞµĞ·ĞºĞ¸Ğµ Ğ¿Ğ°ÑƒĞ·Ñ‹' : 'ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğ¹, Ğ½Ğ° killer word Ğ³Ğ¾Ğ»Ğ¾Ñ Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ğ´Ğ¾ ÑˆÑ‘Ğ¿Ğ¾Ñ‚Ğ°'}
  ğŸ’¥ KILLER WORD Â«${kw}Â» â†’ Ğ±Ğ»Ğ¸Ğ¶Ğµ Ğº 7.0s
  ğŸ‘„ Ğ Ğ¾Ñ‚ A: Ğ·Ğ°Ğ¼ĞµÑ€Ğ»Ğ° Ğ² Ğ¿Ğ¾Ğ·Ğµ, Ñ€Ğ¾Ñ‚ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚, Ğ»Ğ¸Ñ†Ğ¾ Ğ² ÑˆĞ¾ĞºĞµ

[7.10â€“8.00] ğŸ˜‚ RELEASE: ${ctx.releaseAction.action_ru}
  ğŸ”Š Ğ¡Ğ¼ĞµÑ… Ğ³Ñ€Ğ¾Ğ¼Ñ‡Ğµ Ñ€ĞµĞ¿Ğ»Ğ¸Ğº Ğ½Ğ° 20-30%, Ğ±ĞµĞ· ĞºĞ»Ğ¸Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğ°, Ñ‚ĞµĞ»Ğ° Ñ‚Ñ€ÑÑÑƒÑ‚ÑÑ
  ğŸ­ Ğ¡Ğ¼ĞµÑ… A: ${charA.modifiers?.laugh_style || 'Ğ¸ÑĞºÑ€ĞµĞ½Ğ½Ğ¸Ğ¹ ÑĞ¼ĞµÑ…'}
  ğŸ­ Ğ¡Ğ¼ĞµÑ… B: ${charB.modifiers?.laugh_style || 'Ğ´Ğ¾Ğ²Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¼ĞµÑˆĞ¾Ğº'}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“± Ğ—ĞĞ“ĞĞ›ĞĞ’ĞĞš (ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ):
${viralTitle}

ğŸ“Œ Ğ—ĞĞšĞ Ğ•ĞŸ (Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ Ğ¾Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°):
${pinComment}

ğŸ’¬ ĞŸĞ•Ğ Ğ’Ğ«Ğ™ ĞšĞĞœĞœĞ•ĞĞ¢ (ÑÑ€Ğ°Ğ·Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸):
${firstComment}

#ï¸âƒ£ Ğ¥Ğ­Ğ¨Ğ¢Ğ•Ğ“Ğ˜ (${hashtags.length} ÑˆÑ‚ â€” Ğ²ÑÑ‚Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ’ ĞŸĞ•Ğ Ğ’Ğ«Ğ™ ĞšĞĞœĞœĞ•ĞĞ¢, Ğ½Ğµ Ğ² Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ):
${hashtags.join(' ')}

ğŸ’¡ Ğ¡Ğ¢Ğ ĞĞ¢Ğ•Ğ“Ğ˜Ğ¯:
â€¢ Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº â†’ Ğ² Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ÑÑ‚Ğ° (caption). Ğ¢Ğ¾Ñ‡ĞºĞ°. Ğ‘ĞµĞ· Ñ…ĞµÑˆÑ‚ĞµĞ³Ğ¾Ğ².
â€¢ Ğ¥ĞµÑˆÑ‚ĞµĞ³Ğ¸ â†’ Ğ² ĞŸĞ•Ğ Ğ’Ğ«Ğ™ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ Ğ¾Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ° (IG Ğ½Ğµ Ñ€ĞµĞ¶ĞµÑ‚ Ğ¾Ñ…Ğ²Ğ°Ñ‚).
â€¢ Ğ—Ğ°ĞºÑ€ĞµĞ¿ â†’ Ğ·Ğ°ĞºÑ€ĞµĞ¿Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ ÑĞ²ĞµÑ€Ñ…Ñƒ.
â€¢ ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ â†’ Ğ¿Ğ¾ÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· 1-2 Ğ¼Ğ¸Ğ½ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸.
â€¢ Ğ¡ĞµÑ€Ğ¸Ñ: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ${seriesTag} Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Ğ²Ğ¸Ğ´ĞµĞ¾ ÑÑ‚Ğ¾Ğ¹ Ğ¿Ğ°Ñ€Ñ‹.${ctx.product_info?.description_en ? `

ğŸ“¦ Ğ¢ĞĞ’ĞĞ  Ğ’ ĞšĞĞ”Ğ Ğ•:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° (EN, Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°): ${ctx.product_info.description_en.slice(0, 300)}${ctx.product_info.description_en.length > 300 ? '...' : ''}

âš ï¸ Ğ’ĞĞ–ĞĞ: Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ² ĞºĞ°Ğ´Ñ€Ğµ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ĞºĞ°Ğº Ğ½Ğ° Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ñ„Ğ¾Ñ‚Ğ¾!
â€¢ ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ A Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚/Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ ÑĞ²Ğ¾ĞµĞ¹ Ñ€ĞµĞ¿Ğ»Ğ¸ĞºĞ¸
â€¢ Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ñ‹Ğ¼ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ñ‚ÑĞ¶ĞµĞ½Ğ¸Ğ¸ Ğ²ÑĞµĞ³Ğ¾ Ñ€Ğ¾Ğ»Ğ¸ĞºĞ°
â€¢ Ğ¦Ğ²ĞµÑ‚Ğ°, Ñ„Ğ¾Ñ€Ğ¼Ğ°, Ğ±Ñ€ĞµĞ½Ğ´ â€” ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ ĞºĞ°Ğº Ğ½Ğ° Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ñ„Ğ¾Ñ‚Ğ¾` : ''}`;

  // â”€â”€ 7. Update log â”€â”€
  r.log.generator_version = '2.0-gemini';
  r.log.gemini_model = 'gemini-2.0-flash';
  if (g.viral_title_ru) r.log.engagement.viral_title = g.viral_title_ru;
  if (g.pin_comment_ru) r.log.engagement.pin_comment = g.pin_comment_ru;
  if (g.first_comment_ru) r.log.engagement.first_comment = g.first_comment_ru;
  if (g.hashtags) {
    r.log.engagement.hashtags = hashtags;
    r.log.engagement.hashtag_count = hashtags.length;
  }

  return r;
}
